
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">


  
<script>
  // A global function that the theme toggle can use to apply the current theme.
  window.applyThemeSetting = function(override) {
    const currentSetting = override || localStorage.getItem('user-color-scheme');
    const currentAttribute = document.documentElement.getAttribute('data-user-theme');

    if (currentSetting && currentSetting !== currentAttribute) {
      document.documentElement.setAttribute('data-user-theme', currentSetting);
    }
  };
window.applyThemeSetting();
</script>

  
  <link rel="stylesheet" href="/css/next.css?v=b639b856b0e61">
  <link rel="stylesheet" href="/css/legacy-rollout.css?v=b1b1ed0bf28ee">
  <link rel="preload" as="font" crossorigin href="/fonts/material-icons/regular.woff2">


<link rel="preload" as="font" crossorigin href="/fonts/google-sans/regular/latin.woff2">
<link rel="preload" as="font" crossorigin href="/fonts/google-sans/bold/latin.woff2">

<meta name="theme-color" content="#fff"/>




<title>Improved Next.js and Gatsby page load performance with granular chunking</title>
<meta name="description" content="Learn how both Next.js and Gatsby have improved their build output to minimize duplicate code and improve page load performance " />

<link rel="canonical" href="https://web.dev/granular-chunking-nextjs/" />

<meta itemprop="name" content="Improved Next.js and Gatsby page load performance with granular chunking" />
<meta itemprop="description" content="Learn how both Next.js and Gatsby have improved their build output to minimize duplicate code and improve page load performance " />
<meta itemprop="image" content="https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://web.dev/granular-chunking-nextjs/" />
<meta property="og:site_name" content="web.dev" />
<meta property="og:title" content="Improved Next.js and Gatsby page load performance with granular chunking" />
<meta property="og:description" content="Learn how both Next.js and Gatsby have improved their build output to minimize duplicate code and improve page load performance " />
<meta property="og:image" content="https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:image:alt" content="Jigsaw pieces connecting" />
<meta property="tag" content="performance" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Improved Next.js and Gatsby page load performance with granular chunking" />
<meta name="twitter:description" content="Learn how both Next.js and Gatsby have improved their build output to minimize duplicate code and improve page load performance " />
<meta name="twitter:image" content="https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&fit=max&w=1200&fm=auto" />
<link
  rel="alternate"
  href="/feed.xml"
  type="application/atom+xml"
  data-title="web.dev feed"
/>

<link rel="manifest" href="/manifest.webmanifest" />

<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="mask-icon" color="#0054ff" href="/images/safari-pinned-tab.svg">



<script>
window.ga =
  window.ga ||
  function () {
    (ga.q = ga.q || []).push(arguments);
  };
ga.l = +new Date();
ga('create', 'UA-126406676-2');
ga('set', 'transport', 'beacon');
ga('set', 'anonymizeIp', true);
ga('set', 'page', window.location.pathname);
ga('set', 'dimension5', '4');
ga('send', 'pageview');
</script>







<script>
function loadScript(url, type) {
  const s = document.createElement('script');
  s.src = url;
  if (type) {
    s.type = type;
  }
  if (type === 'module') {
    s.async = false; // Preserve load order.
    const pre = document.createElement('link');
    pre.rel = 'modulepreload';
    pre.href = url;
    document.head.append(pre);
    // We use DOMContentLoaded as the loader script is running sync, and inserting a module script here doesn't defer. This brings back normal type="module" behavior.
    window.addEventListener('DOMContentLoaded', () => {
      document.head.append(s);
    });
  } else {
    document.head.append(s);
  }
}
loadScript('/js/app.js?v=1325f2295b493', 'module');




  loadScript('/js/content.js?v=c8d108d48a8d7', 'module');


  loadScript('https://www.google-analytics.com/analytics.js', null);

</script>

  </head>
  <body class="unresolved">
    
    <web-snackbar-container></web-snackbar-container>

    
<a href="#main" class="skip-link button" data-type="primary">Skip to content</a>


<web-header role="banner" class="site-header">
  <div class="cluster gutter-base">
    <button class="icon-button tooltip color-core-text md:hidden-yes" data-open-drawer-button data-alignment="right">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
      <span class="tooltip__content">Open menu</span>
    </button>
    <a href="/" class="site-header__brand brand">
      


  <svg role="img" aria-label="web.dev" xmlns="http://www.w3.org/2000/svg" width="119.79" height="22.32" viewBox="0 0 119.79 22.32"><path class="brand__text" d="M114.99 19.32h-2.2l-4.8-11.9h2.4l3.5 9.2 3.5-9.2h2.4Zm-16.8-7.3h6.8a3.17 3.17 0 0 0-3.4-2.9 3.42 3.42 0 0 0-3.4 2.9Zm3.6 7.7a6 6 0 0 1-6-6.3c0-3.6 2.5-6.3 5.9-6.3s5.8 2.4 5.8 6.5v.2h-9.3a3.88 3.88 0 0 0 3.8 3.9 3.56 3.56 0 0 0 3.3-2.1l2 1a6.22 6.22 0 0 1-5.5 3.1Zm-14 0c-3.1 0-5.7-2.8-5.7-6.3s2.6-6.3 5.7-6.3a5 5 0 0 1 4.1 2h.1l-.1-1.6v-5.5h2.2v17.3h-2.1v-1.6h-.1a5.12 5.12 0 0 1-4.1 2Zm.3-2c2.2 0 3.8-1.7 3.8-4.3s-1.6-4.3-3.8-4.3a4 4 0 0 0-3.8 4.3 4 4 0 0 0 3.8 4.3Zm-6.8.1a1.61 1.61 0 0 1-1.7 1.6 1.74 1.74 0 0 1-1.7-1.6 1.67 1.67 0 0 1 1.7-1.6 1.61 1.61 0 0 1 1.7 1.6Zm-10.5-.1a4 4 0 0 0 3.8-4.3 4 4 0 0 0-3.8-4.3c-2.2 0-3.8 1.8-3.8 4.3s1.6 4.3 3.8 4.3Zm.4 2a5 5 0 0 1-4.1-2h-.1v1.6h-2.1V2.02h2.2v5.5l-.1 1.6h.1a4.84 4.84 0 0 1 4.1-2c3.1 0 5.7 2.8 5.7 6.3s-2.6 6.3-5.7 6.3Zm-17.4-7.7h6.8a3.17 3.17 0 0 0-3.4-2.9 3.42 3.42 0 0 0-3.4 2.9Zm3.6 7.7a6 6 0 0 1-6-6.3c0-3.6 2.5-6.3 5.9-6.3s5.8 2.4 5.8 6.5v.2h-9.3a3.88 3.88 0 0 0 3.8 3.9 3.67 3.67 0 0 0 3.3-2.1l2 1a6.22 6.22 0 0 1-5.5 3.1Zm-6.3-12.2-3.8 11.9h-2.3l-3-9.1-2.9 9.1h-2.3l-3.9-11.9h2.3l2.6 9 2.9-9h2.3l2.9 9 2.6-9Z" fill="#5f6368" fill-rule="evenodd"/><path d="M0 19.28a3 3 0 0 1 3-3h16.27a3.045 3.045 0 0 1 0 6.09H3.04A3 3 0 0 1 0 19.28Z" fill="#6cf"/><path d="M.89.9a3 3 0 0 1 4.3 0l8.12 8.11a3.05 3.05 0 0 1 0 4.3l-8.12 8.12a3.04 3.04 0 1 1-4.3-4.3l5.6-5.61a.51.51 0 0 0 0-.72L.89 5.22A3 3 0 0 1 .89.9Z" fill="#06f" fill-rule="evenodd"/><path d="m10.39 16.22-5.2 5.2a3.04 3.04 0 1 1-4.3-4.3l.89-.9Z" fill="#c6f"/><circle cx="19.27" cy="19.27" r="3.04" fill="#06f"/></svg>


    </a>
  </div>
  <web-navigation-drawer type="standard">
    <nav class="site-header__nav" aria-label="main navigation" data-drawer-container>
      <a
        class="site-header__link"
        href="/learn/" data-category="Site-Wide Custom Events"
        data-label="Tab: Learn"
        >
          Learn
      </a>
      <a
        class="site-header__link"
        href="/measure/"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Measure"
        >
        Measure
      </a>
      <a
        class="site-header__link"
        href="/blog/"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Blog"
        >
        Blog
      </a>
      <a
        class="site-header__link"
        href="/tags/case-study/"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Case Studies"
        >
        Case studies
      </a>
      <a
        class="site-header__link"
        href="/about/"
        data-category="Site-Wide Custom Events"
        data-label="Tab: About" >
        About
      </a>
      <button class="icon-button tooltip color-core-text md:hidden-yes" data-drawer-close-button>
        








  










  <svg class="icon " role="img" aria-label="close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>


        <span class="tooltip__content">Close</span>
      </button>
    </nav>
  </web-navigation-drawer>
  <div class="site-header__actions cluster">
    <div class="site-header__search">
      <web-search results-id="search-main-results" i18n="{&quot;search&quot;:{&quot;en&quot;:&quot;Search&quot;},&quot;open_search&quot;:{&quot;en&quot;:&quot;Open search&quot;},&quot;all_articles&quot;:{&quot;en&quot;:&quot;All articles&quot;},&quot;close_search&quot;:{&quot;en&quot;:&quot;Close search&quot;}}"></web-search>
      <web-search-results id="search-main-results"></web-search-results>
    </div>
  </div>
</web-header>

<main id="main">
  
    
  
  





  <img     alt="Jigsaw pieces connecting"     class="hero-image"     decoding="async"     height="480"               sizes="100vw"     src="https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/G5NYXIUQZ3hUfbyOnt0r.png?auto=format&w=1600 1600w"          width="1600"   />


<div class="post wrapper" data-flush>
  
    
    
    
  
  

  <div class="sidebar region flex-align-start flex-dir-rev flex-wrap-no">
    

  <nav class="course__toc toc over-scroll hidden-yes xl:hidden-no" data-type="side" aria-label="On this page">
    <div class="course-toc__heading font-google-sans weight-medium">On this page</div>
    <web-scroll-spy>
      <div class="toc__wrapper flow-recursive">
        <ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#introduction">Introduction</a></li><li class="toc__listitem"><a class="toc__anchor" href="#improved-chunking">Improved Chunking</a></li><li class="toc__listitem"><a class="toc__anchor" href="#more-http-requests">More HTTP requests</a></li><li class="toc__listitem"><a class="toc__anchor" href="#size-reductions-with-granular-chunks">Size reductions with granular chunks</a></li><li class="toc__listitem"><a class="toc__anchor" href="#gatsby">Gatsby</a></li><li class="toc__listitem"><a class="toc__anchor" href="#conclusion">Conclusion</a></li></ul>
      </div>
    </web-scroll-spy>
  </nav>


    
    <article class="prose legacy-rollout">
      <header class="flow gap-bottom-size-3">
        
          <nav class="breadcrumbs" aria-label="breadcrumbs">
            <ul class="breadcrumbs__list" role="list">
              <li>
                <a
                  class="gc-analytics-event"
                  data-category="web.dev"
                  data-label="post, home breadcrumb"
                  data-action="click"
                  href="/"
                >
                  Home
                </a>
              </li>
              
              <li>
                <a
                  class="gc-analytics-event"
                  data-category="web.dev"
                  data-label="post, path breadcrumb"
                  data-action="click"
                  href="/blog"
                >
                  All articles
                </a>
              </li>
              
            </ul>
          </nav>
        

        <h1 id="improved-next.js-and-gatsby-page-load-performance-with-granular-chunking">Improved Next.js and Gatsby page load performance with granular chunking</h1>
        
          <p class="color-mid-text flow-space-base">
            A newer webpack chunking strategy in Next.js and Gatsby minimizes duplicate code to improve page load performance.
          </p>
        

        
          <div class="flow-space-size-1 color-mid-text text-size-0">
            <time>Apr 29, 2020</time>
            
          </div>
        

        
        

        

        
          <div class="cluster flow-space-size-2">
            
              <div class="author">
  <a class="avatar" href="/authors/houssein/"> <img     alt="Houssein Djirdeh"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /> </a>
  <div class="flow">
    <cite class="author__name">
      <a href="/authors/houssein/">Houssein Djirdeh</a>
    </cite>
    <div class="author__links cluster">
               <a href="https://twitter.com/hdjirdeh">Twitter</a>
               <a href="https://github.com/housseindjirdeh">GitHub</a>
               <a href="https://glitch.com/@housseindjirdeh">Glitch</a>
               <a href="https://houssein.me/">Homepage</a>
             </div>
  </div>
</div>
            
          </div>
        
      </header>

      

      

  

  <div class="xl:hidden-yes flow-space-size-1">
    <details data-type="inner" role="navigation" aria-label="On this page">
      <summary>
        On this page
      </summary>
      <div class="toc"><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#introduction">Introduction</a></li><li class="toc__listitem"><a class="toc__anchor" href="#improved-chunking">Improved Chunking</a></li><li class="toc__listitem"><a class="toc__anchor" href="#more-http-requests">More HTTP requests</a></li><li class="toc__listitem"><a class="toc__anchor" href="#size-reductions-with-granular-chunks">Size reductions with granular chunks</a></li><li class="toc__listitem"><a class="toc__anchor" href="#gatsby">Gatsby</a></li><li class="toc__listitem"><a class="toc__anchor" href="#conclusion">Conclusion</a></li></ul></div>
    </details>
  </div>



      <p>Chrome is <a href="/advancing-framework-ecosystem-cds-2019/">collaborating</a> with tooling and
frameworks in the JavaScript open-source ecosystem. A number of newer optimizations were recently
added to improve the loading performance of <a href="https://nextjs.org/" rel="noopener">Next.js</a> and
<a href="https://www.gatsbyjs.org/" rel="noopener">Gatsby</a>. This article covers an improved granular chunking strategy
that is now shipped by default in both frameworks.</p>
<h2 id="introduction">Introduction <a class="w-headline-link" href="#introduction">#</a></h2>
<p>Like many web frameworks, Next.js and Gatsby use <a href="https://webpack.js.org/" rel="noopener">webpack</a> as their core
bundler. webpack v3 introduced
<a href="https://webpack.js.org/plugins/commons-chunk-plugin/" rel="noopener"><code>CommonsChunkPlugin</code></a> to make it possible to
output modules shared between different entry points in a single (or few) &quot;commons&quot; chunk (or
chunks). Shared code can be downloaded separately and stored in the browser cache early on which can
result in a better loading performance.</p>
<p>This pattern became popular with many single-page application frameworks adopting an entrypoint and
bundle configuration that looked like this:</p>
<img     alt="Common entrypoint and bundle configuration"     class="w-screenshot w-screenshot--filled"     decoding="async"     height="569"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/r4QB67AXzmPMgxcxgbQF.png?auto=format&w=1600 1600w"          width="800"   />
<p>Although practical, the concept of bundling all shared module code into a single chunk has its
limitations. Modules not shared in every entry point can be downloaded for routes that do not use it
resulting in more code being downloaded than necessary. For example, when <code>page1</code> loads
the <code>common</code> chunk, it loads the code for <code>moduleC</code> even though <code>page1</code> doesn't use <code>moduleC</code>.
For this reason, along with a few others, webpack v4 removed the plugin in favor of a new
one: <a href="https://webpack.js.org/plugins/split-chunks-plugin/" rel="noopener"><code>SplitChunksPlugin</code></a>.</p>
<h2 id="improved-chunking">Improved Chunking <a class="w-headline-link" href="#improved-chunking">#</a></h2>
<p>The default settings for <code>SplitChunksPlugin</code>  works well for most users. Multiple split chunks are
created depending on a number of <a href="https://webpack.js.org/plugins/split-chunks-plugin/#defaults" rel="noopener">conditions</a>
to prevent fetching duplicated code across multiple routes.</p>
<p>However, many web frameworks that use this plugin still follow a &quot;single-commons&quot; approach to chunk
splitting. Next.js, for example, would generate a <code>commons</code> bundle that contained any module that is
used in more than 50% of pages and all framework dependencies (<code>react</code>, <code>react-dom</code>, and so on).</p>
<web-copy-code><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token keyword">const</span> splitChunksConfigs <span class="token operator">=</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  …</span><br><span class="highlight-line">  prod<span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      vendors<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      commons<span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        name<span class="token operator">:</span> <span class="token string">'commons'</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span></span><br><mark class="highlight-line highlight-line-active">        minChunks<span class="token operator">:</span> totalPages <span class="token operator">></span> <span class="token number">2</span> <span class="token operator">?</span> totalPages <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></mark><br><span class="highlight-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      react<span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        name<span class="token operator">:</span> <span class="token string">'commons'</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span></span><br><mark class="highlight-line highlight-line-active">        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/](react|react-dom|scheduler|use-subscription)[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></mark><br><span class="highlight-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span></code></pre>
</web-copy-code><p>Although including framework-dependent code into a shared chunk means that it can be downloaded and
cached for any entrypoint, the usage-based heuristic of including common modules used in more than
<em>half of pages</em> isn't very effective. Modifying this ratio would only result in one of two outcomes:</p>
<ul>
<li>If you reduce the ratio, more unnecessary code gets downloaded.</li>
<li>If you increase the ratio, more code gets duplicated across multiple routes.</li>
</ul>
<p>To solve this problem, Next.js adopted a <a href="https://github.com/zeit/next.js/pull/7696" rel="noopener">different
configuration</a> for<code>SplitChunksPlugin</code> that reduces
unnecessary code for any route.</p>
<ul>
<li>Any sufficiently large third-party module (greater than 160 KB) is split into its own individual
chunk</li>
<li>A separate <code>frameworks</code> chunk is created for framework dependencies (<code>react</code>, <code>react-dom</code>, and
so on)</li>
<li>As many shared chunks as needed are created (up to 25)</li>
<li>The minimum size for a chunk to be generated is changed to 20 KB</li>
</ul>
<p>This granular chunking strategy provides the following benefits:</p>
<ul>
<li><strong>Page load times are improved</strong>. Emitting multiple shared chunks, instead of a single one,
minimizes the amount of unneeded (or duplicate) code for any entrypoint.</li>
<li><strong>Improved caching during navigations</strong>. Splitting large libraries and framework dependencies
into separate chunks reduces the possibility of cache invalidation since both are unlikely to
change until an upgrade is made.</li>
</ul>
<p>You can see the entire configuration that Next.js adopted in <a href="https://github.com/vercel/next.js/blob/e125d905a0dd93d247c6122d349c2c90268f0713/packages/next/build/webpack-config.ts#L352-L429" rel="noopener"><code>webpack-config.ts</code></a>.</p>
<h2 id="more-http-requests">More HTTP requests <a class="w-headline-link" href="#more-http-requests">#</a></h2>
<p><code>SplitChunksPlugin</code> defined the basis for granular chunking, and applying this approach to a
framework like Next.js was not an entirely new concept. Many frameworks, however, still continued to
use a single heuristic and &quot;commons&quot; bundle strategy for a few reasons. This includes the concern that
many more HTTP requests can negatively affect site performance.</p>
<p>Browsers can only open a limited number of TCP connections to a single origin (6 for Chrome), so
minimizing the number of chunks outputted by a bundler can ensure that the total number of requests
stays under this threshold. However, this only holds true for HTTP/1.1. Multiplexing in HTTP/2
allows for multiple requests to be streamed in parallel using a single connection over a single
origin. In other words, we generally do not need to worry about limiting the number of chunks
emitted by our bundler.</p>
<aside class="aside flow bg-state-info-bg color-state-info-text">
<div class=" flow">
<p>It is important to note that different browsers take <a href="https://calendar.perfplanet.com/2018/http2-prioritization/" rel="noopener">different
approaches</a> to prioritize specific
resources when many are requested over the same TCP connection. Some servers and CDNs also handle
prioritization differently (see <a href="https://github.com/andydavies/http2-prioritization-issues#cdns--cloud-hosting-services" rel="noopener">&quot;Tracking HTTP/2 Prioritization
Issues&quot;</a>).</p>
</div></aside>
<p><a href="https://caniuse.com/#feat=http2" rel="noopener">All major browsers</a> support HTTP/2. The Chrome and Next.js teams
wanted to see if increasing the number of requests by splitting Next.js's single &quot;commons&quot; bundle
into multiple shared chunks would affect loading performance in any way. They began by measuring the
performance of a single site while modifying the maximum number of parallel requests using the
<a href="https://webpack.js.org/plugins/split-chunks-plugin/#splitchunksmaxinitialrequests" rel="noopener"><code>maxInitialRequests</code></a>
property.</p>
<img     alt="Page load performance with increased number of requests"          decoding="async"     height="495"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/Psq42HGvyk1hiaCdEJxc.png?auto=format&w=1600 1600w"          width="800"   />
<p>In an average of three runs of multiple trials on a single web page, the
<a href="https://developer.mozilla.org/docs/Web/API/Window/load_event" rel="noopener"><code>load</code></a>,
<a href="https://github.com/WPO-Foundation/webpagetest-docs/blob/main/src/getting-started.md#start-render" rel="noopener">start-render</a>
and <a href="/fcp">First Contentful Paint</a> times all remained about the same when varying the max initial
request count (from 5 to 15). Interestingly enough, we noticed a slight performance overhead only
after splitting aggressively to hundreds of requests.</p>
<img     alt="Page load performance with hundreds of requests"          decoding="async"     height="495"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/Ykz3Zm35JUVmtqX1U6cI.png?auto=format&w=1600 1600w"          width="800"   />
<p>This showed that staying under a reliable threshold (20~25 requests) struck the right balance
between loading performance and caching efficiency. After some baseline testing, 25 was selected as
the <code>maxInitialRequest</code> count.</p>
<p>Modifying the maximum number of requests that happen in parallel resulted in more than a single
shared bundle, and separating them appropriately for each entry point significantly reduced the
amount of unneeded code for the same page.</p>
<img     alt="JavaScript payload reductions with increased chunking"          decoding="async"     height="495"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/z2yOSP2fpfu51OEpyTGS.png?auto=format&w=1600 1600w"          width="800"   />
<p>This experiment was only about modifying the number of requests to see if there would be any
negative effect on page load performance. The results suggest that setting <code>maxInitialRequests</code> to
<code>25</code> on the test page was optimal because it reduced the JavaScript payload size without slowing
down the page. The total amount of JavaScript that was needed to hydrate the page still remained
about the same, which explains why page load performance didn't necessarily improve with the reduced
amount of code.</p>
<p>webpack uses 30 KB as a default minimum size for a chunk to be generated. However, coupling a
<code>maxInitialRequests</code> value of 25 with a 20 KB minimum size instead resulted in better caching.</p>
<h2 id="size-reductions-with-granular-chunks">Size reductions with granular chunks <a class="w-headline-link" href="#size-reductions-with-granular-chunks">#</a></h2>
<p>Many frameworks, including Next.js, rely on client-side routing (handled by JavaScript) to inject
newer script tags for every route transition. But how do they predetermine these dynamic chunks at build time?</p>
<p>Next.js uses a server-side build manifest file to determine which outputted chunks are used by
different entry points. To provide this information to the client as well, an abridged client-side
build manifest file was created to map all the dependencies for every entry point.</p>
<web-copy-code><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Returns a promise for the dependencies for a particular route</span><br><span class="token function">getDependencies</span> <span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>promisedBuildManifest<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><br>    <span class="token parameter">man</span> <span class="token operator">=></span> <span class="token punctuation">(</span>man<span class="token punctuation">[</span>route<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> man<span class="token punctuation">[</span>route<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">url</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/_next/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>  <span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><figure>
  <img     alt="Output of multiple shared chunks in a Next.js application."     class="w-screenshot w-screenshot--filled"     decoding="async"     height="488"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format"     srcset="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/3XG4VlLQEQ724fvhynvM.png?auto=format&w=1600 1600w"          width="800"   />
</figure>
<p>This newer granular chunking strategy was first rolled out in Next.js behind a flag, where it was tested on a
number of early adopters. Many saw significant reductions to the total JavaScript used for their
entire site:</p>
<div>
  <table>
    <thead>
      <tr>
        <th>Website</th>
        <th>Total JS Change</th>
        <th>% Difference</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><a href="https://www.barnebys.com/">https://www.barnebys.com/</a></td>
        <td>-238 KB</td>
        <td>-23%</td>
      </tr>
      <tr>
        <td><a href="https://sumup.com/">https://sumup.com/</a></td>
        <td>-220 KB</td>
        <td>-30%</td>
      </tr>
      <tr>
        <td><a href="https://www.hashicorp.com/">https://www.hashicorp.com/</a></td>
        <td>-11 MB</td>
        <td>-71%</td>
      </tr>
    </tbody>
    <caption>JavaScript size reductions - across all routes (compressed)</caption>
  </table>
</div>
<p>The final version was shipped by default in <a href="https://nextjs.org/blog/next-9-2" rel="noopener">version 9.2</a>.</p>
<h2 id="gatsby">Gatsby <a class="w-headline-link" href="#gatsby">#</a></h2>
<p><a href="https://www.gatsbyjs.org/" rel="noopener">Gatsby</a> used to follow the same approach of using a usage-based
heuristic for defining common modules:</p>
<web-copy-code><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line">config<span class="token punctuation">.</span>optimization <span class="token operator">=</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  …</span><br><span class="highlight-line">  splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    name<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    chunks<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">all</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span></span><br><span class="highlight-line">    cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      vendors<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      commons<span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">commons</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span></span><br><span class="highlight-line">        chunks<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">all</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span></span><br><span class="highlight-line">        <span class="token comment">// if a chunk is used more than half the components count,</span></span><br><span class="highlight-line">        <span class="token comment">// we can assume it's pretty global</span></span><br><mark class="highlight-line highlight-line-active">        minChunks<span class="token operator">:</span> componentsCount <span class="token operator">></span> <span class="token number">2</span> <span class="token operator">?</span> componentsCount <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></mark><br><span class="highlight-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      react<span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">        name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">commons</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span></span><br><span class="highlight-line">        chunks<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">all</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span></span><br><span class="highlight-line">        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/](react|react-dom|scheduler)[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span></code></pre>
</web-copy-code><p>By optimizing their webpack configuration to adopt a similar granular chunking strategy, they also
noticed sizeable JavaScript reductions in many large sites:</p>
<div>
  <table>
    <thead>
      <tr>
        <th>Website</th>
        <th>Total JS Change</th>
        <th>% Difference</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><a href="https://www.gatsbyjs.org/">https://www.gatsbyjs.org/</a></td>
        <td>-680 KB</td>
        <td>-22%</td>
      </tr>
      <tr>
        <td><a href="https://www.thirdandgrove.com/">https://www.thirdandgrove.com/</a></td>
        <td>-390 KB</td>
        <td>-25%</td>
      </tr>
      <tr>
        <td><a href="https://ghost.org/">https://ghost.org/</a></td>
        <td>-1.1 MB</td>
        <td>-35%</td>
      </tr>
      <tr>
        <td><a href="https://reactjs.org/">https://reactjs.org/</a></td>
        <td>-80 Kb</td>
        <td>-8%</td>
      </tr>
    </tbody>
    <caption>JavaScript size reductions - across all routes (compressed)</caption>
  </table>
</div>
<p>Take a look at the <a href="https://github.com/gatsbyjs/gatsby/pull/22253" rel="noopener">PR</a> to understand how they
implemented this logic into their webpack configuration, which is shipped by default in v2.20.7.</p>
<h2 id="conclusion">Conclusion <a class="w-headline-link" href="#conclusion">#</a></h2>
<p>The concept of shipping granular chunks is not specific to Next.js, Gatsby or even webpack. Everyone
should consider improving their application's chunking strategy if it follows a large &quot;commons&quot;
bundle approach, regardless of the framework or module bundler used.</p>
<ul>
<li>If you would like to see the same chunking optimizations applied to a vanilla React application,
take a look at this <a href="https://glitch.com/edit/#!/webpack-granular-split-chunks?path=webpack.config.js" rel="noopener">sample React
app</a>. It uses a
simplified version of the granular chunking strategy and can help you start applying the same
sort of logic to your site.</li>
<li>For Rollup, chunks are created granularly by default. Take a look at
<a href="https://rollupjs.org/guide/en/#manualchunks" rel="noopener"><code>manualChunks</code></a> if you would like to manually
configure the behavior.</li>
</ul>


      

      <div class="cluster gutter-base flow-space-size-2" role="list" aria-label="tags">
        
          
        
          
        
          
            
            <a class="pill" href="/tags/performance/">Performance</a>
          
        
      </div>

      <div class="text-size-0 color-mid-text">
        <span>
          
          Last updated: <time>Apr 29, 2020</time>
          
        </span>
        —
        <a
          href="https://github.com/GoogleChrome/web.dev/blob/main/src/site/content/en/blog/granular-chunking-nextjs/index.md"
        >
          Improve article
        </a>
      </div>

      

      
        
        
      

      
        <div class="flow-space-size-2">
          <a href="/blog" class="button" data-type="secondary">
            <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>

            <span>Return to all articles</span>
          </a>
        </div>
      
      <div class="docked-actions flow flow-space-base">    
        <div>
          <share-action class="gc-analytics-event fab"
            authors="@hdjirdeh"
            data-category="web.dev"
            data-label="share"
            data-action="click"
            data-type="primary"
            data-icon="share"
            tabindex="0"
            role="button"
          >
            <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M18 16.1c-.8 0-1.4.3-2 .8l-7.1-4.2c.1-.2.1-.5.1-.7s0-.5-.1-.7L16 7.2c.5.5 1.2.8 2 .8 1.7 0 3-1.3 3-3s-1.3-3-3-3-3 1.3-3 3c0 .2 0 .5.1.7L8 9.8C7.5 9.3 6.8 9 6 9c-1.7 0-3 1.3-3 3s1.3 3 3 3c.8 0 1.5-.3 2-.8l7.1 4.2c-.1.2-.1.4-.1.6 0 1.6 1.3 2.9 2.9 2.9s2.9-1.3 2.9-2.9-1.2-2.9-2.8-2.9z" fill="currentColor"/></svg>
 
            <span class="fab__label">Share</span>
          </share-action>
        </div>
        
      </div>
    </article>
  </div>
</div>


</main>
<footer class="site-footer" role="contentinfo">
  <nav class="site-footer__primary-nav auto-grid" aria-label="footer navigation">
    <div>
      <h3 class="text-size-2 color-mid-text">Contribute</h3>
      <ul class="w-footer__linkbox-list" role="list">
        <li>
          <a href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&labels=bug&template=bug_report.md&title="
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
            File a bug
          </a>
        </li>
        <li>
          <a href="https://github.com/googlechrome/web.dev"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
            View source
          </a>
        </li>
      </ul>
    </div>
    <div>
      <h3 class="text-size-2 color-mid-text">Related content</h3>
      <ul class="w-footer__linkbox-list" role="list">
          <li>
          <a href="https://developer.chrome.com/"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
            developer.chrome.com
          </a>
        </li>
        <li>
          <a href="https://blog.chromium.org/"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
            Chrome updates
          </a>
        </li>
        <li>
          <a href="https://developers.google.com/web/fundamentals"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
            Web Fundamentals
          </a>
        </li>
        <li>
          <a href="/tags/case-study/"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">
            Case studies
          </a>
        </li>
        <li>
          <a href="/podcasts/"
            data-category="Podcasts" data-label="Footer Link (index 5)">
            Podcasts
          </a>
        </li>
        <li>
          <a href="/shows/"
            data-category="Shows" data-label="Footer Link (index 6)">
            Shows
          </a>
        </li>
      </ul>
    </div>
    <div>
      <h3 class="text-size-2 color-mid-text">Connect</h3>
      <ul class="w-footer__linkbox-list" role="list">
        <li>
          <a href="https://www.twitter.com/ChromiumDev"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
            Twitter
          </a>
        </li>
        <li>
          <a href="https://www.youtube.com/user/ChromeDevelopers"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
            YouTube
          </a>
        </li>
      </ul>
    </div>
  </nav>
  <nav class="site-footer__brand-nav repel" aria-label="Google developers">
    <ul class="cluster" role="list">
      <li>
        <a href="https://developers.google.com/" data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link">
          <img loading="lazy" width="185" height="33" class="w-footer__utility-logo" src="/images/lockup-color.png"
            alt="Google Developers" />
        </a>
      </li>
      <li>
        <a href="https://developer.chrome.com/"
          data-category="Site-Wide Custom Events" data-label="Footer Chrome Link">
          Chrome
        </a>
      </li>
      <li>
        <a href="https://firebase.google.com/" data-category="Site-Wide Custom Events"
          data-label="Footer Firebase Link">
          Firebase
        </a>
      </li>
      <li>
        <a href="https://cloud.google.com/" data-category="Site-Wide Custom Events"
          data-label="Footer Google Cloud Platform Link">
          Google Cloud Platform
        </a>
      </li>
      <li>
        <a href="https://developers.google.com/products"
          data-category="Site-Wide Custom Events" data-label="Footer All products Link">
          All products
        </a>
      </li>
    </ul>
    <web-language-select current="en"></web-language-select>
  </nav>
  <nav class="site-footer__misc-links" aria-label="terms and policies">
    <ul class="cluster" role="list">
      <li>
        <a href="https://policies.google.com/" data-category="Site-Wide Custom Events"
          data-label="Footer Terms and Privacy link">
          Terms &amp; Privacy
        </a>
      </li>
      <li>
        <a href="/community-guidelines/" data-category="Site-Wide Custom Events"
          data-label="Footer Community Guidelines link">
          Community Guidelines
        </a>
      </li>
    </ul>
  </nav>
  <p class="gap-top-size-2 text-size-0">
    Except as otherwise noted, the content of this page is licensed
    under the
    <a href="https://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 License</a>,
    and code samples are licensed under the
    <a href="https://www.apache.org/licenses/LICENSE-2.0">
    Apache 2.0 License</a>. For details, see the
    <a href="https://developers.google.com/terms/site-policies">
    Google Developers Site Policies</a>.
  </p>
</footer>


  </body>
</html>
