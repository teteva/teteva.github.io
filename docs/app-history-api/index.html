
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">


  
<script>
  // A global function that the theme toggle can use to apply the current theme.
  window.applyThemeSetting = function(override) {
    const currentSetting = override || localStorage.getItem('user-color-scheme');
    const currentAttribute = document.documentElement.getAttribute('data-user-theme');

    if (currentSetting && currentSetting !== currentAttribute) {
      document.documentElement.setAttribute('data-user-theme', currentSetting);
    }
  };
window.applyThemeSetting();
</script>

  
  <link rel="stylesheet" href="/css/next.css?v=bca23e175d1ab">
  <link rel="stylesheet" href="/css/legacy-rollout.css?v=cf9a764b68a3d">
  <link rel="preload" as="font" crossorigin href="/fonts/material-icons/regular.woff2">


<link rel="preload" as="font" crossorigin href="/fonts/google-sans/regular/latin.woff2">
<link rel="preload" as="font" crossorigin href="/fonts/google-sans/bold/latin.woff2">

<meta name="theme-color" content="#fff"/>




<title>Modern client-side routing: the App History API</title>
<meta name="description" content="Learn about the App History API, a new API which adds improved functionality to build single-page applications." />

<link rel="canonical" href="https://web.dev/app-history-api/" />

<meta itemprop="name" content="Modern client-side routing: the App History API" />
<meta itemprop="description" content="Learn about the App History API, a new API which adds improved functionality to build single-page applications." />
<meta itemprop="image" content="https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://web.dev/app-history-api/" />
<meta property="og:site_name" content="web.dev" />
<meta property="og:title" content="Modern client-side routing: the App History API" />
<meta property="og:description" content="Learn about the App History API, a new API which adds improved functionality to build single-page applications." />
<meta property="og:image" content="https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:image:alt" content="Sculpture adorning the General Post Office, Sydney, Australia" />
<meta property="tag" content="capabilities" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Modern client-side routing: the App History API" />
<meta name="twitter:description" content="Learn about the App History API, a new API which adds improved functionality to build single-page applications." />
<meta name="twitter:image" content="https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&fit=max&w=1200&fm=auto" />
<link
  rel="alternate"
  href="/feed.xml"
  type="application/atom+xml"
  data-title="web.dev feed"
/>

<link rel="manifest" href="/manifest.webmanifest" />

<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="mask-icon" color="#0054ff" href="/images/safari-pinned-tab.svg">



<script>
window.ga =
  window.ga ||
  function () {
    (ga.q = ga.q || []).push(arguments);
  };
ga.l = +new Date();
ga('create', 'UA-126406676-2');
ga('set', 'transport', 'beacon');
ga('set', 'anonymizeIp', true);
ga('set', 'page', window.location.pathname);
ga('set', 'dimension5', '4');
ga('send', 'pageview');
</script>







<script>
function loadScript(url, type) {
  const s = document.createElement('script');
  s.src = url;
  if (type) {
    s.type = type;
  }
  if (type === 'module') {
    s.async = false; // Preserve load order.
    const pre = document.createElement('link');
    pre.rel = 'modulepreload';
    pre.href = url;
    document.head.append(pre);
    // We use DOMContentLoaded as the loader script is running sync, and inserting a module script here doesn't defer. This brings back normal type="module" behavior.
    window.addEventListener('DOMContentLoaded', () => {
      document.head.append(s);
    });
  } else {
    document.head.append(s);
  }
}
loadScript('/js/app.js?v=ca151f725add', 'module');




  loadScript('/js/content.js?v=2367444dd05f', 'module');


  loadScript('https://www.google-analytics.com/analytics.js', null);

</script>

  </head>
  <body class="unresolved">
    
    <web-snackbar-container></web-snackbar-container>

    
<a href="#main" class="skip-link button" data-type="primary">Skip to content</a>


<web-header role="banner" class="site-header">
  <div class="cluster gutter-base">
    <button class="icon-button tooltip color-core-text md:hidden-yes" data-open-drawer-button data-alignment="right">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
      <span class="tooltip__content">Open menu</span>
    </button>
    <a href="/" class="site-header__brand brand">
      


  <svg role="img" aria-label="web.dev" xmlns="http://www.w3.org/2000/svg" width="119.79" height="22.32" viewBox="0 0 119.79 22.32"><path class="brand__text" d="M114.99 19.32h-2.2l-4.8-11.9h2.4l3.5 9.2 3.5-9.2h2.4Zm-16.8-7.3h6.8a3.17 3.17 0 0 0-3.4-2.9 3.42 3.42 0 0 0-3.4 2.9Zm3.6 7.7a6 6 0 0 1-6-6.3c0-3.6 2.5-6.3 5.9-6.3s5.8 2.4 5.8 6.5v.2h-9.3a3.88 3.88 0 0 0 3.8 3.9 3.56 3.56 0 0 0 3.3-2.1l2 1a6.22 6.22 0 0 1-5.5 3.1Zm-14 0c-3.1 0-5.7-2.8-5.7-6.3s2.6-6.3 5.7-6.3a5 5 0 0 1 4.1 2h.1l-.1-1.6v-5.5h2.2v17.3h-2.1v-1.6h-.1a5.12 5.12 0 0 1-4.1 2Zm.3-2c2.2 0 3.8-1.7 3.8-4.3s-1.6-4.3-3.8-4.3a4 4 0 0 0-3.8 4.3 4 4 0 0 0 3.8 4.3Zm-6.8.1a1.61 1.61 0 0 1-1.7 1.6 1.74 1.74 0 0 1-1.7-1.6 1.67 1.67 0 0 1 1.7-1.6 1.61 1.61 0 0 1 1.7 1.6Zm-10.5-.1a4 4 0 0 0 3.8-4.3 4 4 0 0 0-3.8-4.3c-2.2 0-3.8 1.8-3.8 4.3s1.6 4.3 3.8 4.3Zm.4 2a5 5 0 0 1-4.1-2h-.1v1.6h-2.1V2.02h2.2v5.5l-.1 1.6h.1a4.84 4.84 0 0 1 4.1-2c3.1 0 5.7 2.8 5.7 6.3s-2.6 6.3-5.7 6.3Zm-17.4-7.7h6.8a3.17 3.17 0 0 0-3.4-2.9 3.42 3.42 0 0 0-3.4 2.9Zm3.6 7.7a6 6 0 0 1-6-6.3c0-3.6 2.5-6.3 5.9-6.3s5.8 2.4 5.8 6.5v.2h-9.3a3.88 3.88 0 0 0 3.8 3.9 3.67 3.67 0 0 0 3.3-2.1l2 1a6.22 6.22 0 0 1-5.5 3.1Zm-6.3-12.2-3.8 11.9h-2.3l-3-9.1-2.9 9.1h-2.3l-3.9-11.9h2.3l2.6 9 2.9-9h2.3l2.9 9 2.6-9Z" fill="#5f6368" fill-rule="evenodd"/><path d="M0 19.28a3 3 0 0 1 3-3h16.27a3.045 3.045 0 0 1 0 6.09H3.04A3 3 0 0 1 0 19.28Z" fill="#6cf"/><path d="M.89.9a3 3 0 0 1 4.3 0l8.12 8.11a3.05 3.05 0 0 1 0 4.3l-8.12 8.12a3.04 3.04 0 1 1-4.3-4.3l5.6-5.61a.51.51 0 0 0 0-.72L.89 5.22A3 3 0 0 1 .89.9Z" fill="#06f" fill-rule="evenodd"/><path d="m10.39 16.22-5.2 5.2a3.04 3.04 0 1 1-4.3-4.3l.89-.9Z" fill="#c6f"/><circle cx="19.27" cy="19.27" r="3.04" fill="#06f"/></svg>


    </a>
  </div>
  <web-navigation-drawer type="standard">
    <nav class="site-header__nav" aria-label="main navigation" data-drawer-container>
      <a
        class="site-header__link"
        href="/learn/" data-category="Site-Wide Custom Events"
        data-label="Tab: Learn"
        >
          Learn
      </a>
      <a
        class="site-header__link"
        href="/measure/"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Measure"
        >
        Measure
      </a>
      <a
        class="site-header__link"
        href="/blog/"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Blog"
        >
        Blog
      </a>
      <a
        class="site-header__link"
        href="/tags/case-study/"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Case Studies"
        >
        Case studies
      </a>
      <a
        class="site-header__link"
        href="/about/"
        data-category="Site-Wide Custom Events"
        data-label="Tab: About" >
        About
      </a>
      <button class="icon-button tooltip color-core-text md:hidden-yes" data-drawer-close-button>
        








  










  <svg class="icon " role="img" aria-label="close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>


        <span class="tooltip__content">Close</span>
      </button>
    </nav>
  </web-navigation-drawer>
  <div class="site-header__actions cluster">
    <div class="site-header__search">
      <web-search results-id="search-main-results" i18n="{&quot;search&quot;:{&quot;en&quot;:&quot;Search&quot;},&quot;open_search&quot;:{&quot;en&quot;:&quot;Open search&quot;},&quot;all_articles&quot;:{&quot;en&quot;:&quot;All articles&quot;},&quot;close_search&quot;:{&quot;en&quot;:&quot;Close search&quot;}}"></web-search>
      <web-search-results id="search-main-results"></web-search-results>
    </div>
  </div>
</web-header>

<main id="main">
  
    
  
  





  <img     alt="Sculpture adorning the General Post Office, Sydney, Australia"     class="hero-image"     decoding="async"     height="480"               sizes="100vw"     src="https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format"     srcset="https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=200 200w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=228 228w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=260 260w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=296 296w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=338 338w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=385 385w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=439 439w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=500 500w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=571 571w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=650 650w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=741 741w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=845 845w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=964 964w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/QMjXarRXcMarxQddwrEdPvHVM242/aDcKXxmGtrMVmwZK43Ta.jpg?auto=format&w=1600 1600w"          width="1600"   />


<div class="post wrapper" data-flush>
  
    
    
    
  
  

  <div class="sidebar region flex-align-start flex-dir-rev flex-wrap-no">
    

  <nav class="course__toc toc over-scroll hidden-yes xl:hidden-no" data-type="side" aria-label="On this page">
    <div class="course-toc__heading font-google-sans weight-medium">On this page</div>
    <web-scroll-spy>
      <div class="toc__wrapper flow-recursive">
        <ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#example-usage">Example Usage</a></li><li class="toc__listitem"><a class="toc__anchor" href="#why-another-event-handler">Why another event handler?</a></li><li class="toc__listitem"><a class="toc__anchor" href="#transition">Transition</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#transition-success-and-failure">Transition Success and Failure</a></li><li class="toc__listitem"><a class="toc__anchor" href="#transition-context-and-rollback">Transition Context and Rollback</a></li><li class="toc__listitem"><a class="toc__anchor" href="#abort-signals">Abort Signals</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="#app-history-entries">App History Entries</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#state">State</a></li><li class="toc__listitem"><a class="toc__anchor" href="#access-all-entries">Access All Entries</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="#examples">Examples</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#programmatic-navigation">Programmatic Navigation</a></li><li class="toc__listitem"><a class="toc__anchor" href="#form-submissions">Form Submissions</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="#what's-missing">What's missing?</a></li><li class="toc__listitem"><a class="toc__anchor" href="#try-the-app-history-api">Try the App History API</a></li><li class="toc__listitem"><a class="toc__anchor" href="#references">References</a></li><li class="toc__listitem"><a class="toc__anchor" href="#acknowledgements">Acknowledgements</a></li></ul>
      </div>
    </web-scroll-spy>
  </nav>


    
    <article class="prose legacy-rollout">
      <header class="flow gap-bottom-size-3">
        
          <nav class="breadcrumbs" aria-label="breadcrumbs">
            <ul class="breadcrumbs__list" role="list">
              <li>
                <a
                  class="gc-analytics-event"
                  data-category="web.dev"
                  data-label="post, home breadcrumb"
                  data-action="click"
                  href="/"
                >
                  Home
                </a>
              </li>
              
              <li>
                <a
                  class="gc-analytics-event"
                  data-category="web.dev"
                  data-label="post, path breadcrumb"
                  data-action="click"
                  href="/blog"
                >
                  All articles
                </a>
              </li>
              
            </ul>
          </nav>
        

        <h1 id="modern-client-side-routing:-the-app-history-api">Modern client-side routing: the App History API</h1>
        
          <p class="color-mid-text flow-space-base">
            Standardizing client-side routing through a brand new API which completely overhauls building single-page applications.
          </p>
        

        
          <div class="flow-space-size-1 color-mid-text text-size-0">
            <time>Aug 25, 2021</time>
             — Updated <time>Sep 20, 2021</time> 
          </div>
        

        
        

        

        
          <div class="cluster flow-space-size-2">
            
              <div class="author">
  <a class="avatar" href="/authors/samthor/"> <img     alt="Sam Thorogood"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/XQIDJD6narW2eA4d141g.jpg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/admin/XQIDJD6narW2eA4d141g.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/admin/XQIDJD6narW2eA4d141g.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/admin/XQIDJD6narW2eA4d141g.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/admin/XQIDJD6narW2eA4d141g.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/admin/XQIDJD6narW2eA4d141g.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /> </a>
  <div class="flow">
    <cite class="author__name">
      <a href="/authors/samthor/">Sam Thorogood</a>
    </cite>
    <div class="author__links cluster">
               <a href="https://twitter.com/samthor">Twitter</a>
               <a href="https://github.com/samthor">GitHub</a>
               <a href="https://glitch.com/@samthor">Glitch</a>
               <a href="https://whistlr.info/">Homepage</a>
             </div>
  </div>
</div>
            
          </div>
        
      </header>

      

      

  

  <div class="xl:hidden-yes flow-space-size-1">
    <details data-type="inner" role="navigation" aria-label="On this page">
      <summary>
        On this page
      </summary>
      <div class="toc"><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#example-usage">Example Usage</a></li><li class="toc__listitem"><a class="toc__anchor" href="#why-another-event-handler">Why another event handler?</a></li><li class="toc__listitem"><a class="toc__anchor" href="#transition">Transition</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#transition-success-and-failure">Transition Success and Failure</a></li><li class="toc__listitem"><a class="toc__anchor" href="#transition-context-and-rollback">Transition Context and Rollback</a></li><li class="toc__listitem"><a class="toc__anchor" href="#abort-signals">Abort Signals</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="#app-history-entries">App History Entries</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#state">State</a></li><li class="toc__listitem"><a class="toc__anchor" href="#access-all-entries">Access All Entries</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="#examples">Examples</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#programmatic-navigation">Programmatic Navigation</a></li><li class="toc__listitem"><a class="toc__anchor" href="#form-submissions">Form Submissions</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="#what's-missing">What's missing?</a></li><li class="toc__listitem"><a class="toc__anchor" href="#try-the-app-history-api">Try the App History API</a></li><li class="toc__listitem"><a class="toc__anchor" href="#references">References</a></li><li class="toc__listitem"><a class="toc__anchor" href="#acknowledgements">Acknowledgements</a></li></ul></div>
    </details>
  </div>



      <p>Single-page applications, or SPAs, are defined by a core feature: dynamically rewriting their content as the user interacts with the site, instead of the default method of loading entirely new pages from the server.</p>
<p>While SPAs have been able to bring you this feature via the History API (or in limited cases, by adjusting the site's #hash part), it's a <a href="https://html5doctor.com/interview-with-ian-hickson-html-editor/#:~:text=My%20biggest%20mistake%E2%80%A6there%20are%20so%20many%20to%20choose%20from!%20pushState()%20is%20my%20favourite%20mistake" rel="noopener">clunky API</a> developed long-before SPAs were the norm—and the web is crying out for a completely new approach.
The App History API is a proposed API that completely overhauls this space, rather than trying to simply patch History API's rough edges.
(For example, <a href="https://developers.google.com/web/updates/2015/09/history-api-scroll-restoration" rel="noopener">Scroll Restoration</a> patched the History API rather than trying to reinvent it.)</p>
<aside class="aside flow bg-state-info-bg color-state-info-text">
<div class=" flow">
<p>The App History API is currently in development, and available in Chrome 95 and beyond behind the &quot;Experimental Web Platform features&quot; flag.
<a href="https://gigantic-honored-octagon.glitch.me/" rel="noopener">Check out a demo here</a>.</p>
</div></aside>
<p>This post describes the App History API at a high level.
If you'd like to read the technical proposal, <a href="https://wicg.github.io/app-history/" rel="noopener">check out the Draft Report in the WICG repository</a>.</p>
<h2 id="example-usage">Example Usage <a class="w-headline-link" href="#example-usage">#</a></h2>
<p>To use the App History API, start by adding a &quot;navigate&quot; handler for the <code>AppHistoryNavigationEvent</code> event on the global <code>appHistory</code> object.
This event is fundamentally <em>centralized</em>: it will fire for all types of navigations, whether because the user performed an action (such as clicking a link, submitting a form, or going back and forward) or when navigation is triggered programmatically (i.e., via your site's code).
In most cases, it lets your code override the browser's default behavior for that action.
For SPAs, that likely means keeping the user on the same page and loading or changing the site's content.</p>
<aside class="aside flow bg-state-info-bg color-state-info-text">
<div class=" flow">
<p>This new event is very loosely analogous to the History API's &quot;popstate&quot; event, although way more powerful.
Read on to find out more!</p>
</div></aside>
<p>The specific <code>AppHistoryNavigationEvent</code> passed to the &quot;navigate&quot; event handler contains information about the navigation, such as the destination URL, and allows you to respond to the navigation in one centralized place.
A basic implementation for the handler, on example.com, could look like this:</p>
<web-copy-code><pre class="language-js"><code class="language-js">appHistory<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"navigate"</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>destination<span class="token punctuation">.</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">case</span> <span class="token string">'https://example.com/'</span><span class="token operator">:</span><br>      event<span class="token punctuation">.</span><span class="token function">transitionWhile</span><span class="token punctuation">(</span><span class="token function">loadIndexPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">break</span><span class="token punctuation">;</span><br>    <span class="token keyword">case</span> <span class="token string">'https://example.com/cats'</span><span class="token operator">:</span><br>      event<span class="token punctuation">.</span><span class="token function">transitionWhile</span><span class="token punctuation">(</span><span class="token function">loadCatsPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">break</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p>You can handle the event in one of two ways:</p>
<ul>
<li>by calling <code>transitionWhile()</code> (as described above) to handle the navigation</li>
<li>by calling <code>preventDefault()</code>, which can cancel the navigation completely</li>
</ul>
<p>This example calls <code>transitionWhile()</code> on the event with a promise generated from async helper functions.
By calling this method with a response, the browser knows that your code needs to run to configure the next state of your site.
This will create a transition object, which tracks the success or failure of the <code>Promise</code>.
For example, it might reject because the user's browser is offline.</p>
<p>Both <code>transitionWhile()</code> and <code>preventDefault()</code> are usually allowed, but have cases where they're unable to be called.
You can't handle navigations via <code>transitionWhile()</code> if the navigation is a cross-origin navigation: i.e., if it's leaving your domain.
And you can't cancel a navigation via <code>preventDefault()</code> if the user is pressing the Back or Forward buttons in their browser; you should not be able to trap your users on your site.
(This is <a href="https://github.com/WICG/app-history/issues/32" rel="noopener">being discussed on GitHub</a>.)</p>
<p>Even if you can't stop or intercept the navigation itself, the &quot;navigate&quot; event handler will still fire.
It's <em>informative</em>, so your code could, e.g., log an Analytics event to indicate that a user is leaving your site.</p>
<h2 id="why-another-event-handler">Why another event handler? <a class="w-headline-link" href="#why-another-event-handler">#</a></h2>
<p>The &quot;navigate&quot; event handler centralizes handling URL changes inside a SPA.
This is a difficult proposition using older APIs.
If you've ever written the routing for your own SPA using the History API, you might have added code like this:</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">updatePage</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// we're handling this link</span><br>  window<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// TODO: set up page based on new URL</span><br><span class="token punctuation">}</span><br><span class="token keyword">const</span> links <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'a[href]'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>links<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">link</span> <span class="token operator">=></span> link<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> updatePage<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p>This is fine, but not exhaustive.
Links might come and go on your page, and they're not the only way users can navigate through pages.
E.g., they may submit a form or even use an <a href="https://developer.mozilla.org/docs/Web/HTML/Element/map" rel="noopener">image map</a>.
Your page might deal with these, but there's a long tail of possibilities which could just be simplified—something that the new App History API achieves.</p>
<p>Personally, the History API often <em>feels</em> like it could go some way to help with these possibilities.
However, it really only has two surface areas: responding if the user presses Back or Forward in their browser, plus pushing and replacing URLs.
It doesn't have an analogy to &quot;navigate&quot;, except if you manually set up listeners for, e.g., click events, as demonstrated above.</p>
<h2 id="transition">Transition <a class="w-headline-link" href="#transition">#</a></h2>
<p>When your code calls <code>transitionWhile()</code> from within its &quot;navigate&quot; handler, it informs the browser that it's now preparing the page for the new, updated state; and that the navigation may take some time (because the call accepts a <code>Promise</code>).</p>
<p>As such, this API introduces a semantic concept that the browser understands: a SPA navigation is currently occurring, over time, changing the document from a previous URL and state to a new one.
This has a number of potential benefits, including that of accessibility: browsers can surface the beginning, end, or potential failure of a navigation in a variety of ways.
Chrome, for example, intends to <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=1241202" rel="noopener">reactivate its native loading indicator</a> during this time.</p>
<h3 id="transition-success-and-failure">Transition Success and Failure <a class="w-headline-link" href="#transition-success-and-failure">#</a></h3>
<p>After the &quot;navigate&quot; handler completes normally, the URL being navigated to will take effect.
This happens immediately, even if you've called <code>transitionWhile()</code>.
But if you have called it with a <code>Promise</code>, one of two things will happen:</p>
<ul>
<li>If that succeeds (or you did not call <code>transitionWhile()</code>), the App History API will fire &quot;navigatesuccess&quot; with an <code>Event</code>.</li>
<li>If the <code>Promise</code> rejects, the API will fire &quot;navigateerror&quot; with an <code>ErrorEvent</code>.</li>
</ul>
<p>These events allow your code to deal with success or failure in a centralized way.
For example, you might deal with success by hiding a previously displayed progress indicator, like this:</p>
<web-copy-code><pre class="language-js"><code class="language-js">appHistory<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'navigatesuccess'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  loadingIndicator<span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p>Or you might show an error message on failure (i.e., if the <code>Promise</code> passed to <code>transitionWhile</code> rejected):</p>
<web-copy-code><pre class="language-js"><code class="language-js">appHistory<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'navigateerror'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  loadingIndicator<span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// also hide indicator</span><br>  <span class="token function">showMessage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to load page: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p>The &quot;navigateerror&quot; event handler, which receives an <code>ErrorEvent</code>, is particularly handy as it's guaranteed to receive any errors from your code that's setting up a new page.
You can simply <code>await fetch()</code> knowing that if the network is unavailable, the error will eventually be routed to &quot;navigateerror&quot;.</p>
<h3 id="transition-context-and-rollback">Transition Context and Rollback <a class="w-headline-link" href="#transition-context-and-rollback">#</a></h3>
<p>During the period between the initial &quot;navigate&quot; event and the exact time these terminal events fire, there'll also be an object available that gives some context on the navigation that's occurring.
It's available at <code>appHistory.transition</code>.
You're able to use this object to <em>rollback</em> this navigation, pretending as if the navigation never occurred.
Your site might choose to do this in response to a user action, or perhaps if the loaded URL is invalid and should never appear in the user's history.
For example:</p>
<web-copy-code><pre class="language-js"><code class="language-js">appHistory<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'navigateerror'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> attemptedLoadURL <span class="token operator">=</span> location<span class="token punctuation">.</span>href<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> previousURL <span class="token operator">=</span> appHistory<span class="token punctuation">.</span>transition<span class="token punctuation">.</span>from<span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Failed to load'</span><span class="token punctuation">,</span> attemptedLoadURL<span class="token punctuation">,</span> <span class="token string">'returning to'</span><span class="token punctuation">,</span> previousURL<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  appHistory<span class="token punctuation">.</span>transition<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p>Like many of the features in the App History API, this call to <code>rollback()</code> is a semantic action that implies meaning to the browser.
If a clicked <code>&lt;a href&gt;</code> fails to load and rolls back, the URL won't appear in the user's session history (for Forward or Back navigation).</p>
<aside class="aside flow bg-state-info-bg color-state-info-text">
<div class=" flow">
<p>Although calling <code>rollback()</code> on error is useful in some situations, you should avoid it in the general case.
You're more likely to show an error message, perhaps so the user can try a reload to get their content.</p>
</div></aside>
<h3 id="abort-signals">Abort Signals <a class="w-headline-link" href="#abort-signals">#</a></h3>
<p>Since you're able to do asynchronous work while preparing a new page, it's possible that the transition your code is handling (to load a specific URL or state) might get preempted, or considered out-of-date.
This might happen because the <code>rollback()</code> method was invoked, the user just clicked on another link, or your code itself throws an error.</p>
<p>To deal with any of these possibilities, the event passed to the &quot;navigate&quot; handler contains a property called <code>signal</code>, which is an instance of <code>AbortSignal</code>.
For more information see <a href="https://developers.google.com/web/updates/2017/09/abortable-fetch" rel="noopener">Abortable fetch</a>.
The short version is it basically provides an object that fires an event when you should stop your work.
Notably, you can pass an <code>AbortSignal</code> to any calls you make to <code>fetch()</code>, which will cancel in-flight network requests if the navigation is preempted.
This will both save the user's bandwidth, and reject the <code>Promise</code> returned by <code>fetch()</code>, preventing any following code from e.g., updating the DOM to show a now invalid page navigation.</p>
<p>For a concrete example, you might set up loading a page of cat memes with a <code>fetch()</code> call in your handler.
By passing the <code>signal</code> to it, the fetch will be cancelled if the user decides to instead load a different page on your site before the <code>fetch</code> completes.
Take a look:</p>
<web-copy-code><pre class="language-js"><code class="language-js">appHistory<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"navigate"</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isCatsUrl</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>destination<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> <span class="token function-variable function">method</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/cat-memes.json'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> signal<span class="token operator">:</span> event<span class="token punctuation">.</span>signal <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> json <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// TODO: do something with cat memes json</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    event<span class="token punctuation">.</span><span class="token function">transitionWhile</span><span class="token punctuation">(</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    <span class="token comment">// load some other page</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><h2 id="app-history-entries">App History Entries <a class="w-headline-link" href="#app-history-entries">#</a></h2>
<p>The <code>AppHistory</code> interface provides the current entry through its <code>current</code> property.
This is an object which describes where the user is right now.
This entry includes the current URL, metadata that can be used to identify this entry over time, and developer-provided state.</p>
<aside class="aside flow bg-state-info-bg color-state-info-text">
<div class=" flow">
<p>Even sites that do not explicitly use the App History API will have a &quot;current entry&quot;, and the entry is even updated or replaced if you use the older methods in the History API, <code>history.pushState()</code> and <code>history.replaceState()</code>, respectively.</p>
</div></aside>
<p>The metadata includes <code>key</code>, a unique string property of each entry which represents the current entry and its <em>slot</em>.
This key remains the same even if the current entry's URL or state changes.
It's still in the same slot.
Conversely, if a user presses Back and then re-opens the same page, <code>key</code> will change as this new entry creates a new slot.</p>
<p>To a developer, &quot;key&quot; is useful because the App History API allows you to directly navigate the user to an entry with a matching key.
You're able to hold onto it, even in the states of other entries, in order to easily jump between pages.</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token comment">// On JS startup, get the key of the first loaded page</span><br><span class="token comment">// so the user can always go back there.</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span> key <span class="token punctuation">}</span> <span class="token operator">=</span> appHistory<span class="token punctuation">.</span>current<span class="token punctuation">;</span><br>backToHomeButton<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> appHistory<span class="token punctuation">.</span><span class="token function">goTo</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Navigate away, but the button will always work.</span><br><span class="token keyword">await</span> appHistory<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token string">'/another_url'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>finished<span class="token punctuation">;</span></code></pre>
</web-copy-code><h3 id="state">State <a class="w-headline-link" href="#state">#</a></h3>
<p>The App History API surfaces a notion of &quot;state&quot;, which is developer-provided information that is stored persistently on the current history entry, but which isn't directly visible to the user.
This is extremely similar to but improved from <code>history.state</code> in the History API.</p>
<p>In the App History API, you can call the <code>AppHistoryEntry.getState()</code> method of the current entry (or any entry) to return a copy of its state.
By default, this will be <code>undefined</code>.
You can synchronously set the state for the current <code>AppHistoryEntry</code> by calling:</p>
<web-copy-code><pre class="language-js"><code class="language-js">appHistory<span class="token punctuation">.</span><span class="token function">updateCurrent</span><span class="token punctuation">(</span><span class="token punctuation">{</span> state<span class="token operator">:</span> something <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p>You can also set the state when navigating programmatically with <code>appHistory.navigate()</code> (this is <a href="#programmatic-navigation">described below</a>).</p>
<p>In the App History API, the state returned from <code>.getState()</code> is a copy of the previously set state.
If you modify it, the stored version won't also change.
For example:</p>
<web-copy-code><pre class="language-js"><code class="language-js">appHistory<span class="token punctuation">.</span><span class="token function">updateCurrent</span><span class="token punctuation">(</span><span class="token punctuation">{</span> state<span class="token operator">:</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> state <span class="token operator">=</span> appHistory<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>state<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><br><br>console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>appHistory<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// count will still be one</span></code></pre>
</web-copy-code><h3 id="access-all-entries">Access All Entries <a class="w-headline-link" href="#access-all-entries">#</a></h3>
<p>The &quot;current entry&quot; is not all, though.
The API also provides a way to access the entire list of entries that a user has navigated through while using your site via its <code>appHistory.entries()</code> call, which returns a snapshot array of entries.
This could be used to, e.g., show a different UI based on how the user navigated to a certain page, or just to look back at the previous URLs or their states.
This is impossible with the current History API.</p>
<p>It's possible to handle events on <code>AppHistoryEntry</code>.
These events include &quot;dispose&quot; (if the entry is no longer accessible), along with &quot;navigateto&quot; and &quot;navigatefrom&quot;.
For example, you might add a &quot;navigatefrom&quot; handler to clean up some state when the user leaves a specific page (either by forward navigation or their Back or Forward button).</p>
<h2 id="examples">Examples <a class="w-headline-link" href="#examples">#</a></h2>
<p>The &quot;navigate&quot; event fires for all types of navigations, as mentioned above.
(There's actually a <a href="https://github.com/WICG/app-history#appendix-types-of-navigations" rel="noopener">long appendix in the spec</a> of all possible types.)</p>
<p>While for many sites the most common case will be when the user clicks a <code>&lt;a href=&quot;...&quot;&gt;</code>, there are two notable, more complex navigation types that are worth covering.</p>
<h3 id="programmatic-navigation">Programmatic Navigation <a class="w-headline-link" href="#programmatic-navigation">#</a></h3>
<p>First is programmatic navigation, where navigation is caused by a method call inside your client-side code.</p>
<p>You can call <code>appHistory.navigate('/another_page')</code> from anywhere in your code to cause a navigation.
This will be handled by the centralized event handler registered on the &quot;navigate&quot; handler, and your centralized handler will be called synchronously.</p>
<p>This is intended as an improved aggregation of older methods like <code>location.assign()</code> and friends, plus the History API's methods <code>pushState()</code> and <code>replacestate()</code>.</p>
<aside class="aside flow bg-state-info-bg color-state-info-text">
<div class=" flow">
<p>These older programmatic methods for changing the URL are all still supported with the App History API and now fire the &quot;navigate&quot; handler.
That is, they're also handled centrally.
Their signatures aren't modified in any way (i.e., they won't now return a <code>Promise</code>) by this new specification, and we imagine that in an older codebase, they'll be replaced by calls to <code>.navigate()</code> over time.</p>
</div></aside>
<p>The <code>AppHistory.navigate()</code> method returns a object which contains two <code>Promise</code> instances in <code>{ committed, finished }</code>.
This allows the invoker can wait until either the transition is &quot;committed&quot; (the visible URL has changed and a new <code>AppHistoryEntry</code> is available) or &quot;finished&quot; (all promises passed to <code>transitionWhile()</code> are complete—or rejected, due to failure or being preempted by another navigation).</p>
<p>The <code>navigate</code> method also has an optional options object which controls how the navigation will occur.
These options will allow you to <code>replace</code> the current URL, set a new immutable <code>state</code> (to be made available via <code>AppHistoryEntry.getState()</code>), and configure <code>AppHistoryNavigateEvent.info</code>.</p>
<p>The <code>info</code> property is worth calling out.
It allows you to pass transient information about this specific navigation event into the &quot;navigate&quot; handler.
This could be useful to, for example, denote a particular animation that causes the next page to appear.
(The alternative might be to set a global variable or include it as part of the #hash. Both options are a bit awkward.)
Notably, this <code>info</code> won't be replayed if a user later causes navigation, e.g., via their Back and Forward buttons.
In fact, it will always be <code>undefined</code> in those cases.</p>
<figure class="w-figure w-figure--fullbleed">
  <video      autoplay            class="w-screenshot"                  height="320"            loop      muted                        width="320"    >      <source src="https://storage.googleapis.com/web-dev-uploads/video/QMjXarRXcMarxQddwrEdPvHVM242/UGyXlkr5Cbn3Db84FwqU.mov" type="video/mp4" />    </video>
  <figcaption class="w-figure">
    <a href="https://wiry-tricolor-lipstick.glitch.me" target="_blank">Demo of opening from left or right</a>
  </figcaption>
</figure>
<p>The <code>AppHistory</code> interface also has a number of other navigation methods, all which return an object containing <code>{ committed, finished }</code>.
I've already mentioned <code>goTo()</code> (which accepts a <code>key</code> that denotes a specific entry in the user's history) and <code>navigate()</code>.
It also includes <code>back()</code>, <code>forward()</code> and <code>reload()</code>.
These methods are all handled—just like <code>navigate()</code>—by the centralized &quot;navigate&quot; event handler.</p>
<h3 id="form-submissions">Form Submissions <a class="w-headline-link" href="#form-submissions">#</a></h3>
<p>Secondly, HTML <code>&lt;form&gt;</code> submission via POST is a special type of navigation, and the App History API can intercept it.
While it includes an additional payload, the navigation is still handled centrally by the &quot;navigate&quot; handler.</p>
<p>Form submission can be detected by looking for the <code>formData</code> property on the <code>AppHistoryNavigateEvent</code>.
Here's an example that simply turns any form submission into one which stays on the current page via <code>fetch()</code>:</p>
<web-copy-code><pre class="language-js"><code class="language-js">appHistory<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"navigate"</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>formData <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span>canTransition<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// User submitted a POST form to a same-domain URL</span><br>    <span class="token comment">// (If canTransition is false, the event is just informative:</span><br>    <span class="token comment">// you can't intercept this request, although you could</span><br>    <span class="token comment">// likely still call .preventDefault() to stop it completely).</span><br><br>    <span class="token keyword">const</span> <span class="token function-variable function">submitToServer</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>destination<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> body<span class="token operator">:</span> event<span class="token punctuation">.</span>formData <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// You could navigate again with {replace: true} to change the URL here,</span><br>      <span class="token comment">// which might indicate "done"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    event<span class="token punctuation">.</span><span class="token function">transitionWhile</span><span class="token punctuation">(</span><span class="token function">submitToServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><h2 id="what's-missing">What's missing? <a class="w-headline-link" href="#what's-missing">#</a></h2>
<p>Despite the centralized nature of the &quot;navigate&quot; event handler, the current App History API specification doesn't trigger &quot;navigate&quot; on a page's first load.
And for sites which use <a href="https://developers.google.com/web/updates/2019/02/rendering-on-the-web#terminology" rel="noopener">Server Side Rendering</a> (SSR) for all states, this might be fine—your server could return the correct initial state, which is the fastest way to get content to your users.
But sites that leverage client-side code to create their pages may need to create an additional function to initialize their page.
This is up for discussion <a href="https://github.com/WICG/app-history/issues/31" rel="noopener">in the app-history repo</a>.</p>
<p>Another intentional design choice of the App History API is that it operates only within a single frame—that is, the top-level page, or a single specific <code>&lt;iframe&gt;</code>.
This has a number of interesting implications that are <a href="https://github.com/WICG/app-history#warning-backforward-are-not-always-opposites" rel="noopener">further documented in the spec</a>, but in practice, will reduce developer confusion.
The previous History API has a number of confusing edge cases, like support for frames, and the reimagined App History API handles these edge cases from the get-go.</p>
<aside class="aside flow bg-state-info-bg color-state-info-text">
<div class=" flow">
<p>In the near future, it's hoped that <a href="https://github.com/whatwg/html/issues/6501" rel="noopener">an unrelated change to the HTML spec</a> could introduce &quot;historyless&quot; IFrames which do not participate in the browser's history.
IFrames which change their URLs have classically confused both developers and users because these changes have no effect on the user's URL bar or overall page title.
So, e.g., a user pressing Back or Forward in their browser might not see an immediately obvious effect.</p>
</div></aside>
<p>Lastly, there's not yet consensus on programmatically modifying or rearranging the list of entries the user has navigated through.
This is <a href="https://github.com/WICG/app-history/issues/9" rel="noopener">currently under discussion</a>, but one option could be to allow only deletions: either historic entries or &quot;all future entries&quot;.
The latter would allow temporary state.
E.g., as a developer, I could:</p>
<ul>
<li>ask the user a question by navigating to new URL or state</li>
<li>allow the user to complete their work (or go Back)</li>
<li>remove a history entry on completion of a task</li>
</ul>
<p>This could be perfect for temporary modals or interstitals: the new URL is something that a user can use the Back gesture to leave from, but they then cannot accidentaly go Forward to open it again (because the entry has been removed).
This is just not possible with the current History API.</p>
<h2 id="try-the-app-history-api">Try the App History API <a class="w-headline-link" href="#try-the-app-history-api">#</a></h2>
<p>You can try the App History API in Chrome 95 and above by enabling the &quot;Experimental Web Platform features&quot; flag.
You can also <a href="https://gigantic-honored-octagon.glitch.me/" rel="noopener">try out a demo</a> by <a href="https://web.dev/authors/domenic/">Domenic Denicola</a>.</p>
<p>We're especially eager for feedback on issues labelled with <a href="https://github.com/WICG/app-history/issues?q=is%3Aissue+is%3Aopen+label%3A%22feedback+wanted%22" rel="noopener">&quot;feedback wanted&quot;</a> on GitHub.
You can also check out the repo and spec more generally at <a href="https://github.com/WICG/app-history" rel="noopener">https://github.com/WICG/app-history</a>, including filing new issues.</p>
<p>While the classic History API appears straightforward, it's not very well-defined and has <a href="https://github.com/whatwg/html/issues?q=is%3Aissue+is%3Aopen+history" rel="noopener">a large number of issues</a> around corner cases and how it has been implemented differently across browsers.
We hope you consider providing feedback on the new App History API.</p>
<h2 id="references">References <a class="w-headline-link" href="#references">#</a></h2>
<ul>
<li><a href="https://github.com/WICG/app-history" rel="noopener">WICG/app-history</a></li>
<li><a href="https://github.com/mozilla/standards-positions/issues/543" rel="noopener">Mozilla Standards Position</a></li>
<li><a href="https://groups.google.com/a/chromium.org/g/blink-dev/c/R1D5xYccqb0/m/8ukfzdVSAgAJ?utm_medium=email&amp;utm_source=footer" rel="noopener">Intent To Prototype</a></li>
<li><a href="https://github.com/w3ctag/design-reviews/issues/605" rel="noopener">TAG review</a></li>
<li><a href="https://chromestatus.com/features/6232287446302720" rel="noopener">Chromestatus entry</a></li>
</ul>
<h2 id="acknowledgements">Acknowledgements <a class="w-headline-link" href="#acknowledgements">#</a></h2>
<p>Thanks to <a href="https://web.dev/authors/thomassteiner/">Thomas Steiner</a>, <a href="https://web.dev/authors/domenic/">Domenic Denicola</a> and Nate Chapin for reviewing this post.
Hero image from <a href="https://unsplash.com/photos/bGYguEqV2lk" rel="noopener">Unsplash</a>, by <a href="https://unsplash.com/@jeremybezanger" rel="noopener">Jeremy Zero</a>.</p>


      

      <div class="cluster gutter-base flow-space-size-2" role="list" aria-label="tags">
        
          
        
          
        
          
            
            <a class="pill" href="/tags/capabilities/">Capabilities</a>
          
        
      </div>

      <div class="text-size-0 color-mid-text">
        <span>
          
          Last updated: <time>Sep 20, 2021</time>
          
        </span>
        —
        <a
          href="https://github.com/GoogleChrome/web.dev/blob/main/src/site/content/en/blog/app-history-api/index.md"
        >
          Improve article
        </a>
      </div>

      

      
        
        
      

      
        <div class="flow-space-size-2">
          <a href="/blog" class="button" data-type="secondary">
            <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>

            <span>Return to all articles</span>
          </a>
        </div>
      
      <div class="docked-actions flow flow-space-base">    
        <div>
          <share-action class="gc-analytics-event fab"
            authors="@samthor"
            data-category="web.dev"
            data-label="share"
            data-action="click"
            data-type="primary"
            data-icon="share"
            tabindex="0"
            role="button"
          >
            <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M18 16.1c-.8 0-1.4.3-2 .8l-7.1-4.2c.1-.2.1-.5.1-.7s0-.5-.1-.7L16 7.2c.5.5 1.2.8 2 .8 1.7 0 3-1.3 3-3s-1.3-3-3-3-3 1.3-3 3c0 .2 0 .5.1.7L8 9.8C7.5 9.3 6.8 9 6 9c-1.7 0-3 1.3-3 3s1.3 3 3 3c.8 0 1.5-.3 2-.8l7.1 4.2c-.1.2-.1.4-.1.6 0 1.6 1.3 2.9 2.9 2.9s2.9-1.3 2.9-2.9-1.2-2.9-2.8-2.9z" fill="currentColor"/></svg>
 
            <span class="fab__label">Share</span>
          </share-action>
        </div>
        
      </div>
    </article>
  </div>
</div>


</main>
<footer class="site-footer" role="contentinfo">
  <nav class="site-footer__primary-nav auto-grid" aria-label="footer navigation">
    <div>
      <h3 class="text-size-2 color-mid-text">Contribute</h3>
      <ul class="w-footer__linkbox-list" role="list">
        <li>
          <a href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&labels=bug&template=bug_report.md&title="
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
            File a bug
          </a>
        </li>
        <li>
          <a href="https://github.com/googlechrome/web.dev"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
            View source
          </a>
        </li>
      </ul>
    </div>
    <div>
      <h3 class="text-size-2 color-mid-text">Related content</h3>
      <ul class="w-footer__linkbox-list" role="list">
          <li>
          <a href="https://developer.chrome.com/"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
            developer.chrome.com
          </a>
        </li>
        <li>
          <a href="https://blog.chromium.org/"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
            Chrome updates
          </a>
        </li>
        <li>
          <a href="https://developers.google.com/web/fundamentals"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
            Web Fundamentals
          </a>
        </li>
        <li>
          <a href="/tags/case-study/"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">
            Case studies
          </a>
        </li>
        <li>
          <a href="/podcasts/"
            data-category="Podcasts" data-label="Footer Link (index 5)">
            Podcasts
          </a>
        </li>
        <li>
          <a href="/shows/"
            data-category="Shows" data-label="Footer Link (index 6)">
            Shows
          </a>
        </li>
      </ul>
    </div>
    <div>
      <h3 class="text-size-2 color-mid-text">Connect</h3>
      <ul class="w-footer__linkbox-list" role="list">
        <li>
          <a href="https://www.twitter.com/ChromiumDev"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
            Twitter
          </a>
        </li>
        <li>
          <a href="https://www.youtube.com/user/ChromeDevelopers"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
            YouTube
          </a>
        </li>
      </ul>
    </div>
  </nav>
  <nav class="site-footer__brand-nav repel" aria-label="Google developers">
    <ul class="cluster" role="list">
      <li>
        <a href="https://developers.google.com/" data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link">
          <img loading="lazy" width="185" height="33" class="w-footer__utility-logo" src="/images/lockup-color.png"
            alt="Google Developers" />
        </a>
      </li>
      <li>
        <a href="https://developer.chrome.com/"
          data-category="Site-Wide Custom Events" data-label="Footer Chrome Link">
          Chrome
        </a>
      </li>
      <li>
        <a href="https://firebase.google.com/" data-category="Site-Wide Custom Events"
          data-label="Footer Firebase Link">
          Firebase
        </a>
      </li>
      <li>
        <a href="https://cloud.google.com/" data-category="Site-Wide Custom Events"
          data-label="Footer Google Cloud Platform Link">
          Google Cloud Platform
        </a>
      </li>
      <li>
        <a href="https://developers.google.com/products"
          data-category="Site-Wide Custom Events" data-label="Footer All products Link">
          All products
        </a>
      </li>
    </ul>
    <web-language-select current="en"></web-language-select>
  </nav>
  <nav class="site-footer__misc-links" aria-label="terms and policies">
    <ul class="cluster" role="list">
      <li>
        <a href="https://policies.google.com/" data-category="Site-Wide Custom Events"
          data-label="Footer Terms and Privacy link">
          Terms &amp; Privacy
        </a>
      </li>
      <li>
        <a href="/community-guidelines/" data-category="Site-Wide Custom Events"
          data-label="Footer Community Guidelines link">
          Community Guidelines
        </a>
      </li>
    </ul>
  </nav>
  <p class="gap-top-size-2 text-size-0">
    Except as otherwise noted, the content of this page is licensed
    under the
    <a href="https://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 License</a>,
    and code samples are licensed under the
    <a href="https://www.apache.org/licenses/LICENSE-2.0">
    Apache 2.0 License</a>. For details, see the
    <a href="https://developers.google.com/terms/site-policies">
    Google Developers Site Policies</a>.
  </p>
</footer>


  </body>
</html>
