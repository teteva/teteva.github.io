
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">


  
    
    <link rel="stylesheet" href="/css/main.css?v=93e179257a317">
  

  <link rel="preload" as="font" crossorigin href="/fonts/material-icons/regular.woff2">


<link rel="preload" as="font" crossorigin href="/fonts/google-sans/regular/latin.woff2">
<link rel="preload" as="font" crossorigin href="/fonts/google-sans/bold/latin.woff2">

<meta name="theme-color" content="#fff"/>




<title>Service worker caching and HTTP caching</title>
<meta name="description" content="The pros and cons of using consistent or different expiry logic across the service worker cache and HTTP cache layers. " />

<link rel="canonical" href="https://web.dev/service-worker-caching-and-http-caching/" />

<meta itemprop="name" content="Service worker caching and HTTP caching" />
<meta itemprop="description" content="The pros and cons of using consistent or different expiry logic across the service worker cache and HTTP cache layers. " />
<meta itemprop="image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://web.dev/service-worker-caching-and-http-caching/" />
<meta property="og:site_name" content="web.dev" />
<meta property="og:title" content="Service worker caching and HTTP caching" />
<meta property="og:description" content="The pros and cons of using consistent or different expiry logic across the service worker cache and HTTP cache layers. " />
<meta property="og:image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:image:alt" content="" />
<meta property="tag" content="network" />
<meta property="tag" content="service-worker" />
<meta property="tag" content="offline" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Service worker caching and HTTP caching" />
<meta name="twitter:description" content="The pros and cons of using consistent or different expiry logic across the service worker cache and HTTP cache layers. " />
<meta name="twitter:image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<link
  rel="alternate"
  href="/feed.xml"
  type="application/atom+xml"
  data-title="web.dev feed"
/>

<link rel="manifest" href="/manifest.webmanifest" />

<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="mask-icon" color="#0054ff" href="/images/safari-pinned-tab.svg">



<script>
window.ga =
  window.ga ||
  function () {
    (ga.q = ga.q || []).push(arguments);
  };
ga.l = +new Date();
ga('create', 'UA-126406676-2');
ga('set', 'transport', 'beacon');
ga('set', 'anonymizeIp', true);
ga('set', 'page', window.location.pathname);
ga('set', 'dimension5', '4');
ga('send', 'pageview');
</script>







<script>
function loadScript(url, type) {
  const s = document.createElement('script');
  s.src = url;
  if (type) {
    s.type = type;
  }
  if (type === 'module') {
    s.async = false; // Preserve load order.
    const pre = document.createElement('link');
    pre.rel = 'modulepreload';
    pre.href = url;
    document.head.append(pre);
    // We use DOMContentLoaded as the loader script is running sync, and inserting a module script here doesn't defer. This brings back normal type="module" behavior.
    window.addEventListener('DOMContentLoaded', () => {
      document.head.append(s);
    });
  } else {
    document.head.append(s);
  }
}
loadScript('/js/app.js?v=187d6240ce2df', 'module');




  loadScript('/js/content.js?v=6bce17c0a492d', 'module');


  loadScript('https://www.google-analytics.com/analytics.js', null);

</script>

  </head>
  <body class="unresolved">
    
    <web-snackbar-container></web-snackbar-container>

    



<web-header class="header-default" role="navigation">
  <button data-open-drawer-button class="w-button--svg w-button--round" aria-label="Open menu">
    








  










  <svg class="icon " role="img" aria-label="menu" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>


    <span class="w-tooltip w-tooltip--left">Open menu</span>
  </button>

  <a
    href="/"
    class="header-default__logo-link gc-analytics-event"
    data-category="Site-Wide Custom Events"
    data-label="Site logo"
  >
    <img class="header-default__logo" width="125" height="23" src="/images/lockup.svg" alt="web.dev" />
  </a>

  <div class="header-default__middle">
    <div class="header-default__links">
      <a
        href="/learn/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Learn"
      >
        Learn
      </a>

      <a
        href="/measure/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Measure"
      >
        Measure
      </a>

      <a
        href="/blog/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Blog"
      >
        Blog
      </a>

      <a
        href="/about/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: About"
      >
        About
      </a>
    </div>
    <web-search results-id="search-main-results" i18n="{&quot;search&quot;:{&quot;en&quot;:&quot;Search&quot;},&quot;open_search&quot;:{&quot;en&quot;:&quot;Open search&quot;},&quot;all_articles&quot;:{&quot;en&quot;:&quot;All articles&quot;},&quot;close_search&quot;:{&quot;en&quot;:&quot;Close search&quot;}}"></web-search>
    <web-search-results id="search-main-results"></web-search-results>
  </div>

  <web-profile-switcher-container></web-profile-switcher-container>
</web-header>



<web-navigation-drawer class="drawer-default" type="modal">
  <nav data-drawer-container>
    <div class="drawer-default__contents">
      <div class="drawer-default__header">
        <button
          data-drawer-close-button
          class="drawer-default__hide w-button--svg w-button--round"
          aria-label="Close"
        >
          








  










  <svg class="icon " role="img" aria-label="close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>


          <span class="w-tooltip">Close</span>
        </button>
        <a
          href="/"
          class="gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Site logo"
        >
          <img
            width="125"
            height="30"
            class="drawer-default__logo"
            src="/images/lockup.svg"
            alt="web.dev"
          />
        </a>
      </div>
      <a
        href="/learn/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Learn"
      >
        Learn
      </a>
      <a
        href="/measure/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Measure"
      >
        Measure
      </a>
      <a
        href="/blog/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Blog"
      >
        Blog
      </a>
      <a
        href="/about/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: About"
      >
        About
      </a>
    </div>
  </nav>
</web-navigation-drawer>

<main>
  <div id="content">
    
      
    
    


<div class="guide-landing-page">
  
    
    
    
  
  

  

  <web-table-of-contents>
    <h2 class="w-toc__header">
      <a href="#service-worker-caching-and-http-caching" class="w-toc__header--link">
        Service worker caching and HTTP caching
      </a>
    </h2>
    <div class="w-toc__list">
        <ul><li><a href="#overview-of-caching-flow">Overview of caching flow</a></li><li><a href="#caching-layers">Caching layers</a><ol><li><a href="#service-worker-caching">Service worker caching</a></li><li><a href="#http-caching">HTTP caching</a></li></ol></li><li><a href="#designing-your-cache-expiry-logic">Designing your cache expiry logic</a><ol><li><a href="#consistent-expiry-logic-for-all-cache-layers">Consistent expiry logic for all cache layers</a></li><li><a href="#different-cache-expiry-logic-at-the-service-worker-cache-and-http-layers">Different cache expiry logic at the service worker cache and HTTP layers</a></li></ol></li><li><a href="#conclusion">Conclusion</a></li><li><a href="#learn-more">Learn more</a></li></ul></div>
  </web-table-of-contents>
  <web-table-of-contents-button></web-table-of-contents-button>

  
  <div class="w-actions">
    <share-action authors="@jonchenn"
      class="gc-analytics-event w-actions__fab w-actions__fab--share"
      data-category="web.dev"
      data-label="share"
      data-action="click"
      data-icon="share"
      tabindex="0"
      role="button"
    >
      <span>Share</span>
    </share-action>
    
    
  </div>

  <div class="w-layout-container--narrow w-post-content">
    <header class="w-article-header">
      
        
        <div class="w-post-breadcrumbs">
          <ul class="w-breadcrumbs">
  <li class="w-breadcrumbs__crumb">
    <a
      class="w-breadcrumbs__link w-breadcrumbs__link--left-justify gc-analytics-event"
      data-category="web.dev"
      data-label="post, home breadcrumb"
      data-action="click"
      href="/"
    >
      Home
    </a>
  </li>

  <svg
    class="w-breadcrumbs__icon"
    xmlns="http://www.w3.org/2000/svg"
    height="24"
    viewBox="0 0 24 24"
    width="24"
    aria-hidden="true"
  >
    <path d="M0 0h24v24H0V0z" fill="none" />
    <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
  </svg>

  <li class="w-breadcrumbs__crumb">
    <a
      class="w-breadcrumbs__link gc-analytics-event"
      data-category="web.dev"
      data-label="post, path breadcrumb"
      data-action="click"
      href=/blog
    >
      All articles
    </a>
  </li>
</ul>
        </div>
      

      <h1 id="service-worker-caching-and-http-caching" class="w-article-header__headline">Service worker caching and HTTP caching</h1>
      
        <p class="w-article-header__subhead w-mb--non">
          <p>The pros and cons of using consistent or different expiry logic across the service worker cache and HTTP cache layers.</p>

        </p>
      

      
        <div class="w-author__published">
          <time>Jul 17, 2020</time>
          
        </div>
      

      
      

      <div class="w-layout-container--narrow w-post-signpost">
  <span class="w-post-signpost__title">
    Appears in:
  </span>
  <a
          class="w-post-signpost__link"
          href="/reliable"
          >Network reliability</a
        >
</div>

      
        <div class="w-authors w-mt--xl w-pt--sm">
          
            <div class="w-author">
  <a href="/authors/jonchen/"><img     alt="Jonathan Chen"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/DSWao9z2Qq584d9kbjit.jpg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/admin/DSWao9z2Qq584d9kbjit.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/admin/DSWao9z2Qq584d9kbjit.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/admin/DSWao9z2Qq584d9kbjit.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/admin/DSWao9z2Qq584d9kbjit.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/admin/DSWao9z2Qq584d9kbjit.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /></a>
  <div
    class="w-author__info"
    style="display: flex; flex-direction: column; justify-content: center;"
  >
    <cite class="w-author__name">
      <a class="w-author__name-link" href="/authors/jonchen/">Jonathan Chen</a>
    </cite>
    <ul class="w-author__link-list">
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://twitter.com/jonchenn"
          >Twitter</a
        >
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://github.com/jonchenn">GitHub</a>
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://glitch.com/@jonchenn"
          >Glitch</a
        >
      </li>
      
    </ul>
  </div>
</div>
          
        </div>
      
    </header>

    

    <p>While service workers and PWAs are becoming standards of modern web applications, resource caching
has become more complex than ever. This article covers the big picture of browser caching,
including:</p>
<ul>
<li>The use cases of and differences between service worker caching and HTTP caching.</li>
<li>The pros and cons of different service worker caching expiry strategies compared to regular
HTTP caching strategies.</li>
</ul>
<h2 id="overview-of-caching-flow">Overview of caching flow <a class="w-headline-link" href="#overview-of-caching-flow">#</a></h2>
<p>At a high-level, a browser follows the caching order below when it requests a resource:</p>
<ol>
<li><strong>Service worker cache</strong>: The service worker checks if the resource is in its cache and
decides whether to return the resource itself based on its programmed caching strategies. Note
that this does not happen automatically. You need to create a fetch event handler in your
service worker and intercept network requests so that the requests are served from the service
worker's cache rather than the network.</li>
<li><strong>HTTP cache (also known as the browser cache)</strong>: If the resource is found in the <a href="/http-cache">HTTP
Cache</a> and has not yet expired, the browser automatically uses the
resource from the  HTTP cache.</li>
<li><strong>Server-side:</strong> If nothing is found in the service worker cache or the HTTP cache, the
browser goes to the network to request the resource. If the resource isn't cached in a CDN, the
request must go all the way back to the origin server.</li>
</ol>
<img     alt="Caching flow"          decoding="async"     height="585"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/vtKWC9Bg9dAMzoFKTeAM.png?auto=format&w=1600 1600w"          width="800"   />
<div class="w-aside w-aside--note">
<p>Note that some browsers like Chrome have a <strong>memory cache</strong> layer in front of the service
worker cache. The details of the memory cache depend on each browser's implementation.
Unfortunately, there is no clear specification for this part yet.</div></p>
<h2 id="caching-layers">Caching layers <a class="w-headline-link" href="#caching-layers">#</a></h2>
<h3 id="service-worker-caching">Service worker caching <a class="w-headline-link" href="#service-worker-caching">#</a></h3>
<p>A service worker intercepts network-type HTTP requests and uses a
<a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook#serving-suggestions" rel="noopener">caching strategy</a>
to determine what resources should be returned to the browser. The service worker cache and the HTTP
cache serve the same general purpose, but the service worker cache offers more caching capabilities,
such as fine-grained control over exactly what is cached and how caching is done.</p>
<h4 id="controlling-the-service-worker-cache">Controlling the service worker cache <a class="w-headline-link" href="#controlling-the-service-worker-cache">#</a></h4>
<p>A service worker intercepts HTTP requests with <a href="https://github.com/mdn/sw-test/blob/gh-pages/sw.js#L19" rel="noopener">event
listeners</a> (usually the <code>fetch</code> event). This
<a href="https://github.com/mdn/sw-test/blob/gh-pages/sw.js#L19" rel="noopener">code snippet</a> demonstrates the logic of a
<a href="https://developers.google.com/web/tools/workbox/modules/workbox-strategies#cache_first_cache_falling_back_to_network" rel="noopener">Cache-First</a>
caching strategy.</p>
<img     alt="A diagram showing how service workers intercept HTTP requests"          decoding="async"     height="516"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/INLfnhEpmL4KpMmFXnTL.png?auto=format&w=1600 1600w"          width="800"   />
<p>It's highly recommended to use <a href="https://developers.google.com/web/tools/workbox" rel="noopener">Workbox</a> to avoid
reinventing the wheel. For example, you can
<a href="https://developers.google.com/web/tools/workbox/modules/workbox-routing#how_to_register_a_regular_expression_route" rel="noopener">register resource URL paths with a single line of regex code</a>.</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>registerRoute<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'workbox-routing'</span><span class="token punctuation">;</span><br><br><span class="token function">registerRoute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'styles/.*\\.css'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callbackHandler<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><h4 id="service-worker-caching-strategies-and-use-cases">Service worker caching strategies and use cases <a class="w-headline-link" href="#service-worker-caching-strategies-and-use-cases">#</a></h4>
<p>The next table outlines common service worker caching strategies and when each strategy is useful.</p>
<table>
<thead>
<tr>
<th><strong>Strategies</strong></th>
<th><strong>Freshness rationale</strong></th>
<th><strong>Use cases</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><a
href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook#network-only">Network
only</strong></a></td>
<td>The content has to be up-to-date at all times.</td>
<td><ul><li>Payments and checkouts</li>
<li>Balance statements</li>
</ul>
</td>
</tr>
<tr>
<td><strong><a
href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook#network-falling-back-to-cache">Network
falling back to cache </strong></a></td>
<td>It's preferable to serve the fresh content. However if the network fails or is unstable, it's
acceptable to serve slightly old content.</td>
<td><ul><li>Timely data</li>
<li>Prices and rates (requires disclaimers)</li>
<li>Order statuses</li>
</ul>
</td>
</tr>
<tr>
<td><strong><a
href="/stale-while-revalidate/">Stale-while-revalidate</strong></a>
</td>
<td>It's okay to serve cached content right away, but updated cached content should be used in the
future.</td>
<td><ul><li>News feeds</li>
<li>Product listing pages</li>
<li>Messages</li>
</ul>
</td>
</tr>
<tr>
<td><strong><a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook#cache-then-network">Cache first, fall back to network</a></strong></td>
<td>The content is non-critical and can be served from the cache for performance gains, but the
service worker should occasionally check for updates.</td>
<td><ul><li>App shells</li>
<li>Common resources</li>
</ul>
</td>
</tr>
<tr>
<td><strong><a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook#cache-only">Cache only</a></strong></td>
<td>The content rarely changes.</td>
<td><ul><li>Static content</li>
</ul>
</td>
</tr>
</tbody>
</table>
<h4 id="additional-benefits-of-service-worker-caching">Additional benefits of service worker caching <a class="w-headline-link" href="#additional-benefits-of-service-worker-caching">#</a></h4>
<p>In addition to fine-grained control of caching logic, service worker caching also provides:</p>
<ul>
<li><strong>More memory and storage space for your origin:</strong> The browser allocates HTTP cache
resources on a per-<a href="/same-site-same-origin/#origin">origin</a> basis. In other
words, if you have multiple subdomains, they all share the same HTTP cache. There is no
guarantee that the content of your origin/domain stays in the HTTP cache for a long time. For
example, a user may purge the cache by manually cleaning up from a browser's settings UI, or
triggering a hard-reload on a page. With a service worker cache you have a much higher
likelihood that your cached content stays cached. See <a href="https://developers.google.com/web/updates/2016/06/persistent-storage" rel="noopener">Persistent
storage</a> to learn more.</li>
<li><strong>Higher flexibility with flaky networks or offline experiences:</strong> With the HTTP cache you
only have a binary choice: either the resource is cached, or not. With service worker caching
you can mitigate little &quot;hiccups&quot; much easier (with the &quot;stale-while-revalidate&quot; strategy),
offer a complete offline experience (with the &quot;Cache only&quot; strategy) or even something in
between, like customized UIs with parts of the page coming from the service worker cache and
some parts excluded (with the &quot;Set catch handler&quot; strategy) where appropriate.</li>
</ul>
<h3 id="http-caching">HTTP caching <a class="w-headline-link" href="#http-caching">#</a></h3>
<p>The first time a browser loads a web page and related resources, it stores these resources in its
HTTP cache. The HTTP cache is usually enabled automatically by browsers, unless it has been
explicitly disabled by the end user.</p>
<p>Using HTTP caching means relying on the server to determine when to cache a resource and for how
long.</p>
<h4 id="control-http-cache-expiry-with-http-response-headers">Control HTTP cache expiry with HTTP response headers <a class="w-headline-link" href="#control-http-cache-expiry-with-http-response-headers">#</a></h4>
<p>When a server responds to a browser request for a resource, the server uses HTTP response headers to
tell a browser how long it should cache the resource. See <a href="/http-cache/#response-headers">Response headers: configure your web
server</a> to learn more.</p>
<h4 id="http-caching-strategies-and-use-cases">HTTP caching strategies and use cases <a class="w-headline-link" href="#http-caching-strategies-and-use-cases">#</a></h4>
<p>HTTP caching is much simpler than service worker caching, because HTTP caching only deals with
time-based (TTL) resource expiration logic. See
<a href="/http-cache/#response-header-strategies">Which response header values should you use?</a>
and <a href="/http-cache/#summary">Summary</a> to learn more about HTTP caching strategies.</p>
<h2 id="designing-your-cache-expiry-logic">Designing your cache expiry logic <a class="w-headline-link" href="#designing-your-cache-expiry-logic">#</a></h2>
<p>This section explains the pros and cons of using consistent expiry logic across the service worker
cache and HTTP cache layers, as well as the pros and cons of separate expiry logic across these
layers.</p>
<p>The Glitch below demonstrates how service worker caching and HTTP caching work in action across
different scenarios:</p>
<div class="glitch-embed-wrap" style="height: 480px; width: 100%;">
  <iframe
    allow="camera; clipboard-read; clipboard-write; encrypted-media; geolocation; microphone; midi"
    loading="lazy"
    src="https://glitch.com/embed/#!/embed/compare-sw-and-http-caching?attributionHidden=true&sidebarCollapsed=true&previewSize=100"
    style="height: 100%; width: 100%; border: 0;"
    title="compare-sw-and-http-caching on Glitch"
  ></iframe>
</div>
<h3 id="consistent-expiry-logic-for-all-cache-layers">Consistent expiry logic for all cache layers <a class="w-headline-link" href="#consistent-expiry-logic-for-all-cache-layers">#</a></h3>
<p>To demonstrate the pros and cons, we'll look at 3 scenarios: long-term, medium-term, and
short-term.</p>
<table>
<thead>
<tr>
<th>Scenarios</th>
<th>Long-term caching</th>
<th>Medium-term caching</th>
<th>Short-term caching</th>
</tr>
</thead>
<tbody>
<tr>
<td>Service worker caching strategy</td>
<td>Cache, falling back to network</td>
<td>Stale-while-revalidate</td>
<td>Network falling back to cache</td>
</tr>
<tr>
<td>Service worker cache TTL</td>
<td><strong>30 days</strong></td>
<td><strong>1 day</strong></td>
<td><strong>10 mins</strong></td>
</tr>
<tr>
<td>HTTP cache max-age</td>
<td><strong>30 days</strong></td>
<td><strong>1 day</strong></td>
<td><strong>10 mins</strong></td>
</tr>
</tbody>
</table>
<h4 id="scenario:-long-term-caching-(cache-falling-back-to-network)">Scenario: Long-term caching (Cache, falling back to network) <a class="w-headline-link" href="#scenario:-long-term-caching-(cache-falling-back-to-network)">#</a></h4>
<ul>
<li>When a cached resource is valid (&lt;= 30 days): The service worker returns the cached
resource immediately without going to the network.</li>
<li>When a cached resource is expired (&gt; 30 days): The service worker goes to the network to
fetch the resource. The browser doesn't have a copy of the resource in its HTTP cache, so it
goes server-side for the resource.</li>
</ul>
<p>Con: In this scenario, HTTP caching provides less value because the browser will always
pass the request to the server-side when the cache expires in the service worker.</p>
<h4 id="scenario:-medium-term-caching-(stale-while-revalidate)">Scenario: Medium-term caching (Stale-while-revalidate) <a class="w-headline-link" href="#scenario:-medium-term-caching-(stale-while-revalidate)">#</a></h4>
<ul>
<li>When a cached resource is valid (&lt;= 1 day): The service worker returns the cached
resource immediately, and goes to the network to fetch the resource. The browser has a copy of
the resource in its HTTP cache, so it returns that copy to the service worker.</li>
<li>When a cached resource is expired (&gt; 1 day): The service worker returns the cached
resource immediately, and goes to the network to fetch the resource. The browser doesn't have a
copy of the resource in its HTTP cache, so it goes server-side to fetch the resource.</li>
</ul>
<p>Con: The service worker requires additional cache-busting to override the HTTP cache in
order to make the most of the &quot;revalidate&quot; step.</p>
<h4 id="scenario:-short-term-caching-(network-falling-back-to-cache)">Scenario: Short-term caching (Network falling back to cache) <a class="w-headline-link" href="#scenario:-short-term-caching-(network-falling-back-to-cache)">#</a></h4>
<ul>
<li>When a cached resource is valid (&lt;= 10 mins): The service worker goes to the network
to fetch the resource. The browser has a copy of the resource in its HTTP cache so it returns
that to the service worker without going server-side.</li>
<li>When a cached resource is expired (&gt; 10 mins): The service worker returns the cached
resource immediately, and goes to the network to fetch the resource. The browser doesn't have a
copy of the resource in its HTTP cache, so it goes server-side to fetch the resource.</li>
</ul>
<p>Con: Similar to the medium-term caching scenario, the service worker requires additional
cache-busting logic to override the HTTP cache in order to fetch the latest resource from the
server-side.</p>
<h4 id="service-worker-in-all-scenarios">Service worker in all scenarios <a class="w-headline-link" href="#service-worker-in-all-scenarios">#</a></h4>
<p>In all scenarios, the service worker cache can still return cached resources when the network is
unstable. On the other hand, the HTTP cache is not reliable when the network is unstable or down.</p>
<h3 id="different-cache-expiry-logic-at-the-service-worker-cache-and-http-layers">Different cache expiry logic at the service worker cache and HTTP layers <a class="w-headline-link" href="#different-cache-expiry-logic-at-the-service-worker-cache-and-http-layers">#</a></h3>
<p>To demonstrate the pros and cons, we'll again look at long-term, medium-term, and short-term
scenarios.</p>
<table>
<thead>
<tr>
<th>Scenarios</th>
<th>Long-term caching</th>
<th>Medium-term caching</th>
<th>Short-term caching</th>
</tr>
</thead>
<tbody>
<tr>
<td>Service worker caching strategy</td>
<td>Cache, falling back to network</td>
<td>Stale-while-revalidate</td>
<td>Network falling back to cache</td>
</tr>
<tr>
<td>Service worker cache TTL</td>
<td><strong>90 days</strong></td>
<td><strong>30 days</strong></td>
<td><strong>1 day</strong></td>
</tr>
<tr>
<td>HTTP cache max-age</td>
<td><strong>30 days</strong></td>
<td><strong>1 day</strong></td>
<td><strong>10 mins</strong></td>
</tr>
</tbody>
</table>
<h4 id="scenario:-long-term-caching-(cache-falling-back-to-network)-2">Scenario: Long-term caching (Cache, falling back to network) <a class="w-headline-link" href="#scenario:-long-term-caching-(cache-falling-back-to-network)-2">#</a></h4>
<ul>
<li>When a cached resource is valid in the service worker cache (&lt;= 90 days): The service
worker returns the cached resource immediately.</li>
<li>When a cached resource is expired in the service worker cache (&gt; 90 days): The service
worker goes to the network to fetch the resource. The browser doesn't have a copy of the
resource in its HTTP cache, so it goes server-side.</li>
</ul>
<p>Pros and cons:</p>
<ul>
<li>Pro: Users experience instant response as the service worker returns cached resources
immediately.</li>
<li>Pro: The service worker has more fine-grained control of when to use its cache and when
to request new versions of resources.</li>
<li>Con: A well-defined service worker caching strategy is required.</li>
</ul>
<h4 id="scenario:-mid-term-caching-(stale-while-revalidate)">Scenario: Mid-term caching (Stale-while-revalidate) <a class="w-headline-link" href="#scenario:-mid-term-caching-(stale-while-revalidate)">#</a></h4>
<ul>
<li>When a cached resource is valid in the service worker cache (&lt;= 30 days): The service
worker returns the cached resource immediately.</li>
<li>When a cached resource is expired in the service worker cache (&gt; 30 days): The service
worker goes to the network for the resource. The browser doesn't have a copy of the resource in
its HTTP cache, so it goes server-side.</li>
</ul>
<p>Pros and cons:</p>
<ul>
<li>Pro: Users experience instant response as the service worker returns cached resources
immediately.</li>
<li>Pro: The service worker can ensure that the <strong>next</strong> request for a given URL uses a
fresh response from the network, thanks to the revalidation that happens &quot;in the background.&quot;</li>
<li>Con: A well-defined service worker caching strategy is required.</li>
</ul>
<h4 id="scenario:-short-term-caching-(network-falling-back-to-cache)-2">Scenario: Short-term caching (Network falling back to cache) <a class="w-headline-link" href="#scenario:-short-term-caching-(network-falling-back-to-cache)-2">#</a></h4>
<ul>
<li>When a cached resource is valid in the service worker cache (&lt;= 1 day): The service
worker goes to the network for the resource. The browser returns the resource from the HTTP
cache if it's there. If the network is down, the service worker returns the resource from the
service worker cache</li>
<li>When a cached resource is expired in the service worker cache (&gt; 1 day): The service
worker goes to the network to fetch the resource. The browser fetches the resources over the
network as the cached version in its HTTP cache is expired.</li>
</ul>
<p>Pros and cons:</p>
<ul>
<li>Pro: When the network is unstable or down, the service worker returns cached
resources immediately.</li>
<li>Con: The service worker requires additional cache-busting to override the HTTP Cache and
make &quot;Network first&quot; requests.</li>
</ul>
<h2 id="conclusion">Conclusion <a class="w-headline-link" href="#conclusion">#</a></h2>
<p>Given the complexity of the combination of caching scenarios, it's not possible to design one rule
that covers all cases. However, based on the findings in the previous sections, there are a few
suggestions to look at when designing your cache strategies:</p>
<ul>
<li>Service worker caching logic doesn't need to be consistent with HTTP caching expiry
logic. If possible, use longer expiry logic in the service worker to grant the service worker
more control.</li>
<li>HTTP caching still plays an important role, but it's not reliable when the network is
unstable or down.</li>
<li>Revisit your caching strategies for each resource to make sure your service worker caching
strategy provides its value, without conflicting with the HTTP cache.</li>
</ul>
<h2 id="learn-more">Learn more <a class="w-headline-link" href="#learn-more">#</a></h2>
<ul>
<li><a href="/reliable/">Network reliability</a></li>
<li><a href="/http-cache">Prevent unnecessary network requests with the HTTP Cache</a></li>
<li><a href="/codelab-http-cache/">HTTP cache codelab</a></li>
<li><a href="https://developers.google.com/web/showcase/2016/service-worker-perf" rel="noopener">Measuring the real-world performance impact of service workers</a></li>
<li><a href="https://stackoverflow.com/questions/5799906/what-s-the-difference-between-expires-and-cache-control-headers" rel="noopener">Cache-Control vs. Expires</a></li>
</ul>


    

    
  <div class="w-chips ">
    
      
    
      
    
      
        
        <a class="w-chip" href="/tags/network/">Network</a>
      
    
      
        
        <a class="w-chip" href="/tags/service-worker/">Service Worker</a>
      
    
      
        
        <a class="w-chip" href="/tags/offline/">Offline</a>
      
    
  </div>


    <div class="w-post-github-link w-mt--l w-mb--l">
      <span class="w-mr--sm">
        
        Last updated: <time>Jul 17, 2020</time>
        
      </span>
      <a
        href="https://github.com/GoogleChrome/web.dev/blob/main/src/site/content/en/reliable/service-worker-caching-and-http-caching/index.md"
      >
        Improve article
      </a>
       
    </div>

    
  </div>

  
    
    <nav class="w-article-navigation">
  <a
    class="w-article-navigation__link w-article-navigation__link--back
      w-article-navigation__link--single gc-analytics-event"
    data-category="web.dev"
    data-label="navigation, go back"
    data-action="click"
    href="/blog"
  >
    Return to all articles
  </a>
</nav>
  
</div>


  </div>
</main>
<footer class="w-footer">
  <nav class="w-footer__linkboxes">
    <ul class="w-footer__linkboxes-list">
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Contribute</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&labels=bug&template=bug_report.md&title="
              class="w-footer__linkbox-link" data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              File a bug
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/googlechrome/web.dev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              View source
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Related content</h3>
        <ul class="w-footer__linkbox-list">
         <li class="w-footer__linkbox-item">
            <a href="https://developer.chrome.com/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              developer.chrome.com
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://blog.chromium.org/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Chrome updates
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/fundamentals" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              Web Fundamentals
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/showcase/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">
              Case studies
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/podcasts/" class="w-footer__linkbox-link"
              data-category="Podcasts" data-label="Footer Link (index 5)">
              Podcasts
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/shows/" class="w-footer__linkbox-link"
              data-category="Shows" data-label="Footer Link (index 6)">
              Shows
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Connect</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://www.twitter.com/ChromiumDev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Twitter
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://www.youtube.com/user/ChromeDevelopers" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              YouTube
            </a>
          </li>
        </ul>
      </li>
    </ul>
  </nav>

  <div class="w-footer__utility">
    <nav class="w-footer__utility-nav">
      <a href="https://developers.google.com/" class="w-footer__utility-logo-link"
        data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link">
        <img loading="lazy" width="185" height="33" class="w-footer__utility-logo" src="/images/lockup-color.png"
          alt="Google Developers" />
      </a>
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developer.chrome.com/"
            data-category="Site-Wide Custom Events" data-label="Footer Chrome Link">
            Chrome
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://firebase.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Firebase Link">
            Firebase
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://cloud.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Google Cloud Platform Link">
            Google Cloud Platform
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developers.google.com/products"
            data-category="Site-Wide Custom Events" data-label="Footer All products Link">
            All products
          </a>
        </li>
      </ul>
      <web-language-select current="en"></web-language-select>
    </nav>
    <nav class="w-footer__utility-nav">
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://policies.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Terms and Privacy link">
            Terms &amp; Privacy
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="/community-guidelines/" data-category="Site-Wide Custom Events"
            data-label="Footer Community Guidelines link">
            Community Guidelines
          </a>
        </li>
      </ul>
      <div class="w-footer__license">
        <p>
          Except as otherwise noted, the content of this page is licensed
          under the
          <a href="https://creativecommons.org/licenses/by/4.0/">
          Creative Commons Attribution 4.0 License</a>,
          and code samples are licensed under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">
          Apache 2.0 License</a>. For details, see the
          <a href="https://developers.google.com/terms/site-policies">
          Google Developers Site Policies</a>.
        </p>
      </div>
    </nav>
  </div>
</footer>

  </body>
</html>
