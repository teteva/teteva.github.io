
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">


  
    
    <link rel="stylesheet" href="/css/main.css?v=97bbfcbb3543d">
  

  <link rel="preload" as="font" crossorigin href="/fonts/material-icons/regular.woff2">


<link rel="preload" as="font" crossorigin href="/fonts/google-sans/regular/latin.woff2">
<link rel="preload" as="font" crossorigin href="/fonts/google-sans/bold/latin.woff2">

<meta name="theme-color" content="#fff"/>




<title>Android payment app developers guide</title>
<meta name="description" content="Learn how to adapt your Android payment app to work with Web Payments and provide a better user experience for customers. " />

<link rel="canonical" href="https://web.dev/android-payment-apps-developers-guide/" />

<meta itemprop="name" content="Android payment app developers guide" />
<meta itemprop="description" content="Learn how to adapt your Android payment app to work with Web Payments and provide a better user experience for customers. " />
<meta itemprop="image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://web.dev/android-payment-apps-developers-guide/" />
<meta property="og:site_name" content="web.dev" />
<meta property="og:title" content="Android payment app developers guide" />
<meta property="og:description" content="Learn how to adapt your Android payment app to work with Web Payments and provide a better user experience for customers. " />
<meta property="og:image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:image:alt" content="" />
<meta property="tag" content="payments" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Android payment app developers guide" />
<meta name="twitter:description" content="Learn how to adapt your Android payment app to work with Web Payments and provide a better user experience for customers. " />
<meta name="twitter:image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<link
  rel="alternate"
  href="/feed.xml"
  type="application/atom+xml"
  data-title="web.dev feed"
/>

<link rel="manifest" href="/manifest.webmanifest" />

<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="mask-icon" color="#0054ff" href="/images/safari-pinned-tab.svg">



<script>
window.ga =
  window.ga ||
  function () {
    (ga.q = ga.q || []).push(arguments);
  };
ga.l = +new Date();
ga('create', 'UA-126406676-2');
ga('set', 'transport', 'beacon');
ga('set', 'anonymizeIp', true);
ga('set', 'page', window.location.pathname);
ga('set', 'dimension5', '4');
ga('send', 'pageview');
</script>







<script>
function loadScript(url, type) {
  const s = document.createElement('script');
  s.src = url;
  if (type) {
    s.type = type;
  }
  if (type === 'module') {
    s.async = false; // Preserve load order.
    const pre = document.createElement('link');
    pre.rel = 'modulepreload';
    pre.href = url;
    document.head.append(pre);
    // We use DOMContentLoaded as the loader script is running sync, and inserting a module script here doesn't defer. This brings back normal type="module" behavior.
    window.addEventListener('DOMContentLoaded', () => {
      document.head.append(s);
    });
  } else {
    document.head.append(s);
  }
}
loadScript('/js/app.js?v=ef7300a4462a9', 'module');




  loadScript('/js/content.js?v=190e84c38c89', 'module');


  loadScript('https://www.google-analytics.com/analytics.js', null);

</script>

  </head>
  <body class="unresolved">
    
    <web-snackbar-container></web-snackbar-container>

    



<web-header class="header-default" role="navigation">
  <button data-open-drawer-button class="w-button--svg w-button--round" aria-label="Open menu">
    








  










  <svg class="icon " role="img" aria-label="menu" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>


    <span class="w-tooltip w-tooltip--left">Open menu</span>
  </button>

  <a
    href="/"
    class="header-default__logo-link gc-analytics-event"
    data-category="Site-Wide Custom Events"
    data-label="Site logo"
  >
    <img class="header-default__logo" width="125" height="23" src="/images/lockup.svg" alt="web.dev" />
  </a>

  <div class="header-default__middle">
    <div class="header-default__links">
      <a
        href="/learn/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Learn"
      >
        Learn
      </a>

      <a
        href="/measure/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Measure"
      >
        Measure
      </a>

      <a
        href="/blog/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Blog"
      >
        Blog
      </a>

      <a
        href="/about/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: About"
      >
        About
      </a>
    </div>
    <web-search results-id="search-main-results" i18n="{&quot;search&quot;:{&quot;en&quot;:&quot;Search&quot;},&quot;open_search&quot;:{&quot;en&quot;:&quot;Open search&quot;},&quot;all_articles&quot;:{&quot;en&quot;:&quot;All articles&quot;},&quot;close_search&quot;:{&quot;en&quot;:&quot;Close search&quot;}}"></web-search>
    <web-search-results id="search-main-results"></web-search-results>
  </div>

  <web-profile-switcher-container></web-profile-switcher-container>
</web-header>



<web-navigation-drawer class="drawer-default" type="modal">
  <nav data-drawer-container>
    <div class="drawer-default__contents">
      <div class="drawer-default__header">
        <button
          data-drawer-close-button
          class="drawer-default__hide w-button--svg w-button--round"
          aria-label="Close"
        >
          








  










  <svg class="icon " role="img" aria-label="close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>


          <span class="w-tooltip">Close</span>
        </button>
        <a
          href="/"
          class="gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Site logo"
        >
          <img
            width="125"
            height="30"
            class="drawer-default__logo"
            src="/images/lockup.svg"
            alt="web.dev"
          />
        </a>
      </div>
      <a
        href="/learn/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Learn"
      >
        Learn
      </a>
      <a
        href="/measure/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Measure"
      >
        Measure
      </a>
      <a
        href="/blog/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Blog"
      >
        Blog
      </a>
      <a
        href="/about/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: About"
      >
        About
      </a>
    </div>
  </nav>
</web-navigation-drawer>

<main>
  <div id="content">
    
      
    
    


<div class="guide-landing-page">
  
    
    
    
  
  

  

  <web-table-of-contents>
    <h2 class="w-toc__header">
      <a href="#android-payment-app-developers-guide" class="w-toc__header--link">
        Android payment app developers guide
      </a>
    </h2>
    <div class="w-toc__list">
        <ul><li><a href="#step-1:-let-merchants-discover-your-payment-app">Step 1: Let merchants discover your payment app</a></li><li><a href="#step-2:-let-a-merchant-know-if-a-customer-has-an-enrolled-instrument-that-is-ready-to-pay">Step 2: Let a merchant know if a customer has an enrolled instrument that is ready to pay</a><ol><li><a href="#androidmanifest.xml">AndroidManifest.xml</a></li><li><a href="#aidl">AIDL</a></li><li><a href="#implementing-isreadytopayservice">Implementing IsReadyToPayService</a></li><li><a href="#parameters">Parameters</a></li><li><a href="#response">Response</a></li><li><a href="#permission">Permission</a></li></ol></li><li><a href="#step-3:-let-a-customer-make-payment">Step 3: Let a customer make payment</a><ol><li><a href="#androidmanifest.xml-2">AndroidManifest.xml</a></li><li><a href="#parameters-2">Parameters</a></li><li><a href="#response-2">Response</a></li><li><a href="#permission-2">Permission</a></li></ol></li><li><a href="#step-4:-verify-the-caller's-signing-certificate">Step 4: Verify the caller's signing certificate</a></li></ul></div>
  </web-table-of-contents>
  <web-table-of-contents-button></web-table-of-contents-button>

  
  <div class="w-actions">
    <share-action authors="@yuichi_araki | @agektmr"
      class="gc-analytics-event w-actions__fab w-actions__fab--share"
      data-category="web.dev"
      data-label="share"
      data-action="click"
      data-icon="share"
      tabindex="0"
      role="button"
    >
      <span>Share</span>
    </share-action>
    
    
  </div>

  <div class="w-layout-container--narrow w-post-content">
    <header class="w-article-header">
      
        
        <div class="w-post-breadcrumbs">
          <ul class="w-breadcrumbs">
  <li class="w-breadcrumbs__crumb">
    <a
      class="w-breadcrumbs__link w-breadcrumbs__link--left-justify gc-analytics-event"
      data-category="web.dev"
      data-label="post, home breadcrumb"
      data-action="click"
      href="/"
    >
      Home
    </a>
  </li>

  <svg
    class="w-breadcrumbs__icon"
    xmlns="http://www.w3.org/2000/svg"
    height="24"
    viewBox="0 0 24 24"
    width="24"
    aria-hidden="true"
  >
    <path d="M0 0h24v24H0V0z" fill="none" />
    <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
  </svg>

  <li class="w-breadcrumbs__crumb">
    <a
      class="w-breadcrumbs__link gc-analytics-event"
      data-category="web.dev"
      data-label="post, path breadcrumb"
      data-action="click"
      href=/blog
    >
      All articles
    </a>
  </li>
</ul>
        </div>
      

      <h1 id="android-payment-app-developers-guide" class="w-article-header__headline">Android payment app developers guide</h1>
      
        <p class="w-article-header__subhead w-mb--non">
          <p>Learn how to adapt your Android payment app to work with Web Payments and provide a better user experience for customers.</p>

        </p>
      

      
        <div class="w-author__published">
          <time>May 25, 2020</time>
          
        </div>
      

      
      

      <div class="w-layout-container--narrow w-post-signpost">
  <span class="w-post-signpost__title">
    Appears in:
  </span>
  <a
          class="w-post-signpost__link"
          href="/payments"
          >Web Payments</a
        >
</div>

      
        <div class="w-authors w-mt--xl w-pt--sm">
          
            <div class="w-author">
  <a href="/authors/yaraki/"><img     alt="Yuichi Araki"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/IjxUTn7SuYE9pHLSZteN.jpg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/admin/IjxUTn7SuYE9pHLSZteN.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/admin/IjxUTn7SuYE9pHLSZteN.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/admin/IjxUTn7SuYE9pHLSZteN.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/admin/IjxUTn7SuYE9pHLSZteN.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/admin/IjxUTn7SuYE9pHLSZteN.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /></a>
  <div
    class="w-author__info"
    style="display: flex; flex-direction: column; justify-content: center;"
  >
    <cite class="w-author__name">
      <a class="w-author__name-link" href="/authors/yaraki/">Yuichi Araki</a>
    </cite>
    <ul class="w-author__link-list">
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://twitter.com/yuichi_araki"
          >Twitter</a
        >
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://github.com/yaraki">GitHub</a>
      </li>
      
      
    </ul>
  </div>
</div>
          
            <div class="w-author">
  <a href="/authors/agektmr/"><img     alt="Eiji Kitamura"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/Mh9DRmQhjlroJM9JDqsu.jpg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/admin/Mh9DRmQhjlroJM9JDqsu.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/admin/Mh9DRmQhjlroJM9JDqsu.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/admin/Mh9DRmQhjlroJM9JDqsu.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/admin/Mh9DRmQhjlroJM9JDqsu.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/admin/Mh9DRmQhjlroJM9JDqsu.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /></a>
  <div
    class="w-author__info"
    style="display: flex; flex-direction: column; justify-content: center;"
  >
    <cite class="w-author__name">
      <a class="w-author__name-link" href="/authors/agektmr/">Eiji Kitamura</a>
    </cite>
    <ul class="w-author__link-list">
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://twitter.com/agektmr"
          >Twitter</a
        >
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://github.com/agektmr">GitHub</a>
      </li>
      
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://blog.agektmr.com">Blog</a>
      </li>
    </ul>
  </div>
</div>
          
        </div>
      
    </header>

    

    <p>The <a href="https://www.w3.org/TR/payment-request/" rel="noopener">Payment Request API</a> brings to the
web a built-in browser-based interface that allows users to enter required payment
information easier than ever before. The API can also invoke platform-specific payment
apps.</p>
<figure class="w-figure" style="width:300px; margin:auto;">
  <video controls autoplay loop muted class="w-screenshot">
    <source src="https://storage.googleapis.com/web-dev-assets/payments/native-payment-app.webm" type="video/webm">
    <source src="https://storage.googleapis.com/web-dev-assets/payments/native-payment-app.mp4" type="video/mp4">
  </video>
  <figcaption class="w-figcaption">Checkout flow with platform-specific Google Pay app that uses Web Payments</a>.
  </figcaption>
</figure>
<p>Compared to using just Android Intents, Web Payments allow better integration
with the browser, security, and user experience:</p>
<ul>
<li>The payment app is launched as a modal, in context of the merchant website.</li>
<li>Implementation is supplemental to your existing payment app, enabling you to
take advantage of your user base.</li>
<li>The payment app's signature is checked to prevent
<a href="https://en.wikipedia.org/wiki/Sideloading" rel="noopener">sideloading</a>.</li>
<li>Payment apps can support multiple payment methods.</li>
<li>Any payment method, such as cryptocurrency, bank transfers, and more, can be
integrated. Payment apps on Android devices can even integrate methods that
require access to the hardware chip on the device.</li>
</ul>
<div class="w-aside w-aside--note">
<p>To understand how merchants integrate with payment apps, check out <a href="/life-of-a-payment-transaction/">Life of a
payment transaction</a>.</p>
</div>
<p>It takes four steps to implement Web Payments in an Android payment app:</p>
<ol>
<li>Let merchants discover your payment app.</li>
<li>Let a merchant know if a customer has an enrolled instrument (such as credit
card) that is ready to pay.</li>
<li>Let a customer make payment.</li>
<li>Verify the caller's signing certificate.</li>
</ol>
<p>To see Web Payments in action, check out the
<a href="https://github.com/GoogleChromeLabs/android-web-payment/" rel="noopener">android-web-payment</a>
demo.</p>
<h2 id="step-1:-let-merchants-discover-your-payment-app">Step 1: Let merchants discover your payment app <a class="w-headline-link" href="#step-1:-let-merchants-discover-your-payment-app">#</a></h2>
<p>In order for a merchant to use your payment app, they need to use the <a href="https://developer.mozilla.org/docs/Web/API/Payment_Request_API" rel="noopener">Payment
Request API</a> and
specify the payment method you support using the <a href="https://www.w3.org/TR/payment-method-id/" rel="noopener">payment method
identifier</a>.</p>
<p>If you have a payment method identifier that is unique to your payment app, you
can set up your own <a href="https://w3c.github.io/payment-method-manifest/" rel="noopener">payment method
manifest</a> so browsers can
discover your app.</p>
<div class="w-aside w-aside--note">
<p>To learn how the discovery process works in detail and how to set up a new
payment method check out <a href="/setting-up-a-payment-method">Setting up a payment
method</a>.</p>
</div>
<h2 id="step-2:-let-a-merchant-know-if-a-customer-has-an-enrolled-instrument-that-is-ready-to-pay">Step 2: Let a merchant know if a customer has an enrolled instrument that is ready to pay <a class="w-headline-link" href="#step-2:-let-a-merchant-know-if-a-customer-has-an-enrolled-instrument-that-is-ready-to-pay">#</a></h2>
<p>The merchant can call <code>hasEnrolledInstrument()</code> to <a href="/life-of-a-payment-transaction#ready-to-pay">query whether the customer
is able to make a payment</a>. You can
implement <code>IS_READY_TO_PAY</code> as an Android service to answer this query.</p>
<h3 id="androidmanifest.xml"><code>AndroidManifest.xml</code> <a class="w-headline-link" href="#androidmanifest.xml">#</a></h3>
<p>Declare your service with an intent filter with the action
<code>org.chromium.intent.action.IS_READY_TO_PAY</code>.</p>
<web-copy-code><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span><br>  <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.SampleIsReadyToPayService<span class="token punctuation">"</span></span><br>  <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.chromium.intent.action.IS_READY_TO_PAY<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>service</span><span class="token punctuation">></span></span></code></pre>
</web-copy-code><p>The <code>IS_READY_TO_PAY</code> service is optional. If there's no such intent handler in
the payment app, then the web browser assumes that the app can always make
payments.</p>
<h3 id="aidl">AIDL <a class="w-headline-link" href="#aidl">#</a></h3>
<p>The API for the <code>IS_READY_TO_PAY</code> service is defined in AIDL. Create two AIDL
files with the following content:</p>
<p class="w-label">app/src/main/aidl/org/chromium/IsReadyToPayServiceCallback.aidl</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">package</span> org<span class="token punctuation">.</span>chromium<span class="token punctuation">;</span><br><span class="token keyword">interface</span> IsReadyToPayServiceCallback <span class="token punctuation">{</span><br>    oneway void <span class="token function">handleIsReadyToPay</span><span class="token punctuation">(</span>boolean isReadyToPay<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><p class="w-label">app/src/main/aidl/org/chromium/IsReadyToPayService.aidl</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">package</span> org<span class="token punctuation">.</span>chromium<span class="token punctuation">;</span><br><span class="token keyword">import</span> org<span class="token punctuation">.</span>chromium<span class="token punctuation">.</span>IsReadyToPayServiceCallback<span class="token punctuation">;</span><br><br><span class="token keyword">interface</span> IsReadyToPayService <span class="token punctuation">{</span><br>    oneway void <span class="token function">isReadyToPay</span><span class="token punctuation">(</span>IsReadyToPayServiceCallback callback<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><h3 id="implementing-isreadytopayservice">Implementing <code>IsReadyToPayService</code> <a class="w-headline-link" href="#implementing-isreadytopayservice">#</a></h3>
<p>The simplest implementation of <code>IsReadyToPayService</code> is shown in the following
example:</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">class</span> SampleIsReadyToPayService <span class="token operator">:</span> <span class="token function">Service</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">private</span> <span class="token keyword">val</span> binder <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> IsReadyToPayService<span class="token punctuation">.</span><span class="token function">Stub</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">isReadyToPay</span><span class="token punctuation">(</span>callback<span class="token operator">:</span> IsReadyToPayServiceCallback<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      callback<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">handleIsReadyToPay</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onBind</span><span class="token punctuation">(</span>intent<span class="token operator">:</span> Intent<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> IBinder<span class="token operator">?</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> binder<br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><h3 id="parameters">Parameters <a class="w-headline-link" href="#parameters">#</a></h3>
<p>Pass the following parameters to <code>onBind</code> as Intent extras:</p>
<ul>
<li><code>methodNames</code></li>
<li><code>methodData</code></li>
<li><code>topLevelOrigin</code></li>
<li><code>topLevelCertificateChain</code></li>
<li><code>topLevelCertificateChain</code></li>
<li><code>paymentRequestOrigin</code></li>
</ul>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onBind</span><span class="token punctuation">(</span>intent<span class="token operator">:</span> Intent<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> IBinder<span class="token operator">?</span> <span class="token punctuation">{</span><br>  <span class="token keyword">val</span> extras<span class="token operator">:</span> Bundle<span class="token operator">?</span> <span class="token operator">=</span> intent<span class="token operator">?</span><span class="token punctuation">.</span>extras<br>  <span class="token comment">// …</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><h4 id="methodnames"><code>methodNames</code> <a class="w-headline-link" href="#methodnames">#</a></h4>
<p>The names of the methods being queried. The elements are the keys in the
<code>methodData</code> dictionary, and indicate the methods that the payment app supports.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> methodNames<span class="token operator">:</span> List<span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token operator">?</span> <span class="token operator">=</span> extras<span class="token punctuation">.</span><span class="token function">getStringArrayList</span><span class="token punctuation">(</span><span class="token string">"methodNames"</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><h4 id="methoddata"><code>methodData</code> <a class="w-headline-link" href="#methoddata">#</a></h4>
<p>A mapping from each entry of <code>methodNames</code> to the
<a href="https://w3c.github.io/payment-request/#declaring-multiple-ways-of-paying" rel="noopener"><code>methodData</code></a>.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> methodData<span class="token operator">:</span> Bundle<span class="token operator">?</span> <span class="token operator">=</span> extras<span class="token punctuation">.</span><span class="token function">getBundle</span><span class="token punctuation">(</span><span class="token string">"methodData"</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><h4 id="toplevelorigin"><code>topLevelOrigin</code> <a class="w-headline-link" href="#toplevelorigin">#</a></h4>
<p>The merchant's origin without the scheme (the scheme-less origin of the
top-level browsing context). For example, <code>https://mystore.com/checkout</code> will be
passed as <code>mystore.com</code>.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> topLevelOrigin<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> extras<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"topLevelOrigin"</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><h4 id="toplevelcertificatechain"><code>topLevelCertificateChain</code> <a class="w-headline-link" href="#toplevelcertificatechain">#</a></h4>
<p>The merchant's certificate chain (the certificate chain of the top-level
browsing context). Null for localhost and file on disk, which are both secure
contexts without SSL certificates. The certificate chain is necessary because a
payment app might have different trust requirements for websites.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> topLevelCertificateChain<span class="token operator">:</span> Array<span class="token operator">&lt;</span>Parcelable<span class="token operator">></span><span class="token operator">?</span> <span class="token operator">=</span><br>    extras<span class="token punctuation">.</span><span class="token function">getParcelableArray</span><span class="token punctuation">(</span><span class="token string">"topLevelCertificateChain"</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><p>Each <code>Parcelable</code> is a <code>Bundle</code> with a <code>&quot;certificate&quot;</code> key and a byte array
value.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> list<span class="token operator">:</span> List<span class="token operator">&lt;</span>ByteArray<span class="token operator">></span><span class="token operator">?</span> <span class="token operator">=</span> topLevelCertificateChain<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">mapNotNull</span> <span class="token punctuation">{</span> p <span class="token operator">-></span><br>  <span class="token punctuation">(</span>p <span class="token keyword">as</span> Bundle<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getByteArray</span><span class="token punctuation">(</span><span class="token string">"certificate"</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><h4 id="paymentrequestorigin"><code>paymentRequestOrigin</code> <a class="w-headline-link" href="#paymentrequestorigin">#</a></h4>
<p>The schemeless origin of the iframe browsing context that invoked the <code>new PaymentRequest(methodData, details, options)</code> constructor in JavaScript. If the
constructor was invoked from the top-level context, then the value of this
parameter equals the value of <code>topLevelOrigin</code> parameter.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> paymentRequestOrigin<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> extras<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"paymentRequestOrigin"</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><h3 id="response">Response <a class="w-headline-link" href="#response">#</a></h3>
<p>The service can send its response via <code>handleIsReadyToPay(Boolean)</code> method.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin">callback<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">handleIsReadyToPay</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><h3 id="permission">Permission <a class="w-headline-link" href="#permission">#</a></h3>
<p>You can use <code>Binder.getCallingUid()</code> to check who the caller is. Note that you
have to do this in the <code>isReadyToPay</code> method, not in the <code>onBind</code> method.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">isReadyToPay</span><span class="token punctuation">(</span>callback<span class="token operator">:</span> IsReadyToPayServiceCallback<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    <span class="token keyword">val</span> callingPackage <span class="token operator">=</span> packageManager<span class="token punctuation">.</span><span class="token function">getNameForUid</span><span class="token punctuation">(</span>Binder<span class="token punctuation">.</span><span class="token function">getCallingUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token comment">// …</span></code></pre>
</web-copy-code><p>See <a href="#heading=h.czr8ye23zg2e">Verify the caller's signing certificate</a> about how
to verify that the calling package has the right signature.</p>
<h2 id="step-3:-let-a-customer-make-payment">Step 3: Let a customer make payment <a class="w-headline-link" href="#step-3:-let-a-customer-make-payment">#</a></h2>
<p>The merchant calls <code>show()</code> to <a href="/life-of-a-payment-transaction#step-4:-the-browser-launches-the-payment-app">launch the payment
app</a>
so the customer can make a payment. The payment app is invoked via an Android
intent <code>PAY</code> with transaction information in the intent parameters.</p>
<p>The payment app responds with <code>methodName</code> and <code>details</code>, which are payment app
specific and are opaque to the browser. The browser converts the <code>details</code>
string into a JavaScript object for the merchant via JSON deserialization, but
does not enforce any validity beyond that. The browser does not modify the
<code>details</code>; that parameter's value is passed directly to the merchant.</p>
<h3 id="androidmanifest.xml-2"><code>AndroidManifest.xml</code> <a class="w-headline-link" href="#androidmanifest.xml-2">#</a></h3>
<p>The activity with the <code>PAY</code> intent filter should have a <code>&lt;meta-data&gt;</code> tag <a href="/setting-up-a-payment-method">that
identifies the default payment method identifier for the
app</a>.</p>
<p>To support multiple payment methods, add a <code>&lt;meta-data&gt;</code> tag with a
<code>&lt;string-array&gt;</code> resource.</p>
<web-copy-code><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span><br>  <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.PaymentActivity<span class="token punctuation">"</span></span><br>  <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/Theme.SamplePay.Dialog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.chromium.intent.action.PAY<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">></span></span><br><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span><br>    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.chromium.default_payment_method_name<span class="token punctuation">"</span></span><br>    <span class="token attr-name"><span class="token namespace">android:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://bobpay.xyz/pay<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span><br>    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.chromium.payment_method_names<span class="token punctuation">"</span></span><br>    <span class="token attr-name"><span class="token namespace">android:</span>resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@array/method_names<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">></span></span></code></pre>
</web-copy-code><p>The <code>resource</code> must be a list of strings, each of which must be a valid,
absolute URL with an HTTPS scheme as shown here.</p>
<web-copy-code><pre class="language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string-array</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>method_names<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">></span></span>https://alicepay.com/put/optional/path/here<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">></span></span>https://charliepay.com/put/optional/path/here<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string-array</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">></span></span></code></pre>
</web-copy-code><h3 id="parameters-2">Parameters <a class="w-headline-link" href="#parameters-2">#</a></h3>
<p>The following parameters are passed to the activity as Intent extras:</p>
<ul>
<li><code>methodNames</code></li>
<li><code>methodData</code></li>
<li><code>topLevelOrigin</code></li>
<li><code>topLevelCertificateChain</code></li>
<li><code>paymentRequestOrigin</code></li>
<li><code>total</code></li>
<li><code>modifiers</code></li>
<li><code>paymentRequestId</code></li>
</ul>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> extras<span class="token operator">:</span> Bundle<span class="token operator">?</span> <span class="token operator">=</span> intent<span class="token operator">?</span><span class="token punctuation">.</span>extras</code></pre>
</web-copy-code><h4 id="methodnames-2">methodNames <a class="w-headline-link" href="#methodnames-2">#</a></h4>
<p>The names of the methods being used. The elements are the keys in the
<code>methodData</code> dictionary. These are the methods that the payment app supports.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> methodNames<span class="token operator">:</span> List<span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token operator">?</span> <span class="token operator">=</span> extras<span class="token punctuation">.</span><span class="token function">getStringArrayList</span><span class="token punctuation">(</span><span class="token string">"methodNames"</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><h4 id="methoddata-2"><code>methodData</code> <a class="w-headline-link" href="#methoddata-2">#</a></h4>
<p>A mapping from each of the <code>methodNames</code> to the
<a href="https://w3c.github.io/payment-request/#declaring-multiple-ways-of-paying" rel="noopener"><code>methodData</code></a>.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> methodData<span class="token operator">:</span> Bundle<span class="token operator">?</span> <span class="token operator">=</span> extras<span class="token punctuation">.</span><span class="token function">getBundle</span><span class="token punctuation">(</span><span class="token string">"methodData"</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><h4 id="merchantname">merchantName <a class="w-headline-link" href="#merchantname">#</a></h4>
<p>The contents of the <code>&lt;title&gt;</code> HTML tag of the merchant's checkout page (the
browser's top-level browsing context).</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> merchantName<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> extras<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"merchantName"</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><h4 id="toplevelorigin-2"><code>topLevelOrigin</code> <a class="w-headline-link" href="#toplevelorigin-2">#</a></h4>
<p>The merchant's origin without the scheme (The scheme-less origin of the
top-level browsing context). For example, <code>https://mystore.com/checkout</code> is
passed as <code>mystore.com</code>.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> topLevelOrigin<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> extras<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"topLevelOrigin"</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><h4 id="toplevelcertificatechain-2"><code>topLevelCertificateChain</code> <a class="w-headline-link" href="#toplevelcertificatechain-2">#</a></h4>
<p>The merchant's certificate chain (The certificate chain of the top-level
browsing context). Null for localhost and file on disk, which are both secure
contexts without SSL certificates. Each <code>Parcelable</code> is a Bundle with a
<code>certificate</code> key and a byte array value.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> topLevelCertificateChain<span class="token operator">:</span> Array<span class="token operator">&lt;</span>Parcelable<span class="token operator">></span><span class="token operator">?</span> <span class="token operator">=</span><br>    extras<span class="token punctuation">.</span><span class="token function">getParcelableArray</span><span class="token punctuation">(</span><span class="token string">"topLevelCertificateChain"</span><span class="token punctuation">)</span><br><span class="token keyword">val</span> list<span class="token operator">:</span> List<span class="token operator">&lt;</span>ByteArray<span class="token operator">></span><span class="token operator">?</span> <span class="token operator">=</span> topLevelCertificateChain<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">mapNotNull</span> <span class="token punctuation">{</span> p <span class="token operator">-></span><br>  <span class="token punctuation">(</span>p <span class="token keyword">as</span> Bundle<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getByteArray</span><span class="token punctuation">(</span><span class="token string">"certificate"</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><h4 id="paymentrequestorigin-2"><code>paymentRequestOrigin</code> <a class="w-headline-link" href="#paymentrequestorigin-2">#</a></h4>
<p>The scheme-less origin of the iframe browsing context that invoked the <code>new PaymentRequest(methodData, details, options)</code> constructor in JavaScript. If the
constructor was invoked from the top-level context, then the value of this
parameter equals the value of <code>topLevelOrigin</code> parameter.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> paymentRequestOrigin<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> extras<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"paymentRequestOrigin"</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><h4 id="total"><code>total</code> <a class="w-headline-link" href="#total">#</a></h4>
<p>The JSON string representing the total amount of the transaction.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> total<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> extras<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"total"</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><p>Here's an example content of the string:</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token punctuation">{</span><span class="token string">"currency"</span><span class="token operator">:</span><span class="token string">"USD"</span><span class="token punctuation">,</span><span class="token string">"value"</span><span class="token operator">:</span><span class="token string">"25.00"</span><span class="token punctuation">}</span></code></pre>
</web-copy-code><h4 id="modifiers"><code>modifiers</code> <a class="w-headline-link" href="#modifiers">#</a></h4>
<p>The output of <code>JSON.stringify(details.modifiers)</code>, where <code>details.modifiers</code>
contain only <code>supportedMethods</code> and <code>total</code>.</p>
<h4 id="paymentrequestid"><code>paymentRequestId</code> <a class="w-headline-link" href="#paymentrequestid">#</a></h4>
<p>The <code>PaymentRequest.id</code> field that &quot;push-payment&quot; apps should associate with the
transaction state. Merchant websites will use this field to query the
&quot;push-payment&quot; apps for the state of transaction out of band.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> paymentRequestId<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> extras<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"paymentRequestId"</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><h3 id="response-2">Response <a class="w-headline-link" href="#response-2">#</a></h3>
<p>The activity can send its response back through <code>setResult</code> with <code>RESULT_OK</code>.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token function">setResult</span><span class="token punctuation">(</span>Activity<span class="token punctuation">.</span>RESULT_OK<span class="token punctuation">,</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span><br>  <span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"methodName"</span><span class="token punctuation">,</span> <span class="token string">"https://bobpay.xyz/pay"</span><span class="token punctuation">)</span><br>  <span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"details"</span><span class="token punctuation">,</span> <span class="token string">"{\"token\": \"put-some-data-here\"}"</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><p>You must specify two parameters as Intent extras:</p>
<ul>
<li><code>methodName</code>: The name of the method being used.</li>
<li><code>details</code>: JSON string containing information necessary for the merchant to
complete the transaction. If success is <code>true</code>, then <code>details</code> must be
constructed in such a way that <code>JSON.parse(details)</code> will succeed.</li>
</ul>
<p>You can pass <code>RESULT_CANCELED</code> if the transaction was not completed in the
payment app, for example, if the user failed to type in the correct PIN code for
their account in the payment app. The browser may let the user choose a
different payment app.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token function">setResult</span><span class="token punctuation">(</span>RESULT_CANCELED<span class="token punctuation">)</span><br><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
</web-copy-code><p>If the activity result of a payment response received from the invoked payment
app is set to <code>RESULT_OK</code>, then Chrome will check for non-empty <code>methodName</code> and
<code>details</code> in its extras. If the validation fails Chrome will return a rejected
promise from <code>request.show()</code> with one of the following developer facing error
messages:</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token string">'Payment app returned invalid response. Missing field "details".'</span><br><span class="token string">'Payment app returned invalid response. Missing field "methodName".'</span></code></pre>
</web-copy-code><h3 id="permission-2">Permission <a class="w-headline-link" href="#permission-2">#</a></h3>
<p>The activity can check the caller with its <code>getCallingPackage()</code> method.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> caller<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> callingPackage</code></pre>
</web-copy-code><p>The final step is to verify the caller's signing certificate to confirm that the
calling package has the right signature.</p>
<h2 id="step-4:-verify-the-caller's-signing-certificate">Step 4: Verify the caller's signing certificate <a class="w-headline-link" href="#step-4:-verify-the-caller's-signing-certificate">#</a></h2>
<p>You can check the caller's package name with <code>Binder.getCallingUid()</code> in
<code>IS_READY_TO_PAY</code>, and with <code>Activity.getCallingPackage()</code> in <code>PAY</code>. In order to
actually verify that the caller is the browser you have in mind, you should
check its signing certificate and make sure that it matches with the correct
value.</p>
<p>If you're targeting API level 28 and above and are integrating with a browser
that has a single signing certificate, you can use
<code>PackageManager.hasSigningCertificate()</code>.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> packageName<span class="token operator">:</span> String <span class="token operator">=</span> … <span class="token comment">// The caller's package name</span><br><span class="token keyword">val</span> certificate<span class="token operator">:</span> ByteArray <span class="token operator">=</span> … <span class="token comment">// The correct signing certificate.</span><br><span class="token keyword">val</span> verified <span class="token operator">=</span> packageManager<span class="token punctuation">.</span><span class="token function">hasSigningCertificate</span><span class="token punctuation">(</span><br>  callingPackage<span class="token punctuation">,</span><br>  certificate<span class="token punctuation">,</span><br>  PackageManager<span class="token punctuation">.</span>CERT_INPUT_SHA256<br><span class="token punctuation">)</span></code></pre>
</web-copy-code><p><code>PackageManager.hasSigningCertificate()</code> is preferred for single certificate
browsers, because it correctly handles certificate rotation. (Chrome has a
single signing certificate.) Apps that have multiple signing certificates cannot
rotate them.</p>
<p>If you need to support older API levels 27 and below, or if you need to handle
browsers with multiple signing certificates, you can use
<code>PackageManager.GET_SIGNATURES</code>.</p>
<web-copy-code><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> packageName<span class="token operator">:</span> String <span class="token operator">=</span> … <span class="token comment">// The caller's package name</span><br><span class="token keyword">val</span> certificates<span class="token operator">:</span> Set<span class="token operator">&lt;</span>ByteArray<span class="token operator">></span> <span class="token operator">=</span> … <span class="token comment">// The correct set of signing certificates</span><br><br><span class="token keyword">val</span> packageInfo <span class="token operator">=</span> <span class="token function">getPackageInfo</span><span class="token punctuation">(</span>packageName<span class="token punctuation">,</span> PackageManager<span class="token punctuation">.</span>GET_SIGNATURES<span class="token punctuation">)</span><br><span class="token keyword">val</span> sha256 <span class="token operator">=</span> MessageDigest<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"SHA-256"</span><span class="token punctuation">)</span><br><span class="token keyword">val</span> signatures <span class="token operator">=</span> packageInfo<span class="token punctuation">.</span>signatures<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> sha256<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><br><span class="token keyword">val</span> verified <span class="token operator">=</span> signatures<span class="token punctuation">.</span>size <span class="token operator">==</span> certificates<span class="token punctuation">.</span>size <span class="token operator">&amp;&amp;</span><br>    signatures<span class="token punctuation">.</span><span class="token function">all</span> <span class="token punctuation">{</span> s <span class="token operator">-></span> certificates<span class="token punctuation">.</span><span class="token function">any</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">contentEquals</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></code></pre>
</web-copy-code>

    

    
  <div class="w-chips ">
    
      
    
      
    
      
        
        <a class="w-chip" href="/tags/payments/">Payments</a>
      
    
  </div>


    <div class="w-post-github-link w-mt--l w-mb--l">
      <span class="w-mr--sm">
        
        Last updated: <time>May 25, 2020</time>
        
      </span>
      <a
        href="https://github.com/GoogleChrome/web.dev/blob/main/src/site/content/en/payments/android-payment-apps-developers-guide/index.md"
      >
        Improve article
      </a>
       
    </div>

    
  </div>

  
    
    <nav class="w-article-navigation">
  <a
    class="w-article-navigation__link w-article-navigation__link--back
      w-article-navigation__link--single gc-analytics-event"
    data-category="web.dev"
    data-label="navigation, go back"
    data-action="click"
    href="/blog"
  >
    Return to all articles
  </a>
</nav>
  
</div>


  </div>
</main>
<footer class="w-footer">
  <nav class="w-footer__linkboxes">
    <ul class="w-footer__linkboxes-list">
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Contribute</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&labels=bug&template=bug_report.md&title="
              class="w-footer__linkbox-link" data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              File a bug
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/googlechrome/web.dev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              View source
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Related content</h3>
        <ul class="w-footer__linkbox-list">
         <li class="w-footer__linkbox-item">
            <a href="https://developer.chrome.com/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              developer.chrome.com
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://blog.chromium.org/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Chrome updates
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/fundamentals" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              Web Fundamentals
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/showcase/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">
              Case studies
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/podcasts/" class="w-footer__linkbox-link"
              data-category="Podcasts" data-label="Footer Link (index 5)">
              Podcasts
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/shows/" class="w-footer__linkbox-link"
              data-category="Shows" data-label="Footer Link (index 6)">
              Shows
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Connect</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://www.twitter.com/ChromiumDev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Twitter
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://www.youtube.com/user/ChromeDevelopers" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              YouTube
            </a>
          </li>
        </ul>
      </li>
    </ul>
  </nav>

  <div class="w-footer__utility">
    <nav class="w-footer__utility-nav">
      <a href="https://developers.google.com/" class="w-footer__utility-logo-link"
        data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link">
        <img loading="lazy" width="185" height="33" class="w-footer__utility-logo" src="/images/lockup-color.png"
          alt="Google Developers" />
      </a>
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developer.chrome.com/"
            data-category="Site-Wide Custom Events" data-label="Footer Chrome Link">
            Chrome
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://firebase.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Firebase Link">
            Firebase
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://cloud.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Google Cloud Platform Link">
            Google Cloud Platform
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developers.google.com/products"
            data-category="Site-Wide Custom Events" data-label="Footer All products Link">
            All products
          </a>
        </li>
      </ul>
      <web-language-select current="en"></web-language-select>
    </nav>
    <nav class="w-footer__utility-nav">
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://policies.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Terms and Privacy link">
            Terms &amp; Privacy
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="/community-guidelines/" data-category="Site-Wide Custom Events"
            data-label="Footer Community Guidelines link">
            Community Guidelines
          </a>
        </li>
      </ul>
      <div class="w-footer__license">
        <p>
          Except as otherwise noted, the content of this page is licensed
          under the
          <a href="https://creativecommons.org/licenses/by/4.0/">
          Creative Commons Attribution 4.0 License</a>,
          and code samples are licensed under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">
          Apache 2.0 License</a>. For details, see the
          <a href="https://developers.google.com/terms/site-policies">
          Google Developers Site Policies</a>.
        </p>
      </div>
    </nav>
  </div>
</footer>

  </body>
</html>
