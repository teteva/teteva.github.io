
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">


  
    
    <link rel="stylesheet" href="/css/main.css?v=e2c795919caf8">
  

  <link rel="preload" as="font" crossorigin href="/fonts/material-icons/regular.woff2">


<link rel="preload" as="font" crossorigin href="/fonts/google-sans/regular/latin.woff2">
<link rel="preload" as="font" crossorigin href="/fonts/google-sans/bold/latin.woff2">

<meta name="theme-color" content="#fff"/>




<title>Media encryption</title>
<meta name="description" content="Learn digital rights management concepts, and the commands needed to get from a raw mov file to encrypted media packaged for MPEG-DASH or HLS using both Clear Key or Widevine encryption. " />

<link rel="canonical" href="https://web.dev/media-encryption/" />

<meta itemprop="name" content="Media encryption" />
<meta itemprop="description" content="Learn digital rights management concepts, and the commands needed to get from a raw mov file to encrypted media packaged for MPEG-DASH or HLS using both Clear Key or Widevine encryption. " />
<meta itemprop="image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://web.dev/media-encryption/" />
<meta property="og:site_name" content="web.dev" />
<meta property="og:title" content="Media encryption" />
<meta property="og:description" content="Learn digital rights management concepts, and the commands needed to get from a raw mov file to encrypted media packaged for MPEG-DASH or HLS using both Clear Key or Widevine encryption. " />
<meta property="og:image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:image:alt" content="" />
<meta property="tag" content="media" />
<meta property="tag" content="audio" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Media encryption" />
<meta name="twitter:description" content="Learn digital rights management concepts, and the commands needed to get from a raw mov file to encrypted media packaged for MPEG-DASH or HLS using both Clear Key or Widevine encryption. " />
<meta name="twitter:image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<link
  rel="alternate"
  href="/feed.xml"
  type="application/atom+xml"
  data-title="web.dev feed"
/>

<link rel="manifest" href="/manifest.webmanifest" />

<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="mask-icon" color="#0054ff" href="/images/safari-pinned-tab.svg">



<script>
window.ga =
  window.ga ||
  function () {
    (ga.q = ga.q || []).push(arguments);
  };
ga.l = +new Date();
ga('create', 'UA-126406676-2');
ga('set', 'transport', 'beacon');
ga('set', 'anonymizeIp', true);
ga('set', 'page', window.location.pathname);
ga('set', 'dimension5', '4');
ga('send', 'pageview');
</script>







<script>
function loadScript(url, type) {
  const s = document.createElement('script');
  s.src = url;
  if (type) {
    s.type = type;
  }
  if (type === 'module') {
    s.async = false; // Preserve load order.
    const pre = document.createElement('link');
    pre.rel = 'modulepreload';
    pre.href = url;
    document.head.append(pre);
    // We use DOMContentLoaded as the loader script is running sync, and inserting a module script here doesn't defer. This brings back normal type="module" behavior.
    window.addEventListener('DOMContentLoaded', () => {
      document.head.append(s);
    });
  } else {
    document.head.append(s);
  }
}
loadScript('/js/app.js?v=b683b283cd7d7', 'module');




  loadScript('/js/content.js?v=f127954ac730a', 'module');


  loadScript('https://www.google-analytics.com/analytics.js', null);

</script>

  </head>
  <body class="unresolved">
    
    <web-snackbar-container></web-snackbar-container>

    



<web-header class="header-default" role="navigation">
  <button data-open-drawer-button class="w-button--svg w-button--round" aria-label="Open menu">
    








  










  <svg class="icon " role="img" aria-label="menu" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>


    <span class="w-tooltip w-tooltip--left">Open menu</span>
  </button>

  <a
    href="/"
    class="header-default__logo-link gc-analytics-event"
    data-category="Site-Wide Custom Events"
    data-label="Site logo"
  >
    <img class="header-default__logo" width="125" height="23" src="/images/lockup.svg" alt="web.dev" />
  </a>

  <div class="header-default__middle">
    <div class="header-default__links">
      <a
        href="/learn/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Learn"
      >
        Learn
      </a>

      <a
        href="/measure/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Measure"
      >
        Measure
      </a>

      <a
        href="/blog/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Blog"
      >
        Blog
      </a>

      <a
        href="/about/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: About"
      >
        About
      </a>
    </div>
    <web-search results-id="search-main-results" i18n="{&quot;search&quot;:{&quot;en&quot;:&quot;Search&quot;},&quot;open_search&quot;:{&quot;en&quot;:&quot;Open search&quot;},&quot;all_articles&quot;:{&quot;en&quot;:&quot;All articles&quot;},&quot;close_search&quot;:{&quot;en&quot;:&quot;Close search&quot;}}"></web-search>
    <web-search-results id="search-main-results"></web-search-results>
  </div>

  <web-profile-switcher-container></web-profile-switcher-container>
</web-header>



<web-navigation-drawer class="drawer-default" type="modal">
  <nav data-drawer-container>
    <div class="drawer-default__contents">
      <div class="drawer-default__header">
        <button
          data-drawer-close-button
          class="drawer-default__hide w-button--svg w-button--round"
          aria-label="Close"
        >
          








  










  <svg class="icon " role="img" aria-label="close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>


          <span class="w-tooltip">Close</span>
        </button>
        <a
          href="/"
          class="gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Site logo"
        >
          <img
            width="125"
            height="30"
            class="drawer-default__logo"
            src="/images/lockup.svg"
            alt="web.dev"
          />
        </a>
      </div>
      <a
        href="/learn/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Learn"
      >
        Learn
      </a>
      <a
        href="/measure/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Measure"
      >
        Measure
      </a>
      <a
        href="/blog/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Blog"
      >
        Blog
      </a>
      <a
        href="/about/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: About"
      >
        About
      </a>
    </div>
  </nav>
</web-navigation-drawer>

<main>
  <div id="content">
    
      
    
    


<div class="guide-landing-page">
  
    
    
    
  
  

  

  <web-table-of-contents>
    <h2 class="w-toc__header">
      <a href="#media-encryption" class="w-toc__header--link">
        Media encryption
      </a>
    </h2>
    <div class="w-toc__list">
        <ul><li><a href="#clear-key-encryption">Clear Key encryption</a><ol><li><a href="#create-a-key">Create a key</a></li><li><a href="#create-an-iv">Create an IV</a></li><li><a href="#encrypt-with-clear-key">Encrypt with Clear Key</a></li><li><a href="#create-a-key-information-file">Create a key information file</a></li><li><a href="#encrypt-for-hls">Encrypt for HLS</a></li></ol></li><li><a href="#widevine-encryption">Widevine encryption</a><ol><li><a href="#encrypt-with-widevine">Encrypt with Widevine</a></li></ol></li><li><a href="#media-conversion-sequence">Media conversion sequence</a><ol><li><a href="#dashwebm">DASH/WebM</a></li><li><a href="#dashmp4">DASH/MP4</a></li><li><a href="#hlsmp4">HLS/MP4</a></li></ol></li></ul></div>
  </web-table-of-contents>
  <web-table-of-contents-button></web-table-of-contents-button>

  
  <div class="w-actions">
    <share-action authors="@derekherman | @medleyjp"
      class="gc-analytics-event w-actions__fab w-actions__fab--share"
      data-category="web.dev"
      data-label="share"
      data-action="click"
      data-icon="share"
      tabindex="0"
      role="button"
    >
      <span>Share</span>
    </share-action>
    
    
  </div>

  <div class="w-layout-container--narrow w-post-content">
    <header class="w-article-header">
      

      <h1 id="media-encryption" class="w-article-header__headline">Media encryption</h1>
      

      
        <div class="w-author__published">
          <time>Jul 5, 2021</time>
           <span class="w-author__separator">•</span> Updated <time>Jul 5, 2021</time> 
        </div>
      

      
      

      <div class="w-layout-container--narrow w-post-signpost">
  <span class="w-post-signpost__title">
    Appears in:
  </span>
  <a
          class="w-post-signpost__link"
          href="/media"
          >Media</a
        >
</div>

      
        <div class="w-authors w-mt--xl w-pt--sm">
          
            <div class="w-author">
  <a href="/authors/derekherman/"><img     alt="Derek Herman"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/8L1ESx211yWBm8uNAgqvUc2GwNk1/Co3mEQ34Z8eAw6lPGx5o.jpg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/8L1ESx211yWBm8uNAgqvUc2GwNk1/Co3mEQ34Z8eAw6lPGx5o.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/8L1ESx211yWBm8uNAgqvUc2GwNk1/Co3mEQ34Z8eAw6lPGx5o.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/8L1ESx211yWBm8uNAgqvUc2GwNk1/Co3mEQ34Z8eAw6lPGx5o.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/8L1ESx211yWBm8uNAgqvUc2GwNk1/Co3mEQ34Z8eAw6lPGx5o.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/8L1ESx211yWBm8uNAgqvUc2GwNk1/Co3mEQ34Z8eAw6lPGx5o.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /></a>
  <div
    class="w-author__info"
    style="display: flex; flex-direction: column; justify-content: center;"
  >
    <cite class="w-author__name">
      <a class="w-author__name-link" href="/authors/derekherman/">Derek Herman</a>
    </cite>
    <ul class="w-author__link-list">
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://twitter.com/derekherman"
          >Twitter</a
        >
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://github.com/derekherman">GitHub</a>
      </li>
      
      
    </ul>
  </div>
</div>
          
            <div class="w-author">
  <a href="/authors/joemedley/"><img     alt="Joe Medley"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/ynJFmvKEbD9diZZsTdkD.jpg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/admin/ynJFmvKEbD9diZZsTdkD.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/admin/ynJFmvKEbD9diZZsTdkD.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/admin/ynJFmvKEbD9diZZsTdkD.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/admin/ynJFmvKEbD9diZZsTdkD.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/admin/ynJFmvKEbD9diZZsTdkD.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /></a>
  <div
    class="w-author__info"
    style="display: flex; flex-direction: column; justify-content: center;"
  >
    <cite class="w-author__name">
      <a class="w-author__name-link" href="/authors/joemedley/">Joe Medley</a>
    </cite>
    <ul class="w-author__link-list">
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://twitter.com/medleyjp"
          >Twitter</a
        >
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://github.com/jpmedley">GitHub</a>
      </li>
      
      
    </ul>
  </div>
</div>
          
        </div>
      
    </header>

    

    <p>In this section we are going to cover two different strategies for encrypting
your media, and some practical examples on how to use them with FFmpeg and
Shaka Packager. The two strategies for encryption we'll discuss are <a href="https://w3c.github.io/encrypted-media/index.html#clear-key" rel="noopener">Clear Key</a> and
using a service like <a href="https://www.widevine.com/" rel="noopener">Google Widevine</a>. Both strategies are a form of digital
rights management (<a href="https://en.wikipedia.org/wiki/Digital_rights_management" rel="noopener">DRM</a>) to control what users can do with your media. However,
one is inherently less secure than the other due to the way keys are passed for
authentication and is why a DRM service might make more sense.</p>
<p>The primary DRM services for the web are <a href="https://www.widevine.com/" rel="noopener">Google Widevine</a>, <a href="https://www.microsoft.com/playready/" rel="noopener">Microsoft PlayReady</a>
and <a href="https://developer.apple.com/streaming/fps/" rel="noopener">Apple FairPlay</a>, but we will not be covering all of them in this article.
However, if you are targeting all the modern browsers you are likely going
to be using all three DRM services.</p>
<p>Conversion and encryption is done with these applications:</p>
<ul>
<li><a href="https://github.com/google/shaka-packager" rel="noopener">Shaka Packager</a> (<a href="https://stackoverflow.com/questions/tagged/shaka" rel="noopener">#shaka on Stack Overflow</a>)</li>
<li><a href="https://ffmpeg.org/download.html" rel="noopener">FFmpeg</a> (<a href="https://stackoverflow.com/questions/tagged/ffmpeg" rel="noopener">#ffmpeg on Stack Overflow</a>)</li>
<li><a href="https://www.openssl.org/" rel="noopener">OpenSSL</a> (<a href="https://stackoverflow.com/questions/tagged/openssl" rel="noopener">#openssl on Stack Overflow</a>)</li>
</ul>
<h2 id="clear-key-encryption">Clear Key encryption <a class="w-headline-link" href="#clear-key-encryption">#</a></h2>
<p>First, you should have a good understanding of what Clear Key is and isn't before
using it. When you do <em><strong>not</strong></em> want to use an existing DRM service and feel
basic encryption of you media is a viable option, you would use Clear Key. But,
keep in mind that this type of encryption does not provide the same level of
security as using one of the DRM services. This is because the key value pair is
not encrypted under another key, unlike encrypted keys which are generated by a
decryption key that is stored on a licence server. Additionally, Clear Key sends
the key value pair as plain text, so while you are encrypting your media the key to
decrypt it is not a secret.</p>
<h3 id="create-a-key">Create a key <a class="w-headline-link" href="#create-a-key">#</a></h3>
<p>You can use the same method to create a key for both DASH and HLS. Do this using
<a href="https://www.openssl.org/" rel="noopener">OpenSSL</a>. The following will create an encryption key made of 16 hex values.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">openssl rand -hex <span class="token number">16</span> <span class="token operator">></span> media.key</code></pre>
</web-copy-code><div class="w-aside w-aside--caution">
<p><strong>Caution</strong>:
This command creates a file that could contain white space and new line characters,
which are not allowed by Shaka Packager. You'll need to open the key file and
manually remove all whitespace including the final carriage return.</p>
</div>
<h3 id="create-an-iv">Create an IV <a class="w-headline-link" href="#create-an-iv">#</a></h3>
<p>Next we can generate an initialization vector (IV).</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">openssl rand -hex <span class="token number">16</span><br>6143b5373a51cb46209cfed0d747da66</code></pre>
</web-copy-code><div class="w-aside w-aside--note">
<p>Make a note of the output, you'll need this later.</p>
</div>
<h3 id="encrypt-with-clear-key">Encrypt with Clear Key <a class="w-headline-link" href="#encrypt-with-clear-key">#</a></h3>
<p>The following example uses <a href="https://google.github.io/shaka-packager/html/tutorials/raw_key.html" rel="noopener">Shaka Packager with raw keys</a>, where <code>keys</code> and
<code>key_ids</code> are provided to Shaka Packager directly. Read the documentation for
more examples.</p>
<p>For the <code>key</code> flag, use the key created earlier, which is stored in the <code>media.key</code>
file. However, when entering it on the command line, be sure you've removed its
whitespace. For the <code>key_id</code> flag, repeat the <code>media.id</code> value or use the IV value
generated above.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">packager <span class="token punctuation">\</span><br>  <span class="token assign-left variable">input</span><span class="token operator">=</span>glocken.mp4,stream<span class="token operator">=</span>audio,output<span class="token operator">=</span>glockena.m4a <span class="token punctuation">\</span><br>  <span class="token assign-left variable">input</span><span class="token operator">=</span>glocken.mp4,stream<span class="token operator">=</span>video,output<span class="token operator">=</span>glockenv.mp4 <span class="token punctuation">\</span><br>  --enable_fixed_key_encryption <span class="token punctuation">\</span><br>  --keys <span class="token assign-left variable">label</span><span class="token operator">=</span>audio:key<span class="token operator">=</span>INSERT_AUDIO_KEY_HERE:key_id<span class="token operator">=</span>INSERT_AUDIO_KEY_ID_HERE,label<span class="token operator">=</span>video:key<span class="token operator">=</span>INSERT_VIDEO_KEY_HERE:key_id<span class="token operator">=</span>INSERT_VIDEO_KEY_ID_HERE</code></pre>
</web-copy-code><div class="w-aside w-aside--note">
<p>Note that we can also encrypt both <code>video</code> and <code>audio</code> streams using the same <code>keys</code>
by omitting the label argument instead of defining a different set of <code>keys</code> per-stream.
For example, <code>--keys label=:key=INSERT_KEY_HERE:key_id=INSERT_KEY_ID_HERE</code>. However,
this would decrease the level of security when protecting your streams.</p>
</div>
<h3 id="create-a-key-information-file">Create a key information file <a class="w-headline-link" href="#create-a-key-information-file">#</a></h3>
<p>To encrypt for HLS you need a key information file in addition to a key file. A
key information file is a text file with the format below. It should have the
extension <code>.keyinfo</code>. For example: <code>encrypt.keyinfo</code>.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">key URI<br>key <span class="token function">file</span> path<br>private key</code></pre>
</web-copy-code><p>The key URI is where the <code>media.key</code> (<a href="#create-a-key">created above</a> will be
located on your server. The key file path is its location relative to the key
information file. Finally, the private key is the contents of the <code>media.key</code>
file itself, or the IV you created before. For example:</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">https://example.com/keys/media.key<br>/path/to/media.key<br>6143b5373a51cb46209cfed0d747da66</code></pre>
</web-copy-code><h3 id="encrypt-for-hls">Encrypt for HLS <a class="w-headline-link" href="#encrypt-for-hls">#</a></h3>
<web-copy-code><pre class="language-bash"><code class="language-bash">packager <span class="token punctuation">\</span><br>  <span class="token string">'input=input.mp4,stream=video,segment_template=output$Number$.ts,playlist_name=video_playlist.m3u8'</span> <span class="token punctuation">\</span><br>  <span class="token string">'input=input.mp4,stream=audio,segment_template=output_audio$Number$.ts,playlist_name=audio_playlist.m3u8,hls_group_id=audio,hls_name=ENGLISH'</span> <span class="token punctuation">\</span><br>  --hls_master_playlist_output<span class="token operator">=</span><span class="token string">"master_playlist.m3u8"</span> <span class="token punctuation">\</span><br>  --hls_base_url<span class="token operator">=</span><span class="token string">"http://localhost:5000/"</span></code></pre>
</web-copy-code><p>This command will accept a key with either 16 or 32 characters.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">ffmpeg -i myvideo.mov -c:v libx264 -c:a aac -hls_key_info_file encrypt.keyinfo myvideo.m3u8</code></pre>
</web-copy-code><h2 id="widevine-encryption">Widevine encryption <a class="w-headline-link" href="#widevine-encryption">#</a></h2>
<p>Now you know what Clear Key encryption is and when to use it. But, when should you use a DRM service for additional security? This is where Widevine, or another service,
would be used to securely encrypt and decrypt your media. Widevine supports MPEG-DASH and
HLS and is a DRM from Google. Widevine is used by the Google Chrome and Firefox web
browsers, Android MediaDRM, Android TV, and other consumer electronics devices that use
Encrypted Media Extensions and Media Source Extensions, where Widevine decrypts content.</p>
<h3 id="encrypt-with-widevine">Encrypt with Widevine <a class="w-headline-link" href="#encrypt-with-widevine">#</a></h3>
<p>Most of the examples in this article used Clear Key encryption. However, for Widevine you
will want to replace the following options.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">--enable_fixed_key_encryption <span class="token punctuation">\</span><br>--enable_fixed_key_decryption <span class="token punctuation">\</span><br>--keys <span class="token assign-left variable">label</span><span class="token operator">=</span>:key<span class="token operator">=</span>INSERT_KEY_HERE:key_id<span class="token operator">=</span>INSERT_KEY_ID_HERE</code></pre>
</web-copy-code><p>Everything in the demultiplexer (demux) command except the name of your files and the
<code>--content-id</code> flag should be copied exactly from the example. The <code>--content-id</code> is 16
or 32 random hex digits. Use the keys provided here instead of your own. Read the Shaka
Packager documentation on using the <a href="https://google.github.io/shaka-packager/html/tutorials/widevine.html" rel="noopener">Widevine Key Server</a> for more examples.</p>
<ol>
<li>
<p>Demux (separate) the audio and video, encrypt the new files, and output a
media presentation description (MPD) file.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">packager <span class="token punctuation">\</span><br>  <span class="token assign-left variable">input</span><span class="token operator">=</span>tmp_glocken.mp4,stream<span class="token operator">=</span>video,output<span class="token operator">=</span>glocken_video.mp4 <span class="token punctuation">\</span><br>  <span class="token assign-left variable">input</span><span class="token operator">=</span>tmp_glocken.mp4,stream<span class="token operator">=</span>audio,output<span class="token operator">=</span>glocken_audio.m4a <span class="token punctuation">\</span><br>  --enable_widevine_encryption <span class="token punctuation">\</span><br>  --key_server_url <span class="token string">"https://license.uat.widevine.com/cenc/getcontentkey/widevine_test"</span> <span class="token punctuation">\</span><br>  --content_id <span class="token string">"fd385d9f9a14bb09"</span> <span class="token punctuation">\</span><br>  --signer <span class="token string">"widevine_test"</span> <span class="token punctuation">\</span><br>  --aes_signing_key <span class="token string">"1ae8ccd0e7985cc0b6203a55855a1034afc252980e970ca90e5202689f947ab9"</span> <span class="token punctuation">\</span><br>  --aes_signing_iv <span class="token string">"d58ce954203b7c9a9a9d467f59839249"</span></code></pre>
</web-copy-code></li>
<li>
<p>Remux (combine) the audio and video streams. If you're using a video
framework, you may not need to do this.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">ffmpeg -i glocken_video.mp4 -i glocken_audio.m4a -c copy glocke.mp4</code></pre>
</web-copy-code></li>
</ol>
<div class="w-aside w-aside--note">
<p>The default pixel format <code>yuv420p</code> is used in all the <code>ffmpeg</code> remux examples in this
article because one isn't supplied in the command line. The <code>ffmpeg</code> command will give
you an error message that it is deprecated. We've chosen not to override the default
because, though deprecated <code>yuv420p</code> is still the most widely supported.</p>
</div>
<h2 id="media-conversion-sequence">Media conversion sequence <a class="w-headline-link" href="#media-conversion-sequence">#</a></h2>
<p>This section shows in order commands needed to get from a raw <code>.mov</code> file to
encrypted assets packaged for DASH or HLS. For the sake of having a goal to
illustrate, we're converting a source file to a bitrate of 8Mbs at a resolution
of 1080p (1920 x 1080). Adjust these values as your needs dictate.</p>
<div class="w-aside w-aside--gotchas"><strong>Gotchas!</strong>
<p>Not all steps are possible with Shaka Packager alone, so we'll also use FFmpeg
when needed.</p>
</div>
<h3 id="dashwebm">DASH/WebM <a class="w-headline-link" href="#dashwebm">#</a></h3>
<ol>
<li>
<p>Convert the file type and codec.</p>
<p>For this command you can use either <code>liborbis</code> or <code>libopus</code> for the audio codec.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">ffmpeg -i glocken.mov -c:v libvpx-vp9 -c:a libvorbis -b:v 8M -vf <span class="token assign-left variable">setsar</span><span class="token operator">=</span><span class="token number">1</span>:1 -f webm tmp_glocken.webm</code></pre>
</web-copy-code></li>
<li>
<p>Create a Clear Key encryption key.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">openssl rand -hex <span class="token number">16</span> <span class="token operator">></span> media.key</code></pre>
</web-copy-code></li>
<li>
<p>Demux (separate) the audio and video, encrypt the new files, and output a
media presentation description (MPD) file.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">packager <span class="token punctuation">\</span><br>  <span class="token assign-left variable">input</span><span class="token operator">=</span>tmp_glocken.webm,stream<span class="token operator">=</span>video,output<span class="token operator">=</span>glocken_video.webm <span class="token punctuation">\</span><br>  <span class="token assign-left variable">input</span><span class="token operator">=</span>tmp_glocken.webm,stream<span class="token operator">=</span>audio,output<span class="token operator">=</span>glocken_audio.webm <span class="token punctuation">\</span><br>  --enable_fixed_key_encryption <span class="token punctuation">\</span><br>  --enable_fixed_key_decryption <span class="token punctuation">\</span><br>  --keys <span class="token assign-left variable">label</span><span class="token operator">=</span>:key<span class="token operator">=</span>INSERT_KEY_HERE:key_id<span class="token operator">=</span>INSERT_KEY_ID_HERE <span class="token punctuation">\</span><br>  --mpd_output glocken_webm_vod.mpd</code></pre>
</web-copy-code></li>
<li>
<p>Remux (combine) the audio and video streams. If you're using a video
framework, you may not need to do this.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">ffmpeg -i glocken_video.webm -i glocken_audio.webm -c copy glocken.webm</code></pre>
</web-copy-code></li>
</ol>
<h3 id="dashmp4">DASH/MP4 <a class="w-headline-link" href="#dashmp4">#</a></h3>
<ol>
<li>
<p>Convert the file type, video codec and bitrate.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">ffmpeg -i glocken.mov -c:v libx264 -c:a aac -b:v 8M -strict -2 tmp_glocken.mp4</code></pre>
</web-copy-code></li>
<li>
<p>Create a Clear Key encryption key.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">openssl rand -hex <span class="token number">16</span> <span class="token operator">></span> media.key</code></pre>
</web-copy-code></li>
<li>
<p>Demux (separate) the audio and video, encrypt the new files, and output a
media presentation description (MPD) file.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">packager <span class="token punctuation">\</span><br>  <span class="token assign-left variable">input</span><span class="token operator">=</span>tmp_glocken.mp4,stream<span class="token operator">=</span>video,output<span class="token operator">=</span>glocken_video.mp4 <span class="token punctuation">\</span><br>  <span class="token assign-left variable">input</span><span class="token operator">=</span>tmp_glocken.mp4,stream<span class="token operator">=</span>audio,output<span class="token operator">=</span>glocken_audio.m4a <span class="token punctuation">\</span><br>  --enable_fixed_key_encryption <span class="token punctuation">\</span><br>  --enable_fixed_key_decryption <span class="token punctuation">\</span><br>  --keys <span class="token assign-left variable">label</span><span class="token operator">=</span>:key<span class="token operator">=</span>INSERT_KEY_HERE:key_id<span class="token operator">=</span>INSERT_KEY_ID_HERE <span class="token punctuation">\</span><br>  --mpd_output glocken_mp4_vod.mpd</code></pre>
</web-copy-code></li>
<li>
<p>Remux (combine) the audio and video streams. If you're using a video
framework, you may not need to do this.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">ffmpeg -i glocken_video.mp4 -i glocken_audio.m4a -c copy glocken.mp4</code></pre>
</web-copy-code></li>
</ol>
<h3 id="hlsmp4">HLS/MP4 <a class="w-headline-link" href="#hlsmp4">#</a></h3>
<p>HLS only supports MP4, so first you'll need to convert to the MP4 container and
supported codecs.</p>
<ol>
<li>
<p>Convert the file type, video codec, and bitrate.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">ffmpeg -i glocken.mov -c:v libx264 -c:a aac -b:v 8M -strict -2 glocken.mp4</code></pre>
</web-copy-code></li>
<li>
<p>Create a Clear Key encryption key.</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">openssl rand -hex <span class="token number">16</span> <span class="token operator">></span> media.key</code></pre>
</web-copy-code></li>
<li>
<p>Create a key information file</p>
<web-copy-code><pre class="language-bash"><code class="language-bash">packager <span class="token punctuation">\</span><br>  <span class="token string">'input=glocken.mp4,stream=video,segment_template=output$Number$.ts,playlist_name=video_playlist.m3u8'</span> <span class="token punctuation">\</span><br>  <span class="token string">'input=glocken.mp4,stream=audio,segment_template=output_audio$Number$.ts,playlist_name=audio_playlist.m3u8,hls_group_id=audio,hls_name=ENGLISH'</span> <span class="token punctuation">\</span><br>  --hls_master_playlist_output<span class="token operator">=</span><span class="token string">"master_playlist.m3u8"</span> <span class="token punctuation">\</span><br>  --hls_base_url<span class="token operator">=</span><span class="token string">"http://localhost:5000/"</span> <span class="token punctuation">\</span><br>  --enable_fixed_key_encryption <span class="token punctuation">\</span><br>  --enable_fixed_key_decryption <span class="token punctuation">\</span><br>  --keys <span class="token assign-left variable">label</span><span class="token operator">=</span>:key<span class="token operator">=</span>INSERT_KEY_HERE:key_id<span class="token operator">=</span>INSERT_KEY_ID_HERE</code></pre>
</web-copy-code></li>
</ol>
<p>That was a lot to digest, but hopefully you are now able to encrypt you media
with confidence. Next we'll show you how to <a href="/add-media/">add media</a> to
your site.</p>


    

    
  <div class="w-chips ">
    
      
    
      
        
        <a class="w-chip" href="/tags/media/">Media</a>
      
    
      
        
        <a class="w-chip" href="/tags/audio/">Audio</a>
      
    
  </div>


    <div class="w-post-github-link w-mt--l w-mb--l">
      <span class="w-mr--sm">
        
        Last updated: <time>Jul 5, 2021</time>
        
      </span>
      <a
        href="https://github.com/GoogleChrome/web.dev/blob/main/src/site/content/en/media/media-encryption/index.md"
      >
        Improve article
      </a>
       
    </div>

    
  </div>

  
    
    <nav class="w-article-navigation">
  <a
    class="w-article-navigation__link w-article-navigation__link--back
      w-article-navigation__link--single gc-analytics-event"
    data-category="web.dev"
    data-label="navigation, go back"
    data-action="click"
    href="/media"
  >
    Return to all articles
  </a>
</nav>
  
</div>


  </div>
</main>
<footer class="w-footer">
  <nav class="w-footer__linkboxes">
    <ul class="w-footer__linkboxes-list">
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Contribute</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&labels=bug&template=bug_report.md&title="
              class="w-footer__linkbox-link" data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              File a bug
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/googlechrome/web.dev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              View source
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Related content</h3>
        <ul class="w-footer__linkbox-list">
         <li class="w-footer__linkbox-item">
            <a href="https://developer.chrome.com/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              developer.chrome.com
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://blog.chromium.org/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Chrome updates
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/fundamentals" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              Web Fundamentals
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/showcase/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">
              Case studies
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/podcasts/" class="w-footer__linkbox-link"
              data-category="Podcasts" data-label="Footer Link (index 5)">
              Podcasts
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/shows/" class="w-footer__linkbox-link"
              data-category="Shows" data-label="Footer Link (index 6)">
              Shows
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Connect</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://www.twitter.com/ChromiumDev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Twitter
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://www.youtube.com/user/ChromeDevelopers" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              YouTube
            </a>
          </li>
        </ul>
      </li>
    </ul>
  </nav>

  <div class="w-footer__utility">
    <nav class="w-footer__utility-nav">
      <a href="https://developers.google.com/" class="w-footer__utility-logo-link"
        data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link">
        <img loading="lazy" width="185" height="33" class="w-footer__utility-logo" src="/images/lockup-color.png"
          alt="Google Developers" />
      </a>
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developer.chrome.com/"
            data-category="Site-Wide Custom Events" data-label="Footer Chrome Link">
            Chrome
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://firebase.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Firebase Link">
            Firebase
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://cloud.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Google Cloud Platform Link">
            Google Cloud Platform
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developers.google.com/products"
            data-category="Site-Wide Custom Events" data-label="Footer All products Link">
            All products
          </a>
        </li>
      </ul>
      <web-language-select current="en"></web-language-select>
    </nav>
    <nav class="w-footer__utility-nav">
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://policies.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Terms and Privacy link">
            Terms &amp; Privacy
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="/community-guidelines/" data-category="Site-Wide Custom Events"
            data-label="Footer Community Guidelines link">
            Community Guidelines
          </a>
        </li>
      </ul>
      <div class="w-footer__license">
        <p>
          Except as otherwise noted, the content of this page is licensed
          under the
          <a href="https://creativecommons.org/licenses/by/4.0/">
          Creative Commons Attribution 4.0 License</a>,
          and code samples are licensed under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">
          Apache 2.0 License</a>. For details, see the
          <a href="https://developers.google.com/terms/site-policies">
          Google Developers Site Policies</a>.
        </p>
      </div>
    </nav>
  </div>
</footer>

  </body>
</html>
