
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">


  
    
    <link rel="stylesheet" href="/css/main.css?v=38eb0feab5ff2">
  

  <link rel="preload" as="font" crossorigin href="/fonts/material-icons/regular.woff2">


<link rel="preload" as="font" crossorigin href="/fonts/google-sans/regular/latin.woff2">
<link rel="preload" as="font" crossorigin href="/fonts/google-sans/bold/latin.woff2">

<meta name="theme-color" content="#fff"/>




<title>Publish, ship, and install modern JavaScript for faster applications</title>
<meta name="description" content="Modern JavaScript offers size and performance improvements over transpiled ES5, and is supported in 95% of web browsers. Enabling modern JavaScript output brings these benefits to your application, but the impact is limited by dependencies that are already transpiled to ES5. This guide demonstrates how to publish modern packages to npm, and how to install and optimally bundle modern JavaScript packages. " />

<link rel="canonical" href="https://web.dev/publish-modern-javascript/" />

<meta itemprop="name" content="Publish, ship, and install modern JavaScript for faster applications" />
<meta itemprop="description" content="Modern JavaScript offers size and performance improvements over transpiled ES5, and is supported in 95% of web browsers. Enabling modern JavaScript output brings these benefits to your application, but the impact is limited by dependencies that are already transpiled to ES5. This guide demonstrates how to publish modern packages to npm, and how to install and optimally bundle modern JavaScript packages. " />
<meta itemprop="image" content="https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://web.dev/publish-modern-javascript/" />
<meta property="og:site_name" content="web.dev" />
<meta property="og:title" content="Publish, ship, and install modern JavaScript for faster applications" />
<meta property="og:description" content="Modern JavaScript offers size and performance improvements over transpiled ES5, and is supported in 95% of web browsers. Enabling modern JavaScript output brings these benefits to your application, but the impact is limited by dependencies that are already transpiled to ES5. This guide demonstrates how to publish modern packages to npm, and how to install and optimally bundle modern JavaScript packages. " />
<meta property="og:image" content="https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:image:alt" content="" />
<meta property="tag" content="performance" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Publish, ship, and install modern JavaScript for faster applications" />
<meta name="twitter:description" content="Modern JavaScript offers size and performance improvements over transpiled ES5, and is supported in 95% of web browsers. Enabling modern JavaScript output brings these benefits to your application, but the impact is limited by dependencies that are already transpiled to ES5. This guide demonstrates how to publish modern packages to npm, and how to install and optimally bundle modern JavaScript packages. " />
<meta name="twitter:image" content="https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&fit=max&w=1200&fm=auto" />
<link
  rel="alternate"
  href="/feed.xml"
  type="application/atom+xml"
  data-title="web.dev feed"
/>

<link rel="manifest" href="/manifest.webmanifest" />

<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="mask-icon" color="#0054ff" href="/images/safari-pinned-tab.svg">



<script>
window.ga =
  window.ga ||
  function () {
    (ga.q = ga.q || []).push(arguments);
  };
ga.l = +new Date();
ga('create', 'UA-126406676-2');
ga('set', 'transport', 'beacon');
ga('set', 'anonymizeIp', true);
ga('set', 'page', window.location.pathname);
ga('set', 'dimension5', '4');
ga('send', 'pageview');
</script>







<script>
function loadScript(url, type) {
  const s = document.createElement('script');
  s.src = url;
  if (type) {
    s.type = type;
  }
  if (type === 'module') {
    s.async = false; // Preserve load order.
    const pre = document.createElement('link');
    pre.rel = 'modulepreload';
    pre.href = url;
    document.head.append(pre);
    // We use DOMContentLoaded as the loader script is running sync, and inserting a module script here doesn't defer. This brings back normal type="module" behavior.
    window.addEventListener('DOMContentLoaded', () => {
      document.head.append(s);
    });
  } else {
    document.head.append(s);
  }
}
loadScript('/js/app.js?v=bb6f1ea33193a', 'module');




  loadScript('/js/content.js?v=b7e6ac68c5f99', 'module');


  loadScript('https://www.google-analytics.com/analytics.js', null);

</script>

  </head>
  <body class="unresolved">
    
    <web-snackbar-container></web-snackbar-container>

    



<web-header class="header-default" role="navigation">
  <button data-open-drawer-button class="w-button--svg w-button--round" aria-label="Open menu">
    








  










  <svg class="icon " role="img" aria-label="menu" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>


    <span class="w-tooltip w-tooltip--left">Open menu</span>
  </button>

  <a
    href="/"
    class="header-default__logo-link gc-analytics-event"
    data-category="Site-Wide Custom Events"
    data-label="Site logo"
  >
    <img class="header-default__logo" width="125" height="23" src="/images/lockup.svg" alt="web.dev" />
  </a>

  <div class="header-default__middle">
    <div class="header-default__links">
      <a
        href="/learn/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Learn"
      >
        Learn
      </a>

      <a
        href="/measure/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Measure"
      >
        Measure
      </a>

      <a
        href="/blog/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Blog"
      >
        Blog
      </a>

      <a
        href="/about/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: About"
      >
        About
      </a>
    </div>
    <web-search results-id="search-main-results" i18n="{&quot;search&quot;:{&quot;en&quot;:&quot;Search&quot;},&quot;open_search&quot;:{&quot;en&quot;:&quot;Open search&quot;},&quot;all_articles&quot;:{&quot;en&quot;:&quot;All articles&quot;},&quot;close_search&quot;:{&quot;en&quot;:&quot;Close search&quot;}}"></web-search>
    <web-search-results id="search-main-results"></web-search-results>
  </div>

  <web-profile-switcher-container></web-profile-switcher-container>
</web-header>



<web-navigation-drawer class="drawer-default" type="modal">
  <nav data-drawer-container>
    <div class="drawer-default__contents">
      <div class="drawer-default__header">
        <button
          data-drawer-close-button
          class="drawer-default__hide w-button--svg w-button--round"
          aria-label="Close"
        >
          








  










  <svg class="icon " role="img" aria-label="close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>


          <span class="w-tooltip">Close</span>
        </button>
        <a
          href="/"
          class="gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Site logo"
        >
          <img
            width="125"
            height="30"
            class="drawer-default__logo"
            src="/images/lockup.svg"
            alt="web.dev"
          />
        </a>
      </div>
      <a
        href="/learn/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Learn"
      >
        Learn
      </a>
      <a
        href="/measure/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Measure"
      >
        Measure
      </a>
      <a
        href="/blog/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Blog"
      >
        Blog
      </a>
      <a
        href="/about/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: About"
      >
        About
      </a>
    </div>
  </nav>
</web-navigation-drawer>

<main>
  <div id="content">
    
      
    
    


<div class="guide-landing-page">
  
    
    
    
  
  

  
    <img     alt="Hero Image"     class="w-hero w-hero--cover"     decoding="auto"     height="480"               sizes="100vw"     src="https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format"     srcset="https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/UQbMiPKbXL1EDjtWsLju.jpg?auto=format&w=1600 1600w"          width="1600"   />
  

  <web-table-of-contents>
    <h2 class="w-toc__header">
      <a href="#publish-ship-and-install-modern-javascript-for-faster-applications" class="w-toc__header--link">
        Publish, ship, and install modern JavaScript for faster applications
      </a>
    </h2>
    <div class="w-toc__list">
        <ul><li><a href="#modern-javascript">Modern JavaScript</a></li><li><a href="#legacy-javascript">Legacy JavaScript</a></li><li><a href="#modern-javascript-on-npm">Modern JavaScript on npm</a><ol><li><a href="#modern-only">Modern-only</a></li><li><a href="#modern-with-legacy-fallback">Modern with legacy fallback</a></li><li><a href="#modern-with-legacy-fallback-and-esm-bundler-optimizations">Modern with legacy fallback and ESM bundler optimizations</a></li></ol></li><li><a href="#modern-javascript-in-applications">Modern JavaScript in applications</a></li><li><a href="#webpack">webpack</a><ol><li><a href="#optimize-plugin">Optimize Plugin</a></li><li><a href="#babelesmplugin">BabelEsmPlugin</a></li><li><a href="#configure-babel-loader-to-transpile-node_modules">Configure babel-loader to transpile node_modules</a></li></ol></li><li><a href="#rollup">Rollup</a><ol><li><a href="#@rollupplugin-babel">@rollup/plugin-babel</a></li></ol></li><li><a href="#additional-build-tools">Additional build tools</a></li><li><a href="#conclusion">Conclusion</a></li></ul></div>
  </web-table-of-contents>
  <web-table-of-contents-button></web-table-of-contents-button>

  
  <div class="w-actions">
    <share-action authors="@hdjirdeh | @_developit"
      class="gc-analytics-event w-actions__fab w-actions__fab--share"
      data-category="web.dev"
      data-label="share"
      data-action="click"
      data-icon="share"
      tabindex="0"
      role="button"
    >
      <span>Share</span>
    </share-action>
    
    
  </div>

  <div class="w-layout-container--narrow w-post-content">
    <header class="w-article-header">
      
        
        <div class="w-post-breadcrumbs">
          <ul class="w-breadcrumbs">
  <li class="w-breadcrumbs__crumb">
    <a
      class="w-breadcrumbs__link w-breadcrumbs__link--left-justify gc-analytics-event"
      data-category="web.dev"
      data-label="post, home breadcrumb"
      data-action="click"
      href="/"
    >
      Home
    </a>
  </li>

  <svg
    class="w-breadcrumbs__icon"
    xmlns="http://www.w3.org/2000/svg"
    height="24"
    viewBox="0 0 24 24"
    width="24"
    aria-hidden="true"
  >
    <path d="M0 0h24v24H0V0z" fill="none" />
    <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
  </svg>

  <li class="w-breadcrumbs__crumb">
    <a
      class="w-breadcrumbs__link gc-analytics-event"
      data-category="web.dev"
      data-label="post, path breadcrumb"
      data-action="click"
      href=/blog
    >
      All articles
    </a>
  </li>
</ul>
        </div>
      

      <h1 id="publish-ship-and-install-modern-javascript-for-faster-applications" class="w-article-header__headline">Publish, ship, and install modern JavaScript for faster applications</h1>
      
        <p class="w-article-header__subhead w-mb--non">
          Improve performance by turning on modern JavaScript dependencies and output.
        </p>
      

      
        <div class="w-author__published">
          <time>Dec 10, 2020</time>
           <span class="w-author__separator">•</span> Updated <time>Dec 16, 2020</time> 
        </div>
      

      
      

      <div class="w-layout-container--narrow w-post-signpost">
  <span class="w-post-signpost__title">
    Appears in:
  </span>
  <a
          class="w-post-signpost__link"
          href="/fast"
          >Fast load times</a
        >
</div>

      
        <div class="w-authors w-mt--xl w-pt--sm">
          
            <div class="w-author">
  <a href="/authors/houssein/"><img     alt="Houssein Djirdeh"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /></a>
  <div
    class="w-author__info"
    style="display: flex; flex-direction: column; justify-content: center;"
  >
    <cite class="w-author__name">
      <a class="w-author__name-link" href="/authors/houssein/">Houssein Djirdeh</a>
    </cite>
    <ul class="w-author__link-list">
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://twitter.com/hdjirdeh"
          >Twitter</a
        >
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://github.com/housseindjirdeh">GitHub</a>
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://glitch.com/@housseindjirdeh"
          >Glitch</a
        >
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://houssein.me/">Blog</a>
      </li>
    </ul>
  </div>
</div>
          
            <div class="w-author">
  <a href="/authors/developit/"><img     alt="Jason Miller"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/bPCYfhUgxdCpXhKAWc9X.jpg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/admin/bPCYfhUgxdCpXhKAWc9X.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/admin/bPCYfhUgxdCpXhKAWc9X.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/admin/bPCYfhUgxdCpXhKAWc9X.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/admin/bPCYfhUgxdCpXhKAWc9X.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/admin/bPCYfhUgxdCpXhKAWc9X.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /></a>
  <div
    class="w-author__info"
    style="display: flex; flex-direction: column; justify-content: center;"
  >
    <cite class="w-author__name">
      <a class="w-author__name-link" href="/authors/developit/">Jason Miller</a>
    </cite>
    <ul class="w-author__link-list">
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://twitter.com/_developit"
          >Twitter</a
        >
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://github.com/developit">GitHub</a>
      </li>
      
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://jasonformat.com">Blog</a>
      </li>
    </ul>
  </div>
</div>
          
        </div>
      
    </header>

    

    <p>Over 90% of browsers are capable of running modern JavaScript, but the
prevalence of legacy JavaScript remains one of the biggest contributors to
performance problems on the web today. <a href="http://estimator.dev/" rel="noopener">EStimator.dev</a> is
a simple web-based tool that calculates the size and performance improvement a
site could achieve by delivering modern JavaScript syntax.</p>
<figure class="w-figure w-figure--fullbleed">
  <img     alt="EStimator.dev analysis showing a website could be 9% faster with modern JavaScript."          decoding="async"     height="785"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/FHHnXqdjdsC6PNSSnnC4.png?auto=format&w=1600 1600w"          width="800"   />
  <figcaption class="w-figcaption w-figcaption--fullbleed">
    EStimator.dev
  </figcaption>
</figure>
<p>The web today is limited by legacy JavaScript, and no single optimization will
improve performance as much as writing, publishing, and shipping your web page
or package using <strong>ES2017</strong> syntax.</p>
<h2 id="modern-javascript">Modern JavaScript <a class="w-headline-link" href="#modern-javascript">#</a></h2>
<p>Modern JavaScript is not characterized as code written in a specific ECMAScript
specification version, but rather in syntax that is supported by all modern
browsers. Modern web browsers like Chrome, Edge, Firefox, and Safari make up
more than <a href="https://www.caniuse.com/usage-table" rel="noopener">90% of the browser market</a>, and
different browsers that rely on the same underlying rendering engines make up an
additional 5%. This means that 95% of global web traffic comes from browsers
that support the most widely used JavaScript language features from the past 10
years, including:</p>
<ul>
<li>Classes (ES2015)</li>
<li>Arrow functions (ES2015)</li>
<li>Generators (ES2015)</li>
<li>Block scoping (ES2015)</li>
<li>Destructuring (ES2015)</li>
<li>Rest and spread parameters (ES2015)</li>
<li>Object shorthand (ES2015)</li>
<li>Async/await (ES2017)</li>
</ul>
<p>Features in newer versions of the language specification generally have less
consistent support across modern browsers. For example, many ES2020 and ES2021
features are only supported in 70% of the browser market—still the majority of
browsers, but not enough that it's safe to rely on those features directly. This
means that although &quot;modern&quot; JavaScript is a moving target, ES2017 has the
widest range of browser compatibility
<a href="https://dev.to/garylchew/bringing-modern-javascript-to-libraries-432c" rel="noopener">while including most of the commonly used modern syntax features</a>.
In other words, <strong>ES2017 is the closest to modern syntax today</strong>.</p>
<h2 id="legacy-javascript">Legacy JavaScript <a class="w-headline-link" href="#legacy-javascript">#</a></h2>
<p>Legacy JavaScript is code that specifically avoids using all the above language
features. Most developers write their source code using modern syntax, but
compile everything to legacy syntax for increased browser support. Compiling
to legacy syntax does increase browser support, however the effect is often
smaller than we realize. In many cases the support increases from around 95%
to 98% while incurring a significant cost:</p>
<ul>
<li>
<p>Legacy JavaScript is typically around 20% larger and slower than
equivalent modern code. Tooling deficiencies and misconfiguration often
widen this gap even further.</p>
</li>
<li>
<p>Installed libraries account for as much as 90% of typical production
JavaScript code. Library code incurs an even higher legacy JavaScript
overhead due to polyfill and helper duplication that could be avoided
by publishing modern code.</p>
</li>
</ul>
<h2 id="modern-javascript-on-npm">Modern JavaScript on npm <a class="w-headline-link" href="#modern-javascript-on-npm">#</a></h2>
<p>Recently, Node.js has standardized an <code>&quot;exports&quot;</code> field to define
<a href="https://nodejs.org/api/packages.html#packages_package_entry_points" rel="noopener">entry points for a package</a>:</p>
<web-copy-code><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"exports"</span><span class="token operator">:</span> <span class="token string">"./index.js"</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><p>Modules referenced by the <code>&quot;exports&quot;</code> field imply a Node version of at least
12.8, which supports ES2019. This means that any module referenced using the
<code>&quot;exports&quot;</code> field can be <em>written in modern JavaScript</em>. Package consumers must
assume modules with an <code>&quot;exports&quot;</code> field contain modern code and transpile if
necessary.</p>
<h3 id="modern-only">Modern-only <a class="w-headline-link" href="#modern-only">#</a></h3>
<p>If you want to publish a package with modern code and leave it up to the
consumer to handle transpiling it when they use it as a dependency—use only the
<code>&quot;exports&quot;</code> field.</p>
<web-copy-code><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"foo"</span><span class="token punctuation">,</span><br>  <span class="token property">"exports"</span><span class="token operator">:</span> <span class="token string">"./modern.js"</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><div class="w-aside w-aside--caution">
<p><strong>Caution</strong>:
This approach is <em>not recommended</em>. In a perfect world, every developer
would have already configured their build system to transpile all dependencies
(<code>node_modules</code>) to their required syntax. However, this is not currently the
case, and publishing your package using only modern syntax would prevent its
usage in applications that would be accessed through legacy browsers.</p>
</div>
<h3 id="modern-with-legacy-fallback">Modern with legacy fallback <a class="w-headline-link" href="#modern-with-legacy-fallback">#</a></h3>
<p>Use the <code>&quot;exports&quot;</code> field along with <code>&quot;main&quot;</code> in order to publish your package
using modern code but also include an ES5 + CommonJS fallback for legacy
browsers.</p>
<web-copy-code><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"foo"</span><span class="token punctuation">,</span><br>  <span class="token property">"exports"</span><span class="token operator">:</span> <span class="token string">"./modern.js"</span><span class="token punctuation">,</span><br>  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"./legacy.cjs"</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><h3 id="modern-with-legacy-fallback-and-esm-bundler-optimizations">Modern with legacy fallback and ESM bundler optimizations <a class="w-headline-link" href="#modern-with-legacy-fallback-and-esm-bundler-optimizations">#</a></h3>
<p>In addition to defining a fallback CommonJS entrypoint, the <code>&quot;module&quot;</code> field can
be used to point to a similar legacy fallback bundle, but one that uses
JavaScript module syntax (<code>import</code> and <code>export</code>).</p>
<web-copy-code><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"foo"</span><span class="token punctuation">,</span><br>  <span class="token property">"exports"</span><span class="token operator">:</span> <span class="token string">"./modern.js"</span><span class="token punctuation">,</span><br>  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"./legacy.cjs"</span><span class="token punctuation">,</span><br>  <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"./module.js"</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><p>Many bundlers, such as webpack and Rollup, rely on this field to take advantage
of module features and enable
<a href="/commonjs-larger-bundles/#how-does-commonjs-affect-your-final-bundle-size">tree shaking</a>.
This is still a legacy bundle that does not contain any modern code aside from
<code>import</code>/<code>export</code> syntax, so use this approach to ship modern code with a
legacy fallback that is still optimized for bundling.</p>
<h2 id="modern-javascript-in-applications">Modern JavaScript in applications <a class="w-headline-link" href="#modern-javascript-in-applications">#</a></h2>
<p>Third-party dependencies make up the vast majority of typical production
JavaScript code in web applications. While npm dependencies have historically
been published as legacy ES5 syntax, this is no longer a safe assumption and
risks dependency updates breaking browser support in your application.</p>
<p>With an increasing number of npm packages moving to modern JavaScript, it's
important to ensure that the build tooling is set up to handle them. There's a
good chance some of the npm packages you depend on are already using modern
language features. There are a number of options available to use modern code
from npm without breaking your application in older browsers, but the general
idea is to have the build system transpile dependencies to the same syntax
target as your source code.</p>
<h2 id="webpack">webpack <a class="w-headline-link" href="#webpack">#</a></h2>
<p>As of webpack 5, it is now possible to configure what syntax webpack will use
when generating code for bundles and modules. This doesn't transpile your
code or dependencies, it only affects the &quot;glue&quot; code generated by webpack.
To specify the browser support target, add a
<a href="https://github.com/browserslist/browserslist#readme" rel="noopener">browserslist configuration</a>
to your project, or do it directly in your webpack configuration:</p>
<web-copy-code><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  target<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'web'</span><span class="token punctuation">,</span> <span class="token string">'es2017'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p>It is also possible to configure webpack to generate optimized bundles that
omit unnecessary wrapper functions when targeting a modern ES Modules
environment. This also configures webpack to load code-split bundles using
<code>&lt;script type=&quot;module&quot;&gt;</code>.</p>
<web-copy-code><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  target<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'web'</span><span class="token punctuation">,</span> <span class="token string">'es2017'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  output<span class="token operator">:</span> <span class="token punctuation">{</span><br>    module<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  experiments<span class="token operator">:</span> <span class="token punctuation">{</span><br>    outputModule<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p>There are a number of webpack plugins available that make it possible to
compile and ship modern JavaScript while still supporting legacy browsers,
such as Optimize Plugin and BabelEsmPlugin.</p>
<h3 id="optimize-plugin">Optimize Plugin <a class="w-headline-link" href="#optimize-plugin">#</a></h3>
<p><a href="https://github.com/developit/optimize-plugin" rel="noopener">Optimize Plugin</a> is a webpack
plugin that transforms final bundled code from modern to legacy JavaScript
instead of each individual source file. It's a self-contained setup that allows
your webpack configuration to assume everything is modern JavaScript with no
special branching for multiple outputs or syntaxes.</p>
<p>Since Optimize Plugin operates on bundles instead of individual modules, it
processes your application's code and your dependencies equally. This makes it
safe to use modern JavaScript dependencies from npm, because their code will be
bundled and transpiled to the correct syntax. It can also be faster than
traditional solutions involving two compilation steps, while still generating
separate bundles for modern and legacy browsers. The two sets of bundles are
designed to be loaded using the
<a href="/serve-modern-code-to-modern-browsers/">module/nomodule pattern</a>.</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token comment">// webpack.config.js</span><br><span class="token keyword">const</span> OptimizePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token comment">// ...</span><br>  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">OptimizePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p><code>Optimize Plugin</code> can be faster and more efficient than custom webpack
configurations, which typically bundle modern and legacy code separately. It
also handles running <a href="https://babeljs.io/" rel="noopener">Babel</a> for you, and minifies
bundles using <a href="https://terser.org/" rel="noopener">Terser</a> with separate optimal settings for
the modern and legacy outputs. Finally, polyfills needed by the generated
legacy bundles are extracted into a dedicated script so they are never
duplicated or unnecessarily loaded in newer browsers.</p>
<figure class="w-figure">
  <video controls autoplay loop muted class="w-screenshot">
    <source src="https://storage.googleapis.com/web-dev-assets/fast-publish-modern-javascript/transpile-before-after.webm" type="video/webm">
    <source src="https://storage.googleapis.com/web-dev-assets/fast-publish-modern-javascript/transpile-before-after.mp4" type="video/mp4">
  </video>
  <figcaption class="w-figcaption">
    Comparison: transpiling source modules twice versus transpiling generated bundles.
  </figcaption>
</figure>
<h3 id="babelesmplugin">BabelEsmPlugin <a class="w-headline-link" href="#babelesmplugin">#</a></h3>
<p><a href="https://github.com/prateekbh/babel-esm-plugin" rel="noopener">BabelEsmPlugin</a> is a webpack
plugin that works along with
<a href="https://babeljs.io/docs/en/babel-preset-env" rel="noopener">@babel/preset-env</a>
to generate modern versions of existing bundles to ship less transpiled code to
modern browsers. It is the most popular off-the-shelf solution for
module/nomodule, used by <a href="https://nextjs.org/" rel="noopener">Next.js</a> and
<a href="https://preactjs.com/cli/" rel="noopener">Preact CLI</a>.</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token comment">// webpack.config.js</span><br><span class="token keyword">const</span> BabelEsmPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-esm-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token comment">//...</span><br>  module<span class="token operator">:</span> <span class="token punctuation">{</span><br>    rules<span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token comment">// your existing babel-loader configuration:</span><br>      <span class="token punctuation">{</span><br>        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><br>        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><br>        use<span class="token operator">:</span> <span class="token punctuation">{</span><br>          loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span><br>          options<span class="token operator">:</span> <span class="token punctuation">{</span><br>            presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>          <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">BabelEsmPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p><code>BabelEsmPlugin</code> supports a wide array of webpack configurations, because it
runs two largely separate builds of your application. Compiling twice can take a
little bit of extra time for large applications, however this technique allows
<code>BabelEsmPlugin</code> to integrate seamlessly into existing webpack configurations
and makes it one of the most convenient options available.</p>
<h3 id="configure-babel-loader-to-transpile-node_modules">Configure babel-loader to transpile node_modules <a class="w-headline-link" href="#configure-babel-loader-to-transpile-node_modules">#</a></h3>
<p>If you are using <code>babel-loader</code> without one of the previous two plugins,
there's an important step required in order to consume modern JavaScript npm
modules. Defining two separate <code>babel-loader</code> configurations makes it possible
to automatically compile modern language features found in <code>node_modules</code> to
ES2017, while still transpiling your own first-party code with the Babel
plugins and presets defined in your project's configuration. This doesn't
generate modern and legacy bundles for a module/nomodule setup, but it does
make it possible to install and use npm packages that contain modern JavaScript
without breaking older browsers.</p>
<p><a href="https://www.npmjs.com/package/webpack-plugin-modern-npm" rel="noopener">webpack-plugin-modern-npm</a>
uses this technique to compile npm dependencies that have an <code>&quot;exports&quot;</code> field
in their <code>package.json</code>, since these may contain modern syntax:</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token comment">// webpack.config.js</span><br><span class="token keyword">const</span> ModernNpmPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-plugin-modern-npm'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token comment">// auto-transpile modern stuff found in node_modules</span><br>    <span class="token keyword">new</span> <span class="token class-name">ModernNpmPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p>Alternatively, you can implement the technique manually in your webpack
configuration by checking for an <code>&quot;exports&quot;</code> field in the <code>package.json</code> of
modules as they are resolved. Omitting caching for brevity, a custom
implementation might look like this:</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token comment">// webpack.config.js</span><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  module<span class="token operator">:</span> <span class="token punctuation">{</span><br>    rules<span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token comment">// Transpile for your own first-party code:</span><br>      <span class="token punctuation">{</span><br>        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span><br>        loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span><br>        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token comment">// Transpile modern dependencies:</span><br>      <span class="token punctuation">{</span><br>        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span><br>        <span class="token function">include</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">let</span> dir <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^.*[/\\]node_modules[/\\](@.*?[/\\])?.*?[/\\]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token keyword">try</span> <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> dir <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token function">require</span><span class="token punctuation">(</span>dir<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span><br>          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        use<span class="token operator">:</span> <span class="token punctuation">{</span><br>          loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span><br>          options<span class="token operator">:</span> <span class="token punctuation">{</span><br>            babelrc<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>            configFile<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>            presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>          <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p>When using this approach, you'll need to ensure modern syntax is supported by
your minifier. Both <a href="https://github.com/terser/terser#minify-options" rel="noopener">Terser</a>
and <a href="https://github.com/mishoo/UglifyJS/tree/harmony#minify-options" rel="noopener">uglify-es</a>
have an option to specify <code>{ecma: 2017}</code> in order to preserve and in some cases
generate ES2017 syntax during compression and formatting.</p>
<h2 id="rollup">Rollup <a class="w-headline-link" href="#rollup">#</a></h2>
<p>Rollup has built-in support for generating multiple sets of bundles as part of
a single build, and generates modern code by default. As a result, Rollup can
be configured to generate modern and legacy bundles with the official plugins
you're likely already using.</p>
<h3 id="@rollupplugin-babel">@rollup/plugin-babel <a class="w-headline-link" href="#@rollupplugin-babel">#</a></h3>
<p>If you use Rollup, the
<a href="https://github.com/rollup/plugins/tree/master/packages/babel#running-babel-on-the-generated-code" rel="noopener"><code>getBabelOutputPlugin()</code> method</a>
(provided by Rollup's
<a href="https://github.com/rollup/plugins/tree/master/packages/babel" rel="noopener">official Babel plugin</a>)
transforms the code in generated bundles rather than individual source modules.
Rollup has built-in support for generating multiple sets of bundles as part of
a single build, each with their own plugins. You can use this to produce
different bundles for modern and legacy by passing each through a different
Babel output plugin configuration:</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token comment">// rollup.config.js</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>getBabelOutputPlugin<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-babel'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><br>  input<span class="token operator">:</span> <span class="token string">'src/index.js'</span><span class="token punctuation">,</span><br>  output<span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token comment">// modern bundles:</span><br>    <span class="token punctuation">{</span><br>      format<span class="token operator">:</span> <span class="token string">'es'</span><span class="token punctuation">,</span><br>      plugins<span class="token operator">:</span> <span class="token punctuation">[</span><br>        <span class="token function">getBabelOutputPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>          presets<span class="token operator">:</span> <span class="token punctuation">[</span><br>            <span class="token punctuation">[</span><br>              <span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span><br>              <span class="token punctuation">{</span><br>                targets<span class="token operator">:</span> <span class="token punctuation">{</span>esmodules<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>                bugfixes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>                loose<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>            <span class="token punctuation">]</span><span class="token punctuation">,</span><br>          <span class="token punctuation">]</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token comment">// legacy (ES5) bundles:</span><br>    <span class="token punctuation">{</span><br>      format<span class="token operator">:</span> <span class="token string">'amd'</span><span class="token punctuation">,</span><br>      entryFileNames<span class="token operator">:</span> <span class="token string">'[name].legacy.js'</span><span class="token punctuation">,</span><br>      chunkFileNames<span class="token operator">:</span> <span class="token string">'[name]-[hash].legacy.js'</span><span class="token punctuation">,</span><br>      plugins<span class="token operator">:</span> <span class="token punctuation">[</span><br>        <span class="token function">getBabelOutputPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>          presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><h2 id="additional-build-tools">Additional build tools <a class="w-headline-link" href="#additional-build-tools">#</a></h2>
<p>Rollup and webpack are highly-configurable, which generally means each project
must update its configuration enable modern JavaScript syntax in dependencies.
There are also higher-level build tools that favor convention and defaults over
configuration, like <a href="https://parceljs.org/" rel="noopener">Parcel</a>, <a href="https://www.snowpack.dev/" rel="noopener">Snowpack</a>, <a href="https://github.com/vitejs/vite" rel="noopener">Vite</a> and <a href="https://github.com/preactjs/wmr" rel="noopener">WMR</a>. Most of these tools
assume npm dependencies may contain modern syntax, and will transpile them to
the appropriate syntax level(s) when building for production.</p>
<p>In addition to dedicated plugins for webpack and Rollup, modern JavaScript
bundles with legacy fallbacks can be added to any project using
<a href="https://github.com/theKashey/devolution" rel="noopener">devolution</a>. Devolution is a
standalone tool that transforms the output from a build system to produce legacy
JavaScript variants, allowing bundling and transformations to assume a modern
output target.</p>
<h2 id="conclusion">Conclusion <a class="w-headline-link" href="#conclusion">#</a></h2>
<p><a href="http://estimator.dev/" rel="noopener">EStimator.dev</a> was built to provide an easy way to
assess how much of an impact it can make to switch to modern-capable JavaScript
code for the majority of your users. Today, ES2017 is the closest to modern
syntax and tools such as npm, Babel, webpack, and Rollup have made it possible
to configure your build system and write your packages using this syntax. This
post covers several approaches, and you should use the easiest option that works
for your use case.</p>
<div class="youtube">  <lite-youtube    videoid="cLxNdLK--yI"      >  </lite-youtube></div>
<br>


    

    
  <div class="w-chips ">
    
      
    
      
        
        <a class="w-chip" href="/tags/performance/">Performance</a>
      
    
      
    
  </div>


    <div class="w-post-github-link w-mt--l w-mb--l">
      <span class="w-mr--sm">
        
        Last updated: <time>Dec 16, 2020</time>
        
      </span>
      <a
        href="https://github.com/GoogleChrome/web.dev/blob/main/src/site/content/en/fast/publish-modern-javascript/index.md"
      >
        Improve article
      </a>
       
    </div>

    
      <div class="w-callout w-callout--2col">
      <div class="w-callout__header">
        <h2 class="w-callout__lockup w-callout__lockup--codelab">Codelabs</h2>
        <div class="w-callout__headline">See it in action</div>
        <div class="w-callout__blurb">
          Learn more and put this guide into action.
        </div>
      </div>
      <ul class="w-unstyled-list w-callout__list">
        <li class="w-callout__listitem">
  <a
    class="w-callout__link w-callout__link--codelab"
    href="/codelab-serve-modern-code/"
  >
    Serve modern code to modern browsers for faster page loads
  </a>
</li>
      </ul>
    </div>
    
  </div>

  
    
    <nav class="w-article-navigation">
  <a
    class="w-article-navigation__link w-article-navigation__link--back
      w-article-navigation__link--single gc-analytics-event"
    data-category="web.dev"
    data-label="navigation, go back"
    data-action="click"
    href="/blog"
  >
    Return to all articles
  </a>
</nav>
  
</div>


  </div>
</main>
<footer class="w-footer">
  <nav class="w-footer__linkboxes">
    <ul class="w-footer__linkboxes-list">
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Contribute</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&labels=bug&template=bug_report.md&title="
              class="w-footer__linkbox-link" data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              File a bug
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/googlechrome/web.dev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              View source
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Related content</h3>
        <ul class="w-footer__linkbox-list">
         <li class="w-footer__linkbox-item">
            <a href="https://developer.chrome.com/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              developer.chrome.com
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://blog.chromium.org/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Chrome updates
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/fundamentals" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              Web Fundamentals
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/showcase/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">
              Case studies
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/podcasts/" class="w-footer__linkbox-link"
              data-category="Podcasts" data-label="Footer Link (index 5)">
              Podcasts
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/shows/" class="w-footer__linkbox-link"
              data-category="Shows" data-label="Footer Link (index 6)">
              Shows
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Connect</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://www.twitter.com/ChromiumDev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Twitter
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://www.youtube.com/user/ChromeDevelopers" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              YouTube
            </a>
          </li>
        </ul>
      </li>
    </ul>
  </nav>

  <div class="w-footer__utility">
    <nav class="w-footer__utility-nav">
      <a href="https://developers.google.com/" class="w-footer__utility-logo-link"
        data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link">
        <img loading="lazy" width="185" height="33" class="w-footer__utility-logo" src="/images/lockup-color.png"
          alt="Google Developers" />
      </a>
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developer.chrome.com/"
            data-category="Site-Wide Custom Events" data-label="Footer Chrome Link">
            Chrome
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://firebase.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Firebase Link">
            Firebase
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://cloud.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Google Cloud Platform Link">
            Google Cloud Platform
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developers.google.com/products"
            data-category="Site-Wide Custom Events" data-label="Footer All products Link">
            All products
          </a>
        </li>
      </ul>
      <web-language-select current="en"></web-language-select>
    </nav>
    <nav class="w-footer__utility-nav">
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://policies.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Terms and Privacy link">
            Terms &amp; Privacy
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="/community-guidelines/" data-category="Site-Wide Custom Events"
            data-label="Footer Community Guidelines link">
            Community Guidelines
          </a>
        </li>
      </ul>
      <div class="w-footer__license">
        <p>
          Except as otherwise noted, the content of this page is licensed
          under the
          <a href="https://creativecommons.org/licenses/by/4.0/">
          Creative Commons Attribution 4.0 License</a>,
          and code samples are licensed under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">
          Apache 2.0 License</a>. For details, see the
          <a href="https://developers.google.com/terms/site-policies">
          Google Developers Site Policies</a>.
        </p>
      </div>
    </nav>
  </div>
</footer>

  </body>
</html>
