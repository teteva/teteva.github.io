
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">


  
<script>
  // A global function that the theme toggle can use to apply the current theme.
  window.applyThemeSetting = function(override) {
    const currentSetting = override || localStorage.getItem('user-color-scheme');
    const currentAttribute = document.documentElement.getAttribute('data-user-theme');

    if (currentSetting && currentSetting !== currentAttribute) {
      document.documentElement.setAttribute('data-user-theme', currentSetting);
    }
  };
window.applyThemeSetting();
</script>

  
  <link rel="stylesheet" href="/css/next.css?v=6b180ed55e1fe">
  <link rel="stylesheet" href="/css/legacy-rollout.css?v=d09d494cefc17">
  <link rel="preload" as="font" crossorigin href="/fonts/material-icons/regular.woff2">


<link rel="preload" as="font" crossorigin href="/fonts/google-sans/regular/latin.woff2">
<link rel="preload" as="font" crossorigin href="/fonts/google-sans/bold/latin.woff2">

<meta name="theme-color" content="#fff"/>




<title>Fast playback with audio and video preload</title>
<meta name="description" content="Faster playback start means more people watching your video or listening to your audio. That's a known fact. In this article I'll explore techniques you can use to accelerate your media playback by actively preloading resources depending on your use case. " />

<link rel="canonical" href="https://web.dev/fast-playback-with-preload/" />

<meta itemprop="name" content="Fast playback with audio and video preload" />
<meta itemprop="description" content="Faster playback start means more people watching your video or listening to your audio. That's a known fact. In this article I'll explore techniques you can use to accelerate your media playback by actively preloading resources depending on your use case. " />
<meta itemprop="image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://web.dev/fast-playback-with-preload/" />
<meta property="og:site_name" content="web.dev" />
<meta property="og:title" content="Fast playback with audio and video preload" />
<meta property="og:description" content="Faster playback start means more people watching your video or listening to your audio. That's a known fact. In this article I'll explore techniques you can use to accelerate your media playback by actively preloading resources depending on your use case. " />
<meta property="og:image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:image:alt" content="" />
<meta property="tag" content="media" />
<meta property="tag" content="performance" />
<meta property="tag" content="network" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Fast playback with audio and video preload" />
<meta name="twitter:description" content="Faster playback start means more people watching your video or listening to your audio. That's a known fact. In this article I'll explore techniques you can use to accelerate your media playback by actively preloading resources depending on your use case. " />
<meta name="twitter:image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<link
  rel="alternate"
  href="/feed.xml"
  type="application/atom+xml"
  data-title="web.dev feed"
/>

<link rel="manifest" href="/manifest.webmanifest" />

<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="mask-icon" color="#0054ff" href="/images/safari-pinned-tab.svg">



<script>
window.ga =
  window.ga ||
  function () {
    (ga.q = ga.q || []).push(arguments);
  };
ga.l = +new Date();
ga('create', 'UA-126406676-2');
ga('set', 'transport', 'beacon');
ga('set', 'anonymizeIp', true);
ga('set', 'page', window.location.pathname);
ga('set', 'dimension5', '4');
ga('send', 'pageview');
</script>







<script>
function loadScript(url, type) {
  const s = document.createElement('script');
  s.src = url;
  if (type) {
    s.type = type;
  }
  if (type === 'module') {
    s.async = false; // Preserve load order.
    const pre = document.createElement('link');
    pre.rel = 'modulepreload';
    pre.href = url;
    document.head.append(pre);
    // We use DOMContentLoaded as the loader script is running sync, and inserting a module script here doesn't defer. This brings back normal type="module" behavior.
    window.addEventListener('DOMContentLoaded', () => {
      document.head.append(s);
    });
  } else {
    document.head.append(s);
  }
}
loadScript('/js/app.js?v=5d4807cd9a3b4', 'module');




  loadScript('/js/content.js?v=43ca8505ae8f3', 'module');


  loadScript('https://www.google-analytics.com/analytics.js', null);

</script>

  </head>
  <body class="unresolved">
    
    <web-snackbar-container></web-snackbar-container>

    
<a href="#main" class="skip-link button" data-type="primary">Skip to content</a>


<web-header role="banner" class="site-header">
  <div class="cluster gutter-base">
    <button class="icon-button tooltip color-core-text md:hidden-yes" data-open-drawer-button data-alignment="right">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
      <span class="tooltip__content">Open menu</span>
    </button>
    <a href="/" class="site-header__brand brand">
      


  <svg role="img" aria-label="web.dev" xmlns="http://www.w3.org/2000/svg" width="119.79" height="22.32" viewBox="0 0 119.79 22.32"><path class="brand__text" d="M114.99 19.32h-2.2l-4.8-11.9h2.4l3.5 9.2 3.5-9.2h2.4Zm-16.8-7.3h6.8a3.17 3.17 0 0 0-3.4-2.9 3.42 3.42 0 0 0-3.4 2.9Zm3.6 7.7a6 6 0 0 1-6-6.3c0-3.6 2.5-6.3 5.9-6.3s5.8 2.4 5.8 6.5v.2h-9.3a3.88 3.88 0 0 0 3.8 3.9 3.56 3.56 0 0 0 3.3-2.1l2 1a6.22 6.22 0 0 1-5.5 3.1Zm-14 0c-3.1 0-5.7-2.8-5.7-6.3s2.6-6.3 5.7-6.3a5 5 0 0 1 4.1 2h.1l-.1-1.6v-5.5h2.2v17.3h-2.1v-1.6h-.1a5.12 5.12 0 0 1-4.1 2Zm.3-2c2.2 0 3.8-1.7 3.8-4.3s-1.6-4.3-3.8-4.3a4 4 0 0 0-3.8 4.3 4 4 0 0 0 3.8 4.3Zm-6.8.1a1.61 1.61 0 0 1-1.7 1.6 1.74 1.74 0 0 1-1.7-1.6 1.67 1.67 0 0 1 1.7-1.6 1.61 1.61 0 0 1 1.7 1.6Zm-10.5-.1a4 4 0 0 0 3.8-4.3 4 4 0 0 0-3.8-4.3c-2.2 0-3.8 1.8-3.8 4.3s1.6 4.3 3.8 4.3Zm.4 2a5 5 0 0 1-4.1-2h-.1v1.6h-2.1V2.02h2.2v5.5l-.1 1.6h.1a4.84 4.84 0 0 1 4.1-2c3.1 0 5.7 2.8 5.7 6.3s-2.6 6.3-5.7 6.3Zm-17.4-7.7h6.8a3.17 3.17 0 0 0-3.4-2.9 3.42 3.42 0 0 0-3.4 2.9Zm3.6 7.7a6 6 0 0 1-6-6.3c0-3.6 2.5-6.3 5.9-6.3s5.8 2.4 5.8 6.5v.2h-9.3a3.88 3.88 0 0 0 3.8 3.9 3.67 3.67 0 0 0 3.3-2.1l2 1a6.22 6.22 0 0 1-5.5 3.1Zm-6.3-12.2-3.8 11.9h-2.3l-3-9.1-2.9 9.1h-2.3l-3.9-11.9h2.3l2.6 9 2.9-9h2.3l2.9 9 2.6-9Z" fill="#5f6368" fill-rule="evenodd"/><path d="M0 19.28a3 3 0 0 1 3-3h16.27a3.045 3.045 0 0 1 0 6.09H3.04A3 3 0 0 1 0 19.28Z" fill="#6cf"/><path d="M.89.9a3 3 0 0 1 4.3 0l8.12 8.11a3.05 3.05 0 0 1 0 4.3l-8.12 8.12a3.04 3.04 0 1 1-4.3-4.3l5.6-5.61a.51.51 0 0 0 0-.72L.89 5.22A3 3 0 0 1 .89.9Z" fill="#06f" fill-rule="evenodd"/><path d="m10.39 16.22-5.2 5.2a3.04 3.04 0 1 1-4.3-4.3l.89-.9Z" fill="#c6f"/><circle cx="19.27" cy="19.27" r="3.04" fill="#06f"/></svg>


    </a>
  </div>
  <web-navigation-drawer type="standard">
    <nav class="site-header__nav" aria-label="main navigation" data-drawer-container>
      <a
        class="site-header__link"
        href="/learn/" data-category="Site-Wide Custom Events"
        data-label="Tab: Learn"
        >
          Learn
      </a>
      <a
        class="site-header__link"
        href="/measure/"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Measure"
        >
        Measure
      </a>
      <a
        class="site-header__link"
        href="/blog/"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Blog"
        >
        Blog
      </a>
      <a
        class="site-header__link"
        href="/tags/case-study/"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Case Studies"
        >
        Case studies
      </a>
      <a
        class="site-header__link"
        href="/about/"
        data-category="Site-Wide Custom Events"
        data-label="Tab: About" >
        About
      </a>
      <button class="icon-button tooltip color-core-text md:hidden-yes" data-drawer-close-button>
        








  










  <svg class="icon " role="img" aria-label="close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>


        <span class="tooltip__content">Close</span>
      </button>
    </nav>
  </web-navigation-drawer>
  <div class="site-header__actions cluster">
    <div class="site-header__search">
      <web-search results-id="search-main-results" i18n="{&quot;search&quot;:{&quot;en&quot;:&quot;Search&quot;},&quot;open_search&quot;:{&quot;en&quot;:&quot;Open search&quot;},&quot;all_articles&quot;:{&quot;en&quot;:&quot;All articles&quot;},&quot;close_search&quot;:{&quot;en&quot;:&quot;Close search&quot;}}"></web-search>
      <web-search-results id="search-main-results"></web-search-results>
    </div>
  </div>
</web-header>

<main id="main">
  
    
  
  






<div class="post wrapper" data-flush>
  
    
    
    
  
  

  <div class="sidebar region flex-align-start flex-dir-rev flex-wrap-no">
    

  <nav class="course__toc toc over-scroll hidden-yes xl:hidden-no" data-type="side" aria-label="On this page">
    <div class="course-toc__heading font-google-sans weight-medium">On this page</div>
    <web-scroll-spy>
      <div class="toc__wrapper flow-recursive">
        <ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#video-preload-attribute">Video preload attribute</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#tips">Tips</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="#link-preload">Link preload</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#preload-full-video">Preload full video</a></li><li class="toc__listitem"><a class="toc__anchor" href="#preload-the-first-segment">Preload the first segment</a></li><li class="toc__listitem"><a class="toc__anchor" href="#support">Support</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="#manual-buffering">Manual buffering</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#considerations">Considerations</a></li><li class="toc__listitem"><a class="toc__anchor" href="#pre-cache-multiple-first-segments">Pre-cache multiple first segments</a></li><li class="toc__listitem"><a class="toc__anchor" href="#create-range-responses-with-a-service-worker">Create Range responses with a service worker</a></li></ul></li></ul>
      </div>
    </web-scroll-spy>
  </nav>


    
    <article class="prose legacy-rollout">
      <header class="flow gap-bottom-size-3">
        

        <h1 id="fast-playback-with-audio-and-video-preload">Fast playback with audio and video preload</h1>
        
          <p class="color-mid-text flow-space-base">
            How to accelerate your media playback by actively preloading resources.
          </p>
        

        
          <div class="flow-space-size-1 color-mid-text text-size-0">
            <time>Aug 17, 2017</time>
             — Updated <time>Nov 16, 2020</time> 
          </div>
        

        
        

        <div class="w-layout-container--narrow w-post-signpost">
  <span class="w-post-signpost__title">
    Appears in:
  </span>
  <a
          class="w-post-signpost__link"
          href="/fast"
          >Fast load times</a
        ><span class="w-post-signpost__divider">|</span><a
          class="w-post-signpost__link"
          href="/media"
          >Media</a
        >
</div>

        
          <div class="cluster flow-space-size-2">
            
              <div class="author">
  <a class="avatar" href="/authors/beaufortfrancois/"> <img     alt="François Beaufort"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/mXjY3z3JmrispGtu9yn6.jpg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/admin/mXjY3z3JmrispGtu9yn6.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/admin/mXjY3z3JmrispGtu9yn6.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/admin/mXjY3z3JmrispGtu9yn6.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/admin/mXjY3z3JmrispGtu9yn6.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/admin/mXjY3z3JmrispGtu9yn6.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /> </a>
  <div class="flow">
    <cite class="author__name">
      <a href="/authors/beaufortfrancois/">François Beaufort</a>
    </cite>
    <div class="author__links cluster">
               
               <a href="https://github.com/beaufortfrancois">GitHub</a>
               
               
             </div>
  </div>
</div>
            
          </div>
        
      </header>

      

      

  

  <div class="xl:hidden-yes flow-space-size-1">
    <details data-type="inner" role="navigation" aria-label="On this page">
      <summary>
        On this page
      </summary>
      <div class="toc"><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#video-preload-attribute">Video preload attribute</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#tips">Tips</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="#link-preload">Link preload</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#preload-full-video">Preload full video</a></li><li class="toc__listitem"><a class="toc__anchor" href="#preload-the-first-segment">Preload the first segment</a></li><li class="toc__listitem"><a class="toc__anchor" href="#support">Support</a></li></ul></li><li class="toc__listitem"><a class="toc__anchor" href="#manual-buffering">Manual buffering</a><ul class="toc__list"><li class="toc__listitem"><a class="toc__anchor" href="#considerations">Considerations</a></li><li class="toc__listitem"><a class="toc__anchor" href="#pre-cache-multiple-first-segments">Pre-cache multiple first segments</a></li><li class="toc__listitem"><a class="toc__anchor" href="#create-range-responses-with-a-service-worker">Create Range responses with a service worker</a></li></ul></li></ul></div>
    </details>
  </div>



      <p>Faster playback start means more people watching your video or listening to your
audio. <a href="https://www.digitaltrends.com/web/buffer-rage/" rel="noopener">That's a known fact</a>. In this article I'll explore
techniques you can use to accelerate your audio and video playback by actively
preloading resources depending on your use case.</p>
<figure>
  <video controls muted playsinline class="w-screenshot">
    <source src="https://storage.googleapis.com/web-dev-assets/fast-playback-with-preload/video-preload-hero.webm#t=1.1"
            type="video/webm">
    <source src="https://storage.googleapis.com/web-dev-assets/fast-playback-with-preload/video-preload-hero.mp4#t=1.1"
            type="video/mp4">
  </video>
  <figcaption>
    <p>Credits: copyright Blender Foundation | <a href="http://www.blender.org">www.blender.org </a>.</p>
  </figcaption>
</figure>
<p>I'll describe three methods of preloading media files, starting with their pros
and cons.</p>
<table>
  <tbody>
    <tr>
      <th></th>
      <th>
It's great...
      </th>
      <th>
But...
      </th>
    </tr>
    <tr>
      <td rowspan=3 style="white-space: nowrap">
<a href="#video_preload_attribute">Video preload attribute</a>
      </td>
      <td rowspan=3>
Simple to use for a unique file hosted on a web server.
      </td>
      <td>
Browsers may completely ignore the attribute.
      </td>
    <tr>
      <td>
Resource fetching starts when the HTML document has been completely loaded and
parsed.
      </td>
    </tr>
    <tr>
      <td>
Media Source Extensions (MSE) ignore the <code>preload</code> attribute on media elements because the app is responsible for
providing media to MSE.
      </td>
    </tr>
    <tr>
      <td rowspan=2 style="white-space: nowrap">
<a href="#link_preload">Link preload</a>
      </td>
      <td>
Forces the browser to make a request for a video resource without blocking
the document's <code>onload</code> event.
      </td>
      <td>
HTTP Range requests are not compatible.
      </td>
    <tr>
      <td>
Compatible with MSE and file segments.
      </td>
      <td>
Should be used only for small media files (&lt;5 MB) when fetching full resources.
      </td>
    </tr>
    <tr>
      <td>
<a href="#manual_buffering">Manual buffering</a>
      </td>
      <td>
Full control
      </td>
      <td>
Complex error handling is the website's responsibility.
      </td>
    </tr>
  </tbody>
</table>
<h2 id="video-preload-attribute">Video preload attribute <a class="w-headline-link" href="#video-preload-attribute">#</a></h2>
<p>If the video source is a unique file hosted on a web server, you may want to
use the video <code>preload</code> attribute to provide a hint to the browser as to <a href="/video-and-source-tags/#preload">how
much information or content to preload</a>. This means <a href="https://developer.mozilla.org/docs/Web/API/Media_Source_Extensions_API" rel="noopener">Media Source Extensions
(MSE)</a> is not compatible with <code>preload</code>.</p>
<p>Resource fetching will start only when the initial HTML document has been
completely loaded and parsed (e.g. the <code>DOMContentLoaded</code> event has fired)
while the very different <code>load</code> event will be fired when resource
has actually been fetched.</p>
<figure>
  <img     alt=""          decoding="async"     height="234"          loading="lazy"          src="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/De8tMHJUn3XyzFfosVLb.svg"               width="800"   />
</figure>
<p>Setting the <code>preload</code> attribute to <code>metadata</code> indicates that the user is not
expected to need the video, but that fetching its metadata (dimensions, track
list, duration, and so on) is desirable. Note that starting in <a href="https://developers.google.com/web/updates/2017/12/chrome-63-64-media-updates#media-preload-defaults-metadata" rel="noopener">Chrome
64</a>, the default value for <code>preload</code> is <code>metadata</code>. (It was <code>auto</code>
previously).</p>
<web-copy-code><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>video<span class="token punctuation">"</span></span> <span class="token attr-name">preload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>metadata<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file.mp4<span class="token punctuation">"</span></span> <span class="token attr-name">controls</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'loadedmetadata'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>video<span class="token punctuation">.</span>buffered<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">const</span> bufferedSeconds <span class="token operator">=</span> video<span class="token punctuation">.</span>buffered<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span> video<span class="token punctuation">.</span>buffered<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>bufferedSeconds<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> seconds of video are ready to play.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
</web-copy-code><p>Setting the <code>preload</code> attribute to <code>auto</code> indicates that the browser may cache
enough data that complete playback is possible without requiring a stop for
further buffering.</p>
<web-copy-code><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>video<span class="token punctuation">"</span></span> <span class="token attr-name">preload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>auto<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file.mp4<span class="token punctuation">"</span></span> <span class="token attr-name">controls</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'loadedmetadata'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>video<span class="token punctuation">.</span>buffered<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">const</span> bufferedSeconds <span class="token operator">=</span> video<span class="token punctuation">.</span>buffered<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span> video<span class="token punctuation">.</span>buffered<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>bufferedSeconds<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> seconds of video are ready to play.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
</web-copy-code><p>There are some caveats though. As this is just a hint, the browser may completely
ignore the <code>preload</code> attribute. At the time of writing, here are some rules
applied in Chrome:</p>
<ul>
<li>When <a href="https://support.google.com/chrome/answer/2392284" rel="noopener">Data Saver</a> is enabled, Chrome forces the <code>preload</code> value to
<code>none</code>.</li>
<li>In Android 4.3, Chrome forces the <code>preload</code> value to <code>none</code> due to an <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=612909" rel="noopener">Android
Bug</a>.</li>
<li>On a cellular connection (2G, 3G, and 4G), Chrome forces the <code>preload</code> value to
<code>metadata</code>.</li>
</ul>
<h3 id="tips">Tips <a class="w-headline-link" href="#tips">#</a></h3>
<p>If your website contains many video resources on the same domain, I would
recommend you set the <code>preload</code> value to <code>metadata</code> or define the <code>poster</code>
attribute and set <code>preload</code> to <code>none</code>. That way, you would avoid hitting
the maximum number of HTTP connections to the same domain (6 according to the
HTTP 1.1 spec) which can hang loading of resources. Note that this may also
improve page speed if videos aren't part of your core user experience.</p>
<h2 id="link-preload">Link preload <a class="w-headline-link" href="#link-preload">#</a></h2>
<p>As <a href="https://developers.google.com/web/updates/2016/03/link-rel-preload" rel="noopener">covered</a> in other <a href="https://www.smashingmagazine.com/2016/02/preload-what-is-it-good-for/" rel="noopener">articles</a>, <a href="https://w3c.github.io/preload/" rel="noopener">link preload</a> is a declarative fetch that
allows you to force the browser to make a request for a resource without
blocking the <code>load</code> event and while the page is downloading. Resources
loaded via <code>&lt;link rel=&quot;preload&quot;&gt;</code> are stored locally in the browser, and are
effectively inert until they're explicitly referenced in the DOM, JavaScript,
or CSS.</p>
<p>Preload is different from prefetch in that it focuses on current navigation and
fetches resources with priority based on their type (script, style, font,
video, audio, etc.). It should be used to warm up the browser cache for current
sessions.</p>
<figure>
  <img     alt=""          decoding="async"     height="234"          loading="lazy"          src="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/g5fQKJMivvcsHajmMmi2.svg"               width="800"   />
</figure>
<h3 id="preload-full-video">Preload full video <a class="w-headline-link" href="#preload-full-video">#</a></h3>
<p>Here's how to preload a full video on your website so that when your
JavaScript asks to fetch video content, it is read from cache as the resource
may have already been cached by the browser. If the preload request hasn't
finished yet, a regular network fetch will happen.</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"preload"</span> <span class="token keyword">as</span><span class="token operator">=</span><span class="token string">"video"</span> href<span class="token operator">=</span><span class="token string">"https://cdn.com/small-file.mp4"</span><span class="token operator">></span><br><br><span class="token operator">&lt;</span>video id<span class="token operator">=</span><span class="token string">"video"</span> controls<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>video<span class="token operator">></span><br><br><span class="token operator">&lt;</span>script<span class="token operator">></span><br>  <span class="token comment">// Later on, after some condition has been met, set video source to the</span><br>  <span class="token comment">// preloaded video URL.</span><br>  video<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'https://cdn.com/small-file.mp4'</span><span class="token punctuation">;</span><br>  video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token comment">// If preloaded video URL was already cached, playback started immediately.</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>
</web-copy-code><aside class="aside flow bg-state-info-bg color-state-info-text">
<div class=" flow">
<p>I would recommend using this only for small media files (less than 5MB).</p>
</div></aside>
<p>Because the preloaded resource is going to be consumed by a video element in
the example, the <code>as</code> preload link value is <code>video</code>. If it were an audio
element, it would be <code>as=&quot;audio&quot;</code>.</p>
<h3 id="preload-the-first-segment">Preload the first segment <a class="w-headline-link" href="#preload-the-first-segment">#</a></h3>
<p>The example below shows how to preload the first segment of a video with <code>&lt;link rel=&quot;preload&quot;&gt;</code> and use it with Media Source Extensions. If you're not familiar
with the MSE JavaScript API, see <a href="https://developer.mozilla.org/docs/Web/API/Media_Source_Extensions_API" rel="noopener">MSE basics</a>.</p>
<p>For the sake of simplicity, let's assume the entire video has been split into
smaller files like <code>file_1.webm</code>, <code>file_2.webm</code>, <code>file_3.webm</code>, etc.</p>
<web-copy-code><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.com/file_1.webm<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>video<span class="token punctuation">"</span></span> <span class="token attr-name">controls</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">const</span> mediaSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  video<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>mediaSource<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  mediaSource<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'sourceopen'</span><span class="token punctuation">,</span> sourceOpen<span class="token punctuation">,</span> <span class="token punctuation">{</span> once<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">sourceOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>video<span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> sourceBuffer <span class="token operator">=</span> mediaSource<span class="token punctuation">.</span><span class="token function">addSourceBuffer</span><span class="token punctuation">(</span><span class="token string">'video/webm; codecs="vp09.00.10.08"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// If video is preloaded already, fetch will return immediately a response</span><br>    <span class="token comment">// from the browser cache (memory cache). Otherwise, it will perform a</span><br>    <span class="token comment">// regular network fetch.</span><br>    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://cdn.com/file_1.webm'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token comment">// Append the data into the new sourceBuffer.</span><br>      sourceBuffer<span class="token punctuation">.</span><span class="token function">appendBuffer</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// TODO: Fetch file_2.webm when user starts playing video.</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token comment">// TODO: Show "Video is not available" message to user.</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
</web-copy-code><aside class="aside flow bg-state-warn-bg color-core-text">
<p class="cluster ">
<span class="aside__icon box-block color-state-warn-text"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" role="img" aria-label="Warning sign" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M23 21L12 2 1 21h22zm-12-3v-2h2v2h-2zm0-4h2v-4h-2v4z" />
</svg></span>
<strong>Warning</strong></p>
<div class=" flow">
<p>For cross-origin resources, make sure your CORS headers are set properly. As
we can't create an array buffer from an opaque response retrieved with
<code>fetch(videoFileUrl, { mode: 'no-cors' })</code>, we won't be able to feed any video
or audio element.</p>
</div></aside>
<h3 id="support">Support <a class="w-headline-link" href="#support">#</a></h3>
<p>See MDN's <a href="https://developer.mozilla.org/docs/Web/HTML/Preloading_content#Browser_compatibility" rel="noopener">Browser compatibility</a> table to see which
browsers support preload. You may want to detect its availability with the
snippets below to adjust your performance metrics.</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">preloadFullVideoSupported</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'link'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  link<span class="token punctuation">.</span>as <span class="token operator">=</span> <span class="token string">'video'</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span>link<span class="token punctuation">.</span>as <span class="token operator">===</span> <span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">preloadFirstSegmentSupported</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'link'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  link<span class="token punctuation">.</span>as <span class="token operator">=</span> <span class="token string">'fetch'</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span>link<span class="token punctuation">.</span>as <span class="token operator">===</span> <span class="token string">'fetch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><h2 id="manual-buffering">Manual buffering <a class="w-headline-link" href="#manual-buffering">#</a></h2>
<p>Before we dive into the <a href="https://developer.mozilla.org/docs/Web/API/Cache" rel="noopener">Cache API</a> and service workers, let's see
how to manually buffer a video with MSE. The example below assumes that your web
server supports HTTP <a href="https://developer.mozilla.org/docs/Web/HTTP/Headers/Range" rel="noopener"><code>Range</code></a>
requests but this would be pretty similar with file
segments. Note that some middleware libraries such as <a href="https://github.com/google/shaka-player" rel="noopener">Google's Shaka
Player</a>, <a href="https://developer.jwplayer.com/" rel="noopener">JW Player</a>, and <a href="http://videojs.com/" rel="noopener">Video.js</a> are
built to handle this for you.</p>
<web-copy-code><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>video<span class="token punctuation">"</span></span> <span class="token attr-name">controls</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">const</span> mediaSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  video<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>mediaSource<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  mediaSource<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'sourceopen'</span><span class="token punctuation">,</span> sourceOpen<span class="token punctuation">,</span> <span class="token punctuation">{</span> once<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">sourceOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>video<span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> sourceBuffer <span class="token operator">=</span> mediaSource<span class="token punctuation">.</span><span class="token function">addSourceBuffer</span><span class="token punctuation">(</span><span class="token string">'video/webm; codecs="vp09.00.10.08"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Fetch beginning of the video by setting the Range HTTP request header.</span><br>    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'file.webm'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> headers<span class="token operator">:</span> <span class="token punctuation">{</span> range<span class="token operator">:</span> <span class="token string">'bytes=0-567139'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      sourceBuffer<span class="token punctuation">.</span><span class="token function">appendBuffer</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      sourceBuffer<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'updateend'</span><span class="token punctuation">,</span> updateEnd<span class="token punctuation">,</span> <span class="token punctuation">{</span> once<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">function</span> <span class="token function">updateEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Video is now ready to play!</span><br>    <span class="token keyword">const</span> bufferedSeconds <span class="token operator">=</span> video<span class="token punctuation">.</span>buffered<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span> video<span class="token punctuation">.</span>buffered<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>bufferedSeconds<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> seconds of video are ready to play.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Fetch the next segment of video when user starts playing the video.</span><br>    video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'playing'</span><span class="token punctuation">,</span> fetchNextSegment<span class="token punctuation">,</span> <span class="token punctuation">{</span> once<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">function</span> <span class="token function">fetchNextSegment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'file.webm'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> headers<span class="token operator">:</span> <span class="token punctuation">{</span> range<span class="token operator">:</span> <span class="token string">'bytes=567140-1196488'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> sourceBuffer <span class="token operator">=</span> mediaSource<span class="token punctuation">.</span>sourceBuffers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>      sourceBuffer<span class="token punctuation">.</span><span class="token function">appendBuffer</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// TODO: Fetch further segment and append it.</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
</web-copy-code><h3 id="considerations">Considerations <a class="w-headline-link" href="#considerations">#</a></h3>
<p>As you're now in control of the entire media buffering experience, I suggest you
consider the device's battery level, the &quot;Data-Saver Mode&quot; user preference and
network information when thinking about preloading.</p>
<h4 id="battery-awareness">Battery awareness <a class="w-headline-link" href="#battery-awareness">#</a></h4>
<p>Take into account the battery level of users' devices before thinking
about preloading a video. This will preserve battery life when the power level
is low.</p>
<p>Disable preload or at least preload a lower resolution video when the
device is running out of battery.</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'getBattery'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  navigator<span class="token punctuation">.</span><span class="token function">getBattery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">battery</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token comment">// If battery is charging or battery level is high enough</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>battery<span class="token punctuation">.</span>charging <span class="token operator">||</span> battery<span class="token punctuation">.</span>level <span class="token operator">></span> <span class="token number">0.15</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// TODO: Preload the first segment of a video.</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><h4 id="detect-&quot;data-saver&quot;">Detect &quot;Data-Saver&quot; <a class="w-headline-link" href="#detect-&quot;data-saver&quot;">#</a></h4>
<p>Use the <code>Save-Data</code> client hint request header to deliver fast and light
applications to users who have opted-in to &quot;data savings&quot; mode in their
browser. By identifying this request header, your application can customize and
deliver an optimized user experience to cost- and performance-constrained
users.</p>
<p>See <a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/save-data" rel="noopener">Delivering Fast and Light Applications with Save-Data</a> to learn more.</p>
<h4 id="smart-loading-based-on-network-information">Smart loading based on network information <a class="w-headline-link" href="#smart-loading-based-on-network-information">#</a></h4>
<p>You may want to check <code>navigator.connection.type</code> prior to preloading. When
it's set to <code>cellular</code>, you could prevent preloading and advise users that
their mobile network operator might be charging for the bandwidth, and only start
automatic playback of previously cached content.</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'connection'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'cellular'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// TODO: Prompt user before preloading video</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    <span class="token comment">// TODO: Preload the first segment of a video.</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><p>Check out the <a href="https://googlechrome.github.io/samples/network-information/" rel="noopener">Network Information sample</a> to learn how to react to network
changes as well.</p>
<h3 id="pre-cache-multiple-first-segments">Pre-cache multiple first segments <a class="w-headline-link" href="#pre-cache-multiple-first-segments">#</a></h3>
<p>Now what if I want to speculatively pre-load some media content without
knowing which piece of media the user will eventually pick? If the user is on a
web page that contains 10 videos, we probably have enough memory to fetch one
segment file from each but we should definitely not create 10 hidden <code>&lt;video&gt;</code>
elements and 10 <code>MediaSource</code> objects and start feeding that data.</p>
<p>The two-part example below shows you how to pre-cache multiple first segments of
video using the powerful and easy-to-use <a href="/cache-api-quick-guide/">Cache API</a>. Note that something similar
can be achieved with IndexedDB as well. We're not using service workers yet as
the Cache API is also accessible from the <code>window</code> object.</p>
<h4 id="fetch-and-cache">Fetch and cache <a class="w-headline-link" href="#fetch-and-cache">#</a></h4>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> videoFileUrls <span class="token operator">=</span> <span class="token punctuation">[</span><br>  <span class="token string">'bat_video_file_1.webm'</span><span class="token punctuation">,</span><br>  <span class="token string">'cow_video_file_1.webm'</span><span class="token punctuation">,</span><br>  <span class="token string">'dog_video_file_1.webm'</span><span class="token punctuation">,</span><br>  <span class="token string">'fox_video_file_1.webm'</span><span class="token punctuation">,</span><br><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token comment">// Let's create a video pre-cache and store all first segments of videos inside.</span><br>window<span class="token punctuation">.</span>caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'video-pre-cache'</span><span class="token punctuation">)</span><br><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span> <span class="token operator">=></span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>videoFileUrls<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">videoFileUrl</span> <span class="token operator">=></span> <span class="token function">fetchAndCache</span><span class="token punctuation">(</span>videoFileUrl<span class="token punctuation">,</span> cache<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">fetchAndCache</span><span class="token punctuation">(</span><span class="token parameter">videoFileUrl<span class="token punctuation">,</span> cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Check first if video is in the cache.</span><br>  <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>videoFileUrl<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cacheResponse</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token comment">// Let's return cached response if video is already in the cache.</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheResponse<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> cacheResponse<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token comment">// Otherwise, fetch the video from the network.</span><br>    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>videoFileUrl<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">networkResponse</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token comment">// Add the response to the cache and return network response in parallel.</span><br>      cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>videoFileUrl<span class="token punctuation">,</span> networkResponse<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">return</span> networkResponse<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><p>Note that if I were to use HTTP <code>Range</code> requests, I would have to manually recreate
a <code>Response</code> object as the Cache API doesn't support <code>Range</code> responses <a href="https://github.com/whatwg/fetch/issues/144" rel="noopener">yet</a>. Be
mindful that calling <code>networkResponse.arrayBuffer()</code> fetches the whole content
of the response at once into renderer memory, which is why you may want to use
small ranges.</p>
<p>For reference, I've modified part of the example above to save HTTP Range
requests to the video precache.</p>
<web-copy-code><pre class="language-js"><code class="language-js">    <span class="token operator">...</span><br>    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>videoFileUrl<span class="token punctuation">,</span> <span class="token punctuation">{</span> headers<span class="token operator">:</span> <span class="token punctuation">{</span> range<span class="token operator">:</span> <span class="token string">'bytes=0-567139'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">networkResponse</span> <span class="token operator">=></span> networkResponse<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// Add the response to the cache and return network response in parallel.</span><br>      cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>videoFileUrl<span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">return</span> response<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><h4 id="play-video">Play video <a class="w-headline-link" href="#play-video">#</a></h4>
<p>When a user clicks a play button, we'll fetch the first segment of video
available in the Cache API so that playback starts immediately if available.
Otherwise, we'll simply fetch it from the network. Keep in mind that browsers
and users may decide to clear the <a href="/storage-for-the-web/#eviction">Cache</a>.</p>
<p>As seen before, we use MSE to feed that first segment of video to the video
element.</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">onPlayButtonClick</span><span class="token punctuation">(</span><span class="token parameter">videoFileUrl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  video<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Used to be able to play video later.</span><br><br>  window<span class="token punctuation">.</span>caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'video-pre-cache'</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span> <span class="token operator">=></span> <span class="token function">fetchAndCache</span><span class="token punctuation">(</span>videoFileUrl<span class="token punctuation">,</span> cache<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Defined above.</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> mediaSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    video<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>mediaSource<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    mediaSource<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'sourceopen'</span><span class="token punctuation">,</span> sourceOpen<span class="token punctuation">,</span> <span class="token punctuation">{</span> once<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">function</span> <span class="token function">sourceOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>video<span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">const</span> sourceBuffer <span class="token operator">=</span> mediaSource<span class="token punctuation">.</span><span class="token function">addSourceBuffer</span><span class="token punctuation">(</span><span class="token string">'video/webm; codecs="vp09.00.10.08"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      sourceBuffer<span class="token punctuation">.</span><span class="token function">appendBuffer</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token comment">// TODO: Fetch the rest of the video when user starts playing video.</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><aside class="aside flow bg-state-warn-bg color-core-text">
<p class="cluster ">
<span class="aside__icon box-block color-state-warn-text"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" role="img" aria-label="Warning sign" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M23 21L12 2 1 21h22zm-12-3v-2h2v2h-2zm0-4h2v-4h-2v4z" />
</svg></span>
<strong>Warning</strong></p>
<div class=" flow">
<p>For cross-origin resources, make sure your CORS headers are set properly. As
we can't create an array buffer from an opaque response retrieved with
<code>fetch(videoFileUrl, { mode: 'no-cors' })</code>, we won't be able to feed any video
or audio element.</p>
</div></aside>
<h3 id="create-range-responses-with-a-service-worker">Create Range responses with a service worker <a class="w-headline-link" href="#create-range-responses-with-a-service-worker">#</a></h3>
<p>Now what if you have fetched an entire video file and saved it in
the Cache API? When the browser sends an HTTP <code>Range</code> request, you certainly don't
want to bring the entire video into renderer memory as the Cache API doesn't
support <code>Range</code> responses <a href="https://github.com/whatwg/fetch/issues/144" rel="noopener">yet</a>.</p>
<p>So let me show how to intercept these requests and return a customized <code>Range</code>
response from a service worker.</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token function">loadFromCacheOrFetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">loadFromCacheOrFetch</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Search through all available caches for this request.</span><br>  <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br><br>    <span class="token comment">// Fetch from network if it's not already in the cache.</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// Note that we may want to add the response to the cache and return</span><br>      <span class="token comment">// network response in parallel as well.</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Browser sends a HTTP Range request. Let's provide one reconstructed</span><br>    <span class="token comment">// manually from the cache.</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'range'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br><br>        <span class="token comment">// Get start position from Range request header.</span><br>        <span class="token keyword">const</span> pos <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^bytes\=(\d+)\-</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'range'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><br>          status<span class="token operator">:</span> <span class="token number">206</span><span class="token punctuation">,</span><br>          statusText<span class="token operator">:</span> <span class="token string">'Partial Content'</span><span class="token punctuation">,</span><br>          headers<span class="token operator">:</span> response<span class="token punctuation">.</span>headers<br>        <span class="token punctuation">}</span><br>        <span class="token keyword">const</span> slicedResponse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        slicedResponse<span class="token punctuation">.</span><span class="token function">setHeaders</span><span class="token punctuation">(</span><span class="token string">'Content-Range'</span><span class="token operator">:</span> <span class="token string">'bytes '</span> <span class="token operator">+</span> pos <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span><br>            <span class="token punctuation">(</span>data<span class="token punctuation">.</span>size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        slicedResponse<span class="token punctuation">.</span><span class="token function">setHeaders</span><span class="token punctuation">(</span><span class="token string">'X-From-Cache'</span><span class="token operator">:</span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token keyword">return</span> slicedResponse<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">return</span> response<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><p>It is important to note that I used <code>response.blob()</code> to recreate this sliced
response as this simply gives me a handle to the file while
<code>response.arrayBuffer()</code> brings the entire file into renderer memory.</p>
<p>My custom <code>X-From-Cache</code> HTTP header can be used to know whether this request
came from the cache or from the network. It can be used by a player such as
<a href="https://github.com/google/shaka-player/blob/master/docs/tutorials/service-worker.md" rel="noopener">ShakaPlayer</a> to ignore the response time as an indicator of
network speed.</p>
<div class="youtube">  <lite-youtube    videoid="f8EGZa32Mts"      >  </lite-youtube></div>
<p>Have a look at the official <a href="https://github.com/GoogleChrome/sample-media-pwa" rel="noopener">Sample Media App</a> and in particular its
<a href="https://github.com/GoogleChrome/sample-media-pwa/blob/master/src/client/scripts/ranged-response.js" rel="noopener">ranged-response.js</a> file for a complete solution for how to handle <code>Range</code>
requests.</p>


      

      <div class="cluster gutter-base flow-space-size-2" role="list" aria-label="tags">
        
          
        
          
            
            <a class="pill" href="/tags/media/">Media</a>
          
        
          
            
            <a class="pill" href="/tags/performance/">Performance</a>
          
        
          
            
            <a class="pill" href="/tags/network/">Network</a>
          
        
      </div>

      <div class="text-size-0 color-mid-text">
        <span>
          
          Last updated: <time>Nov 16, 2020</time>
          
        </span>
        —
        <a
          href="https://github.com/GoogleChrome/web.dev/blob/main/src/site/content/en/blog/fast-playback-with-preload/index.md"
        >
          Improve article
        </a>
      </div>

      

      
        
        
      

      
        <div class="flow-space-size-2">
          <a href="/fast" class="button" data-type="secondary">
            <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>

            <span>Return to all articles</span>
          </a>
        </div>
      
      <div class="docked-actions flow flow-space-base">    
        <div>
          <share-action class="gc-analytics-event fab"
            authors="François Beaufort"
            data-category="web.dev"
            data-label="share"
            data-action="click"
            data-type="primary"
            data-icon="share"
            tabindex="0"
            role="button"
          >
            <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M18 16.1c-.8 0-1.4.3-2 .8l-7.1-4.2c.1-.2.1-.5.1-.7s0-.5-.1-.7L16 7.2c.5.5 1.2.8 2 .8 1.7 0 3-1.3 3-3s-1.3-3-3-3-3 1.3-3 3c0 .2 0 .5.1.7L8 9.8C7.5 9.3 6.8 9 6 9c-1.7 0-3 1.3-3 3s1.3 3 3 3c.8 0 1.5-.3 2-.8l7.1 4.2c-.1.2-.1.4-.1.6 0 1.6 1.3 2.9 2.9 2.9s2.9-1.3 2.9-2.9-1.2-2.9-2.8-2.9z" fill="currentColor"/></svg>
 
            <span class="fab__label">Share</span>
          </share-action>
        </div>
        
      </div>
    </article>
  </div>
</div>


</main>
<footer class="site-footer" role="contentinfo">
  <nav class="site-footer__primary-nav auto-grid" aria-label="footer navigation">
    <div>
      <h3 class="text-size-2 color-mid-text">Contribute</h3>
      <ul class="w-footer__linkbox-list" role="list">
        <li>
          <a href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&labels=bug&template=bug_report.md&title="
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
            File a bug
          </a>
        </li>
        <li>
          <a href="https://github.com/googlechrome/web.dev"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
            View source
          </a>
        </li>
      </ul>
    </div>
    <div>
      <h3 class="text-size-2 color-mid-text">Related content</h3>
      <ul class="w-footer__linkbox-list" role="list">
          <li>
          <a href="https://developer.chrome.com/"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
            developer.chrome.com
          </a>
        </li>
        <li>
          <a href="https://blog.chromium.org/"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
            Chrome updates
          </a>
        </li>
        <li>
          <a href="https://developers.google.com/web/fundamentals"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
            Web Fundamentals
          </a>
        </li>
        <li>
          <a href="/tags/case-study/"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">
            Case studies
          </a>
        </li>
        <li>
          <a href="/podcasts/"
            data-category="Podcasts" data-label="Footer Link (index 5)">
            Podcasts
          </a>
        </li>
        <li>
          <a href="/shows/"
            data-category="Shows" data-label="Footer Link (index 6)">
            Shows
          </a>
        </li>
      </ul>
    </div>
    <div>
      <h3 class="text-size-2 color-mid-text">Connect</h3>
      <ul class="w-footer__linkbox-list" role="list">
        <li>
          <a href="https://www.twitter.com/ChromiumDev"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
            Twitter
          </a>
        </li>
        <li>
          <a href="https://www.youtube.com/user/ChromeDevelopers"
            data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
            YouTube
          </a>
        </li>
      </ul>
    </div>
  </nav>
  <nav class="site-footer__brand-nav repel" aria-label="Google developers">
    <ul class="cluster" role="list">
      <li>
        <a href="https://developers.google.com/" data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link">
          <img loading="lazy" width="185" height="33" class="w-footer__utility-logo" src="/images/lockup-color.png"
            alt="Google Developers" />
        </a>
      </li>
      <li>
        <a href="https://developer.chrome.com/"
          data-category="Site-Wide Custom Events" data-label="Footer Chrome Link">
          Chrome
        </a>
      </li>
      <li>
        <a href="https://firebase.google.com/" data-category="Site-Wide Custom Events"
          data-label="Footer Firebase Link">
          Firebase
        </a>
      </li>
      <li>
        <a href="https://cloud.google.com/" data-category="Site-Wide Custom Events"
          data-label="Footer Google Cloud Platform Link">
          Google Cloud Platform
        </a>
      </li>
      <li>
        <a href="https://developers.google.com/products"
          data-category="Site-Wide Custom Events" data-label="Footer All products Link">
          All products
        </a>
      </li>
    </ul>
    <web-language-select current="en"></web-language-select>
  </nav>
  <nav class="site-footer__misc-links" aria-label="terms and policies">
    <ul class="cluster" role="list">
      <li>
        <a href="https://policies.google.com/" data-category="Site-Wide Custom Events"
          data-label="Footer Terms and Privacy link">
          Terms &amp; Privacy
        </a>
      </li>
      <li>
        <a href="/community-guidelines/" data-category="Site-Wide Custom Events"
          data-label="Footer Community Guidelines link">
          Community Guidelines
        </a>
      </li>
    </ul>
  </nav>
  <p class="gap-top-size-2 text-size-0">
    Except as otherwise noted, the content of this page is licensed
    under the
    <a href="https://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 License</a>,
    and code samples are licensed under the
    <a href="https://www.apache.org/licenses/LICENSE-2.0">
    Apache 2.0 License</a>. For details, see the
    <a href="https://developers.google.com/terms/site-policies">
    Google Developers Site Policies</a>.
  </p>
</footer>


  </body>
</html>
