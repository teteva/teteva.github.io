
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">


  
    
    <link rel="stylesheet" href="/css/main.css?v=7b30dba0acea8">
  

  <link rel="preload" as="font" crossorigin href="/fonts/material-icons/regular.woff2">


<link rel="preload" as="font" crossorigin href="/fonts/google-sans/regular/latin.woff2">
<link rel="preload" as="font" crossorigin href="/fonts/google-sans/bold/latin.woff2">

<meta name="theme-color" content="#fff"/>




<title>Optimize third-party JavaScript</title>
<meta name="description" content="Learn about techniques for optimizing slow third-party resources with some help from Lighthouse. " />

<link rel="canonical" href="https://web.dev/codelab-optimize-third-party-javascript/" />

<meta itemprop="name" content="Optimize third-party JavaScript" />
<meta itemprop="description" content="Learn about techniques for optimizing slow third-party resources with some help from Lighthouse. " />
<meta itemprop="image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://web.dev/codelab-optimize-third-party-javascript/" />
<meta property="og:site_name" content="web.dev" />
<meta property="og:title" content="Optimize third-party JavaScript" />
<meta property="og:description" content="Learn about techniques for optimizing slow third-party resources with some help from Lighthouse. " />
<meta property="og:image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:image:alt" content="" />
<meta property="tag" content="performance" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Optimize third-party JavaScript" />
<meta name="twitter:description" content="Learn about techniques for optimizing slow third-party resources with some help from Lighthouse. " />
<meta name="twitter:image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<link
  rel="alternate"
  href="/feed.xml"
  type="application/atom+xml"
  data-title="web.dev feed"
/>

<link rel="manifest" href="/manifest.webmanifest" />

<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="mask-icon" color="#0054ff" href="/images/safari-pinned-tab.svg">



<script>
window.ga =
  window.ga ||
  function () {
    (ga.q = ga.q || []).push(arguments);
  };
ga.l = +new Date();
ga('create', 'UA-126406676-2');
ga('set', 'transport', 'beacon');
ga('set', 'anonymizeIp', true);
ga('set', 'page', window.location.pathname);
ga('set', 'dimension5', '4');
ga('send', 'pageview');
</script>







<script>
function loadScript(url, type) {
  const s = document.createElement('script');
  s.src = url;
  if (type) {
    s.type = type;
  }
  if (type === 'module') {
    s.async = false; // Preserve load order.
    const pre = document.createElement('link');
    pre.rel = 'modulepreload';
    pre.href = url;
    document.head.append(pre);
    // We use DOMContentLoaded as the loader script is running sync, and inserting a module script here doesn't defer. This brings back normal type="module" behavior.
    window.addEventListener('DOMContentLoaded', () => {
      document.head.append(s);
    });
  } else {
    document.head.append(s);
  }
}
loadScript('/js/app.js?v=46e896ef772d', 'module');




  loadScript('/js/content.js?v=20a14e3af23b1', 'module');


  loadScript('https://www.google-analytics.com/analytics.js', null);

</script>

  </head>
  <body class="unresolved">
    
    <web-snackbar-container></web-snackbar-container>

    



<web-header class="header-default" role="navigation">
  <button data-open-drawer-button class="w-button--svg w-button--round" aria-label="Open menu">
    








  










  <svg class="icon " role="img" aria-label="menu" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>


    <span class="w-tooltip w-tooltip--left">Open menu</span>
  </button>

  <a
    href="/"
    class="header-default__logo-link gc-analytics-event"
    data-category="Site-Wide Custom Events"
    data-label="Site logo"
  >
    <img class="header-default__logo" width="125" height="23" src="/images/lockup.svg" alt="web.dev" />
  </a>

  <div class="header-default__middle">
    <div class="header-default__links">
      <a
        href="/learn/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Learn"
      >
        Learn
      </a>

      <a
        href="/measure/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Measure"
      >
        Measure
      </a>

      <a
        href="/blog/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Blog"
      >
        Blog
      </a>

      <a
        href="/about/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: About"
      >
        About
      </a>
    </div>
    <web-search results-id="search-main-results" i18n="{&quot;search&quot;:{&quot;en&quot;:&quot;Search&quot;},&quot;open_search&quot;:{&quot;en&quot;:&quot;Open search&quot;},&quot;all_articles&quot;:{&quot;en&quot;:&quot;All articles&quot;},&quot;close_search&quot;:{&quot;en&quot;:&quot;Close search&quot;}}"></web-search>
    <web-search-results id="search-main-results"></web-search-results>
  </div>

  <web-profile-switcher-container></web-profile-switcher-container>
</web-header>



<web-navigation-drawer class="drawer-default" type="modal">
  <nav data-drawer-container>
    <div class="drawer-default__contents">
      <div class="drawer-default__header">
        <button
          data-drawer-close-button
          class="drawer-default__hide w-button--svg w-button--round"
          aria-label="Close"
        >
          








  










  <svg class="icon " role="img" aria-label="close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>


          <span class="w-tooltip">Close</span>
        </button>
        <a
          href="/"
          class="gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Site logo"
        >
          <img
            width="125"
            height="30"
            class="drawer-default__logo"
            src="/images/lockup.svg"
            alt="web.dev"
          />
        </a>
      </div>
      <a
        href="/learn/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Learn"
      >
        Learn
      </a>
      <a
        href="/measure/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Measure"
      >
        Measure
      </a>
      <a
        href="/blog/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Blog"
      >
        Blog
      </a>
      <a
        href="/about/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: About"
      >
        About
      </a>
    </div>
  </nav>
</web-navigation-drawer>

<main>
  <div id="content">
    
    
<div class="codelab-landing-page">
  
    
    
    
  
  <web-codelab class="web-codelab" glitch="3rd-party-optimization-starter"  >
    <div class="web-codelab__instructions">
      
      <article class="prose legacy-rollout">
        <header class="flow gap-bottom-size-3">

          <h1 id="optimize-third-party-javascript">Optimize third-party JavaScript</h1>
          

          
            <div class="flow-space-size-1 color-mid-text text-size-0">
              <time>Aug 8, 2019</time>
              
            </div>
          

          

          
            <div class="cluster flow-space-size-2">
              
                <div class="w-author">
  <a href="/authors/mihajlija/"><img     alt="Milica Mihajlija"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/WkMOiDtaDgiAA2YkRZ5H.jpg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/admin/WkMOiDtaDgiAA2YkRZ5H.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/admin/WkMOiDtaDgiAA2YkRZ5H.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/admin/WkMOiDtaDgiAA2YkRZ5H.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/admin/WkMOiDtaDgiAA2YkRZ5H.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/admin/WkMOiDtaDgiAA2YkRZ5H.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /></a>
  <div
    class="w-author__info"
    style="display: flex; flex-direction: column; justify-content: center;"
  >
    <cite class="w-author__name">
      <a class="w-author__name-link" href="/authors/mihajlija/">Milica Mihajlija</a>
    </cite>
    <ul class="w-author__link-list">
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://twitter.com/bibydigital"
          >Twitter</a
        >
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://github.com/mihajlija">GitHub</a>
      </li>
      
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://mihajlija.github.io/">Blog</a>
      </li>
    </ul>
  </div>
</div>
              
            </div>
          
        </header>

        

        <div class="w-aside w-aside--note">
<p>This codelab uses Chrome DevTools.
<a href="https://www.google.com/chrome" rel="noopener">Download Chrome</a> if you don't already have it.</p>
</div>
<p><a href="/third-party-javascript">Third-party scripts impact performance</a>, which is why it's important to <a href="/identify-slow-third-party-javascript">audit them regularly</a> and use <a href="/efficiently-load-third-party-javascript">efficient techniques for loading</a> them. This codelab shows you how to optimize the loading of third-party resources. It covers the following techniques:</p>
<ul>
<li>
<p>Deferring script loading</p>
</li>
<li>
<p>Lazy-loading non-critical resources</p>
</li>
<li>
<p>Preconnecting to required origins</p>
</li>
</ul>
<p>The included sample app features a simple web page with three features coming from third-party sources:</p>
<ul>
<li>
<p>A video embed</p>
</li>
<li>
<p>A data-visualization library for rendering a line graph</p>
</li>
<li>
<p>A social media sharing widget</p>
</li>
</ul>
<figure class="w-figure">
  <img     alt="Screenshot of the page with third-party resources highlighted."     class="w-screenshot"     decoding="async"     height="1294"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/cuWcC16X6oKRbXJXIIt7.png?auto=format&w=1600 1600w"          width="800"   />
  <figcaption class="w-figcaption">Third-party resources in the sample app.</figcaption>
</figure>
<p>You'll start by measuring the performance of the app and then apply each technique to improve different aspects of app performance.</p>
<h2 id="measure-performance">Measure performance <a class="w-headline-link" href="#measure-performance">#</a></h2>
<p>First open the sample app in the fullscreen view:</p>
<ol>
<li>Click <strong>Remix to Edit</strong> to make the project editable.</li>
<li>To preview the site, press <strong>View App</strong>. Then press
<strong>Fullscreen</strong>
<img
src="/images/glitch/fullscreen.svg"
alt="fullscreen"
style="padding: 4px 8px; opacity: .5; border: 1px solid #c3c3c3; border-radius: 5px;"
/>.</li>
</ol>
<p>Run a <a href="https://developers.google.com/web/tools/lighthouse/" rel="noopener">Lighthouse</a> <a href="/lighthouse-performance">performance audit</a> on the page to establish baseline performance:</p>
<ol>
<li>Press `Control+Shift+J` (or `Command+Option+J` on Mac) to open DevTools.</li>
<li>Click the <strong>Lighthouse</strong> tab.</li>
<li>Click <strong>Mobile</strong>.</li>
<li>Select the <strong>Performance</strong> checkbox. (You can clear the rest of the checkboxes in the Audits section.)</li>
<li>Click <strong>Simulated Fast 3G, 4x CPU Slowdown</strong>.</li>
<li>Select the <strong>Clear Storage</strong> checkbox.</li>
<li>Click <strong>Run audits</strong>.</li>
</ol>
<p>When you run an audit on your machine, <a href="https://developers.google.com/web/tools/lighthouse/variability" rel="noopener">the exact results may vary</a>, but you should notice that the <a href="/first-contentful-paint">First Contentful Paint (FCP)</a> time is pretty high, and that Lighthouse suggests two opportunities to investigate: <strong>Eliminate render-blocking resources</strong> and <strong>Preconnect to required origins</strong>. (Even if the metrics are all in the green, optimizations will still yield improvements.)</p>
<figure class="w-figure">
  <img     alt="Screenshot of Lighthouse audit showing 2.4 second FCP and two opportunities: Eliminate render-blocking resources and Preconnect to required origins."     class="w-screenshot"     decoding="async"     height="700"          loading="lazy"     sizes="(min-width: 741px) 741px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/gIkIJM2OaocxImjLLjev.png?auto=format&w=1482 1482w"          width="741"   />
</figure>
<h2 id="defer-third-party-javascript">Defer third-party JavaScript <a class="w-headline-link" href="#defer-third-party-javascript">#</a></h2>
<p>The <strong>Eliminate render-blocking resources</strong> audit identified that you can save some time by deferring a script coming from d3js.org:</p>
<figure class="w-figure">
  <img     alt="Screenshot of Eliminate render-blocking resources audit with the d3.v3.min.js script highlighted."     class="w-screenshot"     decoding="async"     height="337"          loading="lazy"     sizes="(min-width: 718px) 718px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/P9ejh4JMzdpu8N3aZ7bC.png?auto=format&w=1436 1436w"          width="718"   />
</figure>
<p><a href="https://d3js.org/" rel="noopener">D3.js</a> is a JavaScript library for creating data visualizations. The <code>script.js</code> file in the sample app uses D3 utility functions to create the SVG line chart and append it to the page. The order of operations here matters: <code>script.js</code> has to run after the document is parsed and the D3 library has loaded, which is why it's included right before the closing <code>&lt;/body&gt;</code> tag in <code>index.html</code>.</p>
<p>However, the D3 script is included in the page's <code>&lt;head&gt;</code>, which blocks the parsing of the rest document:</p>
<figure class="w-figure">
  <img     alt="Screenshot of index.html with highlighted script tag in the head."     class="w-screenshot"     decoding="async"     height="265"          loading="lazy"     sizes="(min-width: 718px) 718px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/vRP2oYmijq0sVyLRb2nU.png?auto=format&w=1436 1436w"          width="718"   />
</figure>
<p>Two magic attributes can unblock the parser when added to the script tag:</p>
<ul>
<li>
<p><a href="https://developer.mozilla.org/docs/Web/HTML/Element/script#attr-async" rel="noopener"><code>async</code></a> ensures that scripts download in the background and execute <strong>at the first opportunity</strong> after they finish downloading.</p>
</li>
<li>
<p><a href="https://developer.mozilla.org/docs/Web/HTML/Element/script#attr-defer" rel="noopener"><code>defer</code></a> ensures that scripts download in the background and execute <strong>after parsing</strong> is completely finished.</p>
</li>
</ul>
<p>Since this chart is not really critical to the overall page and will most likely be below the fold, use <code>defer</code> to make sure there's no parser blocking.</p>
<h3 id="step-1:-load-the-script-asynchronously-with-the-defer-attribute">Step 1: Load the script asynchronously with the <code>defer</code> attribute <a class="w-headline-link" href="#step-1:-load-the-script-asynchronously-with-the-defer-attribute">#</a></h3>
<p>On line 17 in <code>index.html</code>, add the <code>defer</code> attribute to the <code>&lt;script&gt;</code> element:</p>
<web-copy-code><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://d3js.org/d3.v3.min.js<span class="token punctuation">"</span></span> <span class="token attr-name">defer</span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
</web-copy-code><h3 id="step-2:-ensure-the-correct-order-of-operations">Step 2: Ensure the correct order of operations <a class="w-headline-link" href="#step-2:-ensure-the-correct-order-of-operations">#</a></h3>
<p>Now that D3 is deferred, <code>script.js</code> will run before D3 is ready, resulting in an error.</p>
<p>Scripts with the <code>defer</code> attribute execute in the order in which they were specified. To ensure <code>script.js</code> gets executed after D3 is ready, add <code>defer</code> to it and move it up to the <code>&lt;head&gt;</code> of the document, right after the D3 <code>&lt;script&gt;</code> element. Now it no longer blocks the parser, and the download starts sooner.</p>
<web-copy-code><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://d3js.org/d3.v3.min.js<span class="token punctuation">"</span></span> <span class="token attr-name">defer</span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./script.js<span class="token punctuation">"</span></span> <span class="token attr-name">defer</span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
</web-copy-code><h2 id="lazy-load-third-party-resources">Lazy-load third-party resources <a class="w-headline-link" href="#lazy-load-third-party-resources">#</a></h2>
<p>All resources that are below the fold are good candidates for <a href="/efficiently-load-third-party-javascript/#lazy-load-third-party-resources">lazy-loading</a>.</p>
<p>The sample app has a YouTube video embedded in an <a href="https://developer.mozilla.org/docs/Web/HTML/Element/iframe" rel="noopener">iframe</a>. To check out how many requests the page makes and which come from the embedded YouTube iframe:</p>
<ol>
<li>To preview the site, press <strong>View App</strong>. Then press
<strong>Fullscreen</strong>
<img
src="/images/glitch/fullscreen.svg"
alt="fullscreen"
style="padding: 4px 8px; opacity: .5; border: 1px solid #c3c3c3; border-radius: 5px;"
/>.</li>
<li>Press `Control+Shift+J` (or `Command+Option+J` on Mac) to open DevTools.</li>
<li>Click the <strong>Network</strong> tab.</li>
<li>Select the <strong>Disable cache</strong> checkbox.</li>
<li>Select <em>Fast 3G</em> in the <strong>Throttling</strong> dropdown menu.</li>
<li>Reload the page.</li>
</ol>
<img     alt="Screenshot of DevTools Network panel."          decoding="async"     height="618"          loading="lazy"     sizes="(min-width: 783px) 783px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/DjnRutx27trV4YkYcKhr.png?auto=format&w=1566 1566w"          width="783"   />
<p>The <strong>Network</strong> panel reveals that the page made a total of 28 requests and transferred almost 1 MB of compressed resources.</p>
<p>To identify the requests that the YouTube <code>iframe</code> made, look for the video ID <code>6lfaiXM6waw</code> in the <strong>Initiator</strong> column. To group together all the requests by domain:</p>
<ul>
<li>
<p>In the <strong>Network</strong> panel, right-click a column title.</p>
</li>
<li>
<p>In the dropdown menu, select the <strong>Domains</strong> column.</p>
</li>
<li>
<p>To sort the requests by domain, click the <strong>Domains</strong> column title.</p>
</li>
</ul>
<p>The new sorting reveals that there are additional requests to Google domains. In total, the YouTube iframe makes 14 requests for scripts, stylesheets, images, and fonts. But unless users actually scroll down to play the video, they don't really need all those assets.</p>
<p>By waiting to lazy-load the video until a user scrolls down to that section of the page, you cut the number of requests the page initially makes. This approach saves users' data and speeds up the initial load.</p>
<p>One way to implement lazy-loading is by using the <a href="https://developer.mozilla.org/docs/Web/API/Intersection_Observer_API" rel="noopener">Intersection Observer</a>, a browser API that notifies you when an element enters or exits the browser's viewport.</p>
<h3 id="step-1:-prevent-video-from-loading-initially">Step 1: Prevent video from loading initially <a class="w-headline-link" href="#step-1:-prevent-video-from-loading-initially">#</a></h3>
<p>To lazy-load the video iframe, you must first prevent it from loading in the usual way. Do that by replacing the <code>src</code> attribute with the <code>data-src</code> attribute to specify the video URL:</p>
<web-copy-code><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>560<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>315<span class="token punctuation">"</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.youtube.com/embed/lS9D6w1GzGY<span class="token punctuation">"</span></span> <span class="token attr-name">frameborder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">allow</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture<span class="token punctuation">"</span></span> <span class="token attr-name">allowfullscreen</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span></code></pre>
</web-copy-code><p><code>data-src</code> is a <a href="https://developer.mozilla.org/docs/Learn/HTML/Howto/Use_data_attributes" rel="noopener">data attribute</a>, which allows you to store extra information on standard HTML elements. A data attribute can be named anything, as long as it starts with &quot;data-&quot;.</p>
<p>An iframe without a <code>src</code> simply won't load.</p>
<h3 id="step-2:-use-intersection-observer-to-lazy-load-the-video">Step 2: Use Intersection Observer to lazy-load the video <a class="w-headline-link" href="#step-2:-use-intersection-observer-to-lazy-load-the-video">#</a></h3>
<p>To load the video when a user scrolls to it you need to know when that happens. That's where the Intersection Observer API steps in. The Intersection Observer API lets you register a callback function that's executed whenever an element you want to track enters or exits the viewport.</p>
<p>To get started, create a new file and name it <code>lazy-load.js</code>:</p>
<ul>
<li>Click <strong>New File</strong> and give it a name.</li>
<li>Click <strong>Add This File</strong>.</li>
</ul>
<p>Add the script tag to your document head:</p>
<web-copy-code><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/lazy-load.js<span class="token punctuation">"</span></span> <span class="token attr-name">defer</span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
</web-copy-code><p>In <code>lazy-load.js</code>, create a new <code>IntersectionObserver</code> and pass it a callback function to run:</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token comment">// create a new Intersection Observer</span><br><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p>Now give <code>observer</code> a target element to watch (the video iframe in this case) by passing it as an argument in the <code>observe</code> method:</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token comment">// the element that you want to watch</span><br><span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// register the element with the observe method</span><br>observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p><code>callback</code> receives a list of <a href="https://developer.mozilla.org/docs/Web/API/IntersectionObserverEntry" rel="noopener"><code>IntersectionObserverEntry</code></a> objects and the <a href="https://developer.mozilla.org/docs/Web/API/IntersectionObserver" rel="noopener"><code>IntersectionObserver</code></a> object itself. Each entry contains a <a href="https://developer.mozilla.org/docs/Web/API/IntersectionObserverEntry/target" rel="noopener"><code>target</code></a> element and properties that describe its dimensions, position, the time it entered the viewport, and more. One of the properties of <code>IntersectionObserverEntry</code> is <a href="https://developer.mozilla.org/docs/Web/API/IntersectionObserverEntry/isIntersecting" rel="noopener"><code>isIntersecting</code></a>—a boolean value that equals <code>true</code> when the element enters the viewport.</p>
<p>In this example, the <code>target</code> is the <code>iframe</code>. <code>isIntersecting</code> equals <code>true</code> when <code>target</code> enters the viewport. To see this in action, replace <code>callback</code> with the following function:</p>
<web-copy-code><pre class="language-js"><code class="language-js"><del class="highlight-line highlight-line-remove"><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span></del><br><ins class="highlight-line highlight-line-add"><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">entries<span class="token punctuation">,</span> observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></ins><br><ins class="highlight-line highlight-line-add">    entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token operator">=></span> <span class="token punctuation">{</span></ins><br><ins class="highlight-line highlight-line-add">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span></ins><br><ins class="highlight-line highlight-line-add">      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span><span class="token punctuation">;</span></ins><br><ins class="highlight-line highlight-line-add">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></ins><br><ins class="highlight-line highlight-line-add">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></ins></code></pre>
</web-copy-code><ol>
<li>To preview the site, press <strong>View App</strong>. Then press
<strong>Fullscreen</strong>
<img
src="/images/glitch/fullscreen.svg"
alt="fullscreen"
style="padding: 4px 8px; opacity: .5; border: 1px solid #c3c3c3; border-radius: 5px;"
/>.</li>
<li>Press `Control+Shift+J` (or `Command+Option+J` on Mac) to open DevTools.</li>
<li>Click the <strong>Console</strong> tab.</li>
</ol>
<p>Try scrolling up and down. You should see the value of <code>isIntersecting</code> change and the target element logged to the console.</p>
<p>To load the video when the user scrolls to its position, use <code>isIntersecting</code> as a condition to run a <code>loadElement</code> function, which gets the value from the <code>iframe</code> element's <code>data-src</code> and sets it as the <code>iframe</code> element's <code>src</code> attribute. That replacement triggers the loading of the video. Then, once the video is loaded, call the <a href="https://developer.mozilla.org/docs/Web/API/IntersectionObserver/unobserve" rel="noopener"><code>unobserve</code></a> method on the <code>observer</code> to stop watching the target element:</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">entries<span class="token punctuation">,</span> observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><del class="highlight-line highlight-line-remove">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span></del><br><del class="highlight-line highlight-line-remove">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span><span class="token punctuation">;</span></del><br><del class="highlight-line highlight-line-remove">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></del><br><del class="highlight-line highlight-line-remove"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></del><br><ins class="highlight-line highlight-line-add">    <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{</span></ins><br><ins class="highlight-line highlight-line-add">      <span class="token comment">// do this when the element enters the viewport</span></ins><br><ins class="highlight-line highlight-line-add">      <span class="token function">loadElement</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span></ins><br><ins class="highlight-line highlight-line-add">      <span class="token comment">// stop watching</span></ins><br><ins class="highlight-line highlight-line-add">      observer<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span></ins><br><ins class="highlight-line highlight-line-add">    <span class="token punctuation">}</span></ins><br><ins class="highlight-line highlight-line-add">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></ins><br><ins class="highlight-line highlight-line-add"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></ins><br><span class="highlight-line"></span><br><ins class="highlight-line highlight-line-add"><span class="token keyword">function</span> <span class="token function">loadElement</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></ins><br><ins class="highlight-line highlight-line-add">  <span class="token keyword">const</span> src <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-src'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></ins><br><ins class="highlight-line highlight-line-add">  element<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span></ins><br><ins class="highlight-line highlight-line-add"><span class="token punctuation">}</span></ins></code></pre>
</web-copy-code><h3 id="step-3:-reevaluate-performance">Step 3: Reevaluate performance <a class="w-headline-link" href="#step-3:-reevaluate-performance">#</a></h3>
<p>To see how the size and number of resources changed, open the DevTools <strong>Network</strong> panel and reload the page again. The <strong>Network</strong> panel reveals that the page made 14 requests and only 260 KB. That's a meaningful improvement!</p>
<p>Now scroll down the page and keep an eye on the <strong>Network</strong> panel. When you get to the video, you should see the page trigger additional requests.</p>
<p><video      autoplay                                          loop      muted      playsinline                      >      <source src="https://storage.googleapis.com/web-dev-uploads/video/tcFciHGuF3MxnTr1y5ue01OGLBn2/bJHFfNjxvIthfRWeidbx.mp4" type="video/mp4" />    </video></p>
<div class="w-aside w-aside--note">
<p>In this example, the element is loaded when it enters the viewport, which you can see happening in the video above. You can avoid that delay and create a smoother user experience by loading elements a little before they enter the viewport. To do that, use the <a href="https://developer.mozilla.org/docs/Web/API/Intersection_Observer_API#Creating_an_intersection_observer" rel="noopener"><code>rootMargin</code></a> property to define margins around the target element, which effectively grows (or shrinks) the area that triggers the <code>isIntersecting</code> change.</p>
</div>
<h2 id="preconnect-to-required-origins">Preconnect to required origins <a class="w-headline-link" href="#preconnect-to-required-origins">#</a></h2>
<p>You've deferred non-critical JavaScript and lazy-loaded the YouTube requests, so now it's time to optimize the remaining third-party content.</p>
<p>Adding the <code>rel=preconnect</code> attribute to a link tells the browser to establish a connection to a domain before the request for that resource is made. This attribute is best used on origins that provide resources you are certain the page needs.</p>
<p>The Lighthouse audit you ran in the first step suggested in <strong>Preconnect to required origins</strong> that you can save around 400 ms by <a href="/preconnect-and-dns-prefetch/">establishing early connections</a> to staticxx.facebook.com and youtube.com:</p>
<img     alt="Preconnect to required origins audit with the staticxx.facebook.com domain highlighted."          decoding="async"     height="279"          loading="lazy"     sizes="(min-width: 720px) 720px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/k4PDdjh77dXS1ZdGBSko.png?auto=format&w=1440 1440w"          width="720"   />
<p>Since the YouTube video is now lazy-loaded, that leaves only staticxx.facebook.com, the source of the social media sharing widget. Establishing an early connection to this domain is as simple as adding a <code>&lt;link&gt;</code> tag to the document's <code>&lt;head&gt;</code>:</p>
<web-copy-code><pre class="language-html"><code class="language-html">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preconnect<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://staticxx.facebook.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre>
</web-copy-code><h2 id="reevaluate-performance">Reevaluate performance <a class="w-headline-link" href="#reevaluate-performance">#</a></h2>
<p>Here's the state of the page <a href="https://glitch.com/~3rd-party-optimizations" rel="noopener">after optimization</a>. Follow the steps from the <a href="#measure-performance">Measure performance</a> section of the codelab to run another Lighthouse audit.</p>
<img     alt="Lighthouse audit showing 1 second FCP and the performance score of 99."          decoding="async"     height="511"          loading="lazy"     sizes="(min-width: 727px) 727px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/Iv12shtGoURq2CTqO6jN.png?auto=format&w=1454 1454w"          width="727"   />
<div class="w-aside w-aside--success">
<p><strong>Success</strong>:
You should see that FCP and the performance score have improved! 🎉 The page now loads faster and consumes less data⁠—and all without negatively affecting the user-experience. 🤝</p>
</div>


        <div class="text-size-0 color-mid-text">
          <span>
            
            Last updated: <time>Aug 8, 2019</time>
            
          </span>
          —
          <a
            href="https://github.com/GoogleChrome/web.dev/blob/main/src/site/content/en/fast/codelab-optimize-third-party-javascript/index.md"
          >
            Improve article
          </a>
        </div>

        
          
          
        

        
          <div class="flow-space-size-2">
            <a href="/efficiently-load-third-party-javascript" class="button" data-type="secondary">
              <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>

              <span>Return to article</span>
            </a>
          </div>
        
      </article>
    </div>
  </web-codelab>
</div>

  </div>
</main>
<footer class="w-footer">
  <nav class="w-footer__linkboxes">
    <ul class="w-footer__linkboxes-list">
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Contribute</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&labels=bug&template=bug_report.md&title="
              class="w-footer__linkbox-link" data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              File a bug
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/googlechrome/web.dev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              View source
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Related content</h3>
        <ul class="w-footer__linkbox-list">
         <li class="w-footer__linkbox-item">
            <a href="https://developer.chrome.com/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              developer.chrome.com
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://blog.chromium.org/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Chrome updates
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/fundamentals" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              Web Fundamentals
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/showcase/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">
              Case studies
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/podcasts/" class="w-footer__linkbox-link"
              data-category="Podcasts" data-label="Footer Link (index 5)">
              Podcasts
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/shows/" class="w-footer__linkbox-link"
              data-category="Shows" data-label="Footer Link (index 6)">
              Shows
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Connect</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://www.twitter.com/ChromiumDev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Twitter
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://www.youtube.com/user/ChromeDevelopers" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              YouTube
            </a>
          </li>
        </ul>
      </li>
    </ul>
  </nav>

  <div class="w-footer__utility">
    <nav class="w-footer__utility-nav">
      <a href="https://developers.google.com/" class="w-footer__utility-logo-link"
        data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link">
        <img loading="lazy" width="185" height="33" class="w-footer__utility-logo" src="/images/lockup-color.png"
          alt="Google Developers" />
      </a>
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developer.chrome.com/"
            data-category="Site-Wide Custom Events" data-label="Footer Chrome Link">
            Chrome
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://firebase.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Firebase Link">
            Firebase
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://cloud.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Google Cloud Platform Link">
            Google Cloud Platform
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developers.google.com/products"
            data-category="Site-Wide Custom Events" data-label="Footer All products Link">
            All products
          </a>
        </li>
      </ul>
      <web-language-select current="en"></web-language-select>
    </nav>
    <nav class="w-footer__utility-nav">
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://policies.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Terms and Privacy link">
            Terms &amp; Privacy
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="/community-guidelines/" data-category="Site-Wide Custom Events"
            data-label="Footer Community Guidelines link">
            Community Guidelines
          </a>
        </li>
      </ul>
      <div class="w-footer__license">
        <p>
          Except as otherwise noted, the content of this page is licensed
          under the
          <a href="https://creativecommons.org/licenses/by/4.0/">
          Creative Commons Attribution 4.0 License</a>,
          and code samples are licensed under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">
          Apache 2.0 License</a>. For details, see the
          <a href="https://developers.google.com/terms/site-policies">
          Google Developers Site Policies</a>.
        </p>
      </div>
    </nav>
  </div>
</footer>

  </body>
</html>
