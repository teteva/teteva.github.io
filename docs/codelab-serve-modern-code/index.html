
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">


  
    
    <link rel="stylesheet" href="/css/main.css?v=da9a72bd502a7">
  

  <link rel="preload" as="font" crossorigin href="/fonts/material-icons/regular.woff2">


<link rel="preload" as="font" crossorigin href="/fonts/google-sans/regular/latin.woff2">
<link rel="preload" as="font" crossorigin href="/fonts/google-sans/bold/latin.woff2">

<meta name="theme-color" content="#fff"/>




<title>Serve modern code to modern browsers for faster page loads</title>
<meta name="description" content="In this codelab, learn how to improve the performance of an application by minizming how much code is transpiled. " />

<link rel="canonical" href="https://web.dev/codelab-serve-modern-code/" />

<meta itemprop="name" content="Serve modern code to modern browsers for faster page loads" />
<meta itemprop="description" content="In this codelab, learn how to improve the performance of an application by minizming how much code is transpiled. " />
<meta itemprop="image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://web.dev/codelab-serve-modern-code/" />
<meta property="og:site_name" content="web.dev" />
<meta property="og:title" content="Serve modern code to modern browsers for faster page loads" />
<meta property="og:description" content="In this codelab, learn how to improve the performance of an application by minizming how much code is transpiled. " />
<meta property="og:image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<meta property="og:image:alt" content="" />
<meta property="tag" content="performance" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Serve modern code to modern browsers for faster page loads" />
<meta name="twitter:description" content="In this codelab, learn how to improve the performance of an application by minizming how much code is transpiled. " />
<meta name="twitter:image" content="https://web-dev.imgix.net/image/tcFciHGuF3MxnTr1y5ue01OGLBn2/vU99HKzIf5EUPnzGVPf1.png?auto=format&fit=max&w=1200&fm=auto" />
<link
  rel="alternate"
  href="/feed.xml"
  type="application/atom+xml"
  data-title="web.dev feed"
/>

<link rel="manifest" href="/manifest.webmanifest" />

<link rel="shortcut icon" href="/images/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="mask-icon" color="#0054ff" href="/images/safari-pinned-tab.svg">



<script>
window.ga =
  window.ga ||
  function () {
    (ga.q = ga.q || []).push(arguments);
  };
ga.l = +new Date();
ga('create', 'UA-126406676-2');
ga('set', 'transport', 'beacon');
ga('set', 'anonymizeIp', true);
ga('set', 'page', window.location.pathname);
ga('set', 'dimension5', '4');
ga('send', 'pageview');
</script>







<script>
function loadScript(url, type) {
  const s = document.createElement('script');
  s.src = url;
  if (type) {
    s.type = type;
  }
  if (type === 'module') {
    s.async = false; // Preserve load order.
    const pre = document.createElement('link');
    pre.rel = 'modulepreload';
    pre.href = url;
    document.head.append(pre);
    // We use DOMContentLoaded as the loader script is running sync, and inserting a module script here doesn't defer. This brings back normal type="module" behavior.
    window.addEventListener('DOMContentLoaded', () => {
      document.head.append(s);
    });
  } else {
    document.head.append(s);
  }
}
loadScript('/js/app.js?v=0c4ba4016e8e9', 'module');




  loadScript('/js/content.js?v=bb676edb6da61', 'module');


  loadScript('https://www.google-analytics.com/analytics.js', null);

</script>

  </head>
  <body class="unresolved">
    
    <web-snackbar-container></web-snackbar-container>

    



<web-header class="header-default" role="navigation">
  <button data-open-drawer-button class="w-button--svg w-button--round" aria-label="Open menu">
    








  










  <svg class="icon " role="img" aria-label="menu" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>


    <span class="w-tooltip w-tooltip--left">Open menu</span>
  </button>

  <a
    href="/"
    class="header-default__logo-link gc-analytics-event"
    data-category="Site-Wide Custom Events"
    data-label="Site logo"
  >
    <img class="header-default__logo" width="125" height="23" src="/images/lockup.svg" alt="web.dev" />
  </a>

  <div class="header-default__middle">
    <div class="header-default__links">
      <a
        href="/learn/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Learn"
      >
        Learn
      </a>

      <a
        href="/measure/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Measure"
      >
        Measure
      </a>

      <a
        href="/blog/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: Blog"
      >
        Blog
      </a>

      <a
        href="/about/"
        class="header-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Tab: About"
      >
        About
      </a>
    </div>
    <web-search results-id="search-main-results" i18n="{&quot;search&quot;:{&quot;en&quot;:&quot;Search&quot;},&quot;open_search&quot;:{&quot;en&quot;:&quot;Open search&quot;},&quot;all_articles&quot;:{&quot;en&quot;:&quot;All articles&quot;},&quot;close_search&quot;:{&quot;en&quot;:&quot;Close search&quot;}}"></web-search>
    <web-search-results id="search-main-results"></web-search-results>
  </div>

  <web-profile-switcher-container></web-profile-switcher-container>
</web-header>



<web-navigation-drawer class="drawer-default" type="modal">
  <nav data-drawer-container>
    <div class="drawer-default__contents">
      <div class="drawer-default__header">
        <button
          data-drawer-close-button
          class="drawer-default__hide w-button--svg w-button--round"
          aria-label="Close"
        >
          








  










  <svg class="icon " role="img" aria-label="close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>


          <span class="w-tooltip">Close</span>
        </button>
        <a
          href="/"
          class="gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Site logo"
        >
          <img
            width="125"
            height="30"
            class="drawer-default__logo"
            src="/images/lockup.svg"
            alt="web.dev"
          />
        </a>
      </div>
      <a
        href="/learn/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Learn"
      >
        Learn
      </a>
      <a
        href="/measure/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Measure"
      >
        Measure
      </a>
      <a
        href="/blog/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: Blog"
      >
        Blog
      </a>
      <a
        href="/about/"
        class="drawer-default__link gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="SideNav: About"
      >
        About
      </a>
    </div>
  </nav>
</web-navigation-drawer>

<main>
  <div id="content">
    
    
<div class="codelab-landing-page">
  
    
    
    
  
  <web-codelab class="web-codelab" glitch="serve-modern-code"  >
    <div class="web-codelab__instructions">
      
      <article class="prose legacy-rollout">
        <header class="flow gap-bottom-size-3">

          <h1 id="serve-modern-code-to-modern-browsers-for-faster-page-loads">Serve modern code to modern browsers for faster page loads</h1>
          

          
            <div class="flow-space-size-1 color-mid-text text-size-0">
              <time>Dec 12, 2018</time>
              
            </div>
          

          

          
            <div class="cluster flow-space-size-2">
              
                <div class="w-author">
  <a href="/authors/houssein/"><img     alt="Houssein Djirdeh"     class="w-author__image"     decoding="async"     height="64"          loading="lazy"     sizes="(min-width: 64px) 64px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?auto=format&fit=crop&h=64&w=64"     srcset="https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/admin/BibySYHD7JweNcHZCCOe.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x"          width="64"   /></a>
  <div
    class="w-author__info"
    style="display: flex; flex-direction: column; justify-content: center;"
  >
    <cite class="w-author__name">
      <a class="w-author__name-link" href="/authors/houssein/">Houssein Djirdeh</a>
    </cite>
    <ul class="w-author__link-list">
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://twitter.com/hdjirdeh"
          >Twitter</a
        >
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://github.com/housseindjirdeh">GitHub</a>
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://glitch.com/@housseindjirdeh"
          >Glitch</a
        >
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://houssein.me/">Blog</a>
      </li>
    </ul>
  </div>
</div>
              
            </div>
          
        </header>

        

        <div class="w-aside w-aside--note">
<p>This codelab uses Chrome DevTools.
<a href="https://www.google.com/chrome" rel="noopener">Download Chrome</a> if you don't already have it.</p>
</div>
<p>In this codelab, improve the performance of this simple application that allows
users to rate random cats. Learn how to optimize the JavaScript bundle by
minizming how much code is transpiled.</p>
<img     alt="App screenshot"          decoding="async"     height="681"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/E8nNmPiUnD9unvl0ydwT.png?auto=format&w=1600 1600w"          width="800"   />
<p>In the sample app,
you can select a word or emoji to convey how much you like each cat.
When you click a button,
the app displays the button's value underneath the current cat image.</p>
<h2 id="measure">Measure <a class="w-headline-link" href="#measure">#</a></h2>
<div class="w-aside w-aside--note">
<p>Since webpack is used in this application, any changes made to the code will trigger a new build, which can take a few seconds. Once it completes, you should see your changes reflected in the application.</p>
</div>
<p>It's always a good idea to begin by inspecting a website before adding any
optimizations:</p>
<ol>
<li>To preview the site, press <strong>View App</strong>. Then press
<strong>Fullscreen</strong>
<img
src="/images/glitch/fullscreen.svg"
alt="fullscreen"
style="padding: 4px 8px; opacity: .5; border: 1px solid #c3c3c3; border-radius: 5px;"
/>.</li>
<li>Press `Control+Shift+J` (or `Command+Option+J` on Mac) to open DevTools.</li>
<li>Click the <strong>Network</strong> tab.</li>
<li>Select the <strong>Disable cache</strong> checkbox.</li>
<li>Reload the app.</li>
</ol>
<img     alt="Original bundle size request"     class="w-screenshot"     decoding="async"     height="127"          loading="lazy"     sizes="(min-width: 717px) 717px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/WOLgtkSsnLlAVqXXkvS2.png?auto=format&w=1434 1434w"          width="717"   />
<p>Over 80 KB is used for this application! Time to find out if parts of the bundle
aren't being used:</p>
<ol>
<li>Press <code>Control+Shift+P</code> (or <code>Command+Shift+P</code> on Mac) to
open the <strong>Command</strong> menu.</li>
</ol>
<!--lint disable code-block-style-->
<p><img     alt="Command Menu"     class="w-screenshot"     decoding="async"     height="170"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/bUJOV2XobvxF0LrIvML4.png?auto=format&w=1600 1600w"          width="800"   /></p>
<ol>
<li>
<p>Enter <code>Show Coverage</code> and hit <code>Enter</code> to display the <strong>Coverage</strong> tab.</p>
</li>
<li>
<p>In the <strong>Coverage</strong> tab, click <strong>Reload</strong> to reload the
application while capturing coverage.</p>
 <img     alt="Reload app with code coverage"     class="w-screenshot"     decoding="async"     height="363"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/MVS59W0Ei307x4Ab3FvU.png?auto=format&w=1600 1600w"          width="800"   />
</li>
<li>
<p>Take a look at how much code was used versus how much was loaded for
the main bundle:</p>
 <img     alt="Code coverage of bundle"     class="w-screenshot"     decoding="async"     height="77"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/YaXfH1OcPENdyMeBBrqK.png?auto=format&w=1600 1600w"          width="800"   />
</li>
</ol>
<!--lint enable code-block-style-->
<p>Over half the bundle (44 KB) is not even utilized. This is because a lot of the
code within consists of polyfills to ensure that the application works in older
browsers.</p>
<h2 id="use-@babelpreset-env">Use @babel/preset-env <a class="w-headline-link" href="#use-@babelpreset-env">#</a></h2>
<p>The syntax of the JavaScript language conforms to a standard known as
ECMAScript, or <a href="https://github.com/tc39/ecma262" rel="noopener">ECMA-262</a>. Newer versions of
the specification are released every year and include new features that have
passed the proposal process. Each major browser is always at a different stage
of supporting these features.</p>
<!-- lint disable no-repeat-punctuation -->
<!-- note "..." is used in the url for "For…of loop" -->
<p>The following ES2015 features are used in the application:</p>
<ul>
<li><a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Functions/Arrow_functions" rel="noopener">Arrow functions</a></li>
<li><a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Template_literals" rel="noopener">Template literals</a></li>
<li><a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/for...of" rel="noopener">For…of loop</a></li>
<li><a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Object_destructuring" rel="noopener">Destructuring assignment</a></li>
</ul>
<!-- lint enable no-repeat-punctuation -->
<p>The following ES2017 feature is used as well:</p>
<ul>
<li><a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/async_function" rel="noopener">Async functions</a></li>
</ul>
<p>Feel free to dive into the source code in <code>src/index.js</code> to see how all of this
is used.</p>
<p>All of these features are supported in the latest version of Chrome, but what
about other browsers that don't support them? <a href="https://babeljs.io/docs/en" rel="noopener">Babel</a>,
which is included in the application, is the most popular library used to compile
code that contains newer syntax into code that older browsers and environments can
understand. It does this in two ways:</p>
<ul>
<li><strong>Polyfills</strong> are included to emulate newer ES2015+ functions so that their APIs
can be used even if it is not supported by the browser. Here is an example of a
<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/includes#Polyfill" rel="noopener">polyfill</a>
of the <code>Array.includes</code> method.</li>
<li><strong>Plugins</strong> are used to transform ES2015 code (or later) into older ES5 syntax.
Since these are syntax related changes (such as arrow functions), they cannot be emulated with polyfills.</li>
</ul>
<p>Look at <code>package.json</code> to see which Babel libraries are included:</p>
<web-copy-code><pre class="language-json"><code class="language-json"><span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>  <span class="token property">"@babel/polyfill"</span><span class="token operator">:</span> <span class="token string">"^7.0.0"</span><br><span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>  <span class="token comment">//...</span><br>  <span class="token property">"babel-loader"</span><span class="token operator">:</span> <span class="token string">"^8.0.2"</span><span class="token punctuation">,</span><br>  <span class="token property">"@babel/core"</span><span class="token operator">:</span> <span class="token string">"^7.1.0"</span><span class="token punctuation">,</span><br>  <span class="token property">"@babel/preset-env"</span><span class="token operator">:</span> <span class="token string">"^7.1.0"</span><span class="token punctuation">,</span><br>  <span class="token comment">//...</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><ul>
<li><code>@babel/core</code> is the core Babel compiler. With this, all the Babel configurations are defined in a <code>.babelrc</code> at the root of the project.</li>
<li><code>babel-loader</code> includes Babel in the webpack build process.</li>
</ul>
<p>Now look at <code>webpack.config.js</code> to see how <code>babel-loader</code> is included as a
rule:</p>
<pre>
module: {
  rules: [
    //...
    <strong>{
      test: /\.js$/,
      exclude: /node_modules/,
      loader: "babel-loader"
    }</strong>
  ]
},
</pre>
<ul>
<li><code>@babel/polyfill</code> provides all the necessary polyfills for any newer ECMAScript features so that they can
work in environments that do not support them. It is already imported at the very top of <code>src/index.js.</code></li>
</ul>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> <span class="token string">"./style.css"</span><span class="token punctuation">;</span></span><br><mark class="highlight-line highlight-line-active"><span class="token keyword">import</span> <span class="token string">"@babel/polyfill"</span><span class="token punctuation">;</span></mark></code></pre>
</web-copy-code><ul>
<li><code>@babel/preset-env</code> identifies which transforms and polyfills are necessary
for any browsers or environments chosen as targets.</li>
</ul>
<p>Take a look at the Babel configurations file, <code>.babelrc</code>, to see how it's
included:</p>
<web-copy-code><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">[</span><br>      <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span><br>      <span class="token punctuation">{</span><br>        <span class="token property">"targets"</span><span class="token operator">:</span> <span class="token string">"last 2 versions"</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
</web-copy-code><p>This is a Babel and webpack setup. <a href="https://babeljs.io/en/setup" rel="noopener">Learn how to include Babel in your
application</a> if you happen to use a different
module bundler than webpack.</p>
<p>The <code>targets</code> attribute
in <code>.babelrc</code> identifies which browsers are being targeted. <code>@babel/preset-env</code>
integrates with browserslist, which means you can find a full list of compatible
queries that can be used in this field in the
<a href="https://github.com/browserslist/browserslist#full-list" rel="noopener">browserlist documentation</a>.</p>
<p>The <code>&quot;last 2 versions&quot;</code> value transpiles the code in the application for the
<a href="http://browserl.ist/?q=last+2+versions" rel="noopener">last two versions</a> of every browser.</p>
<h3 id="debugging">Debugging <a class="w-headline-link" href="#debugging">#</a></h3>
<p>To get a complete look at all the browser's Babel targets as well as all the
transforms and polyfills that are included, add a <code>debug</code> field to <code>.babelrc:</code></p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token string">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">    <span class="token punctuation">[</span></span><br><span class="highlight-line">      <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token string">"targets"</span><span class="token operator">:</span> <span class="token string">"last 2 versions"</span><span class="token punctuation">,</span></span><br><mark class="highlight-line highlight-line-active">        <span class="token string">"debug"</span><span class="token operator">:</span> <span class="token boolean">true</span></mark><br><span class="highlight-line">      <span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token punctuation">]</span></span><br><span class="highlight-line">  <span class="token punctuation">]</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
</web-copy-code><ul>
<li>Click <strong>Tools</strong>.</li>
<li>Click <strong>Logs</strong>.</li>
</ul>
<p>Reload the application and take a look at the Glitch status logs at the bottom
of the editor.</p>
<h3 id="targeted-browsers">Targeted browsers <a class="w-headline-link" href="#targeted-browsers">#</a></h3>
<p>Babel logs a number of details to the console about the compilation process,
including all the target environments that the code has been compiled for.</p>
<img     alt="Targeted browsers"     class="w-screenshot"     decoding="async"     height="457"          loading="lazy"     sizes="(min-width: 464px) 464px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/X6nauvGqKuyWoBekgCbw.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/X6nauvGqKuyWoBekgCbw.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/X6nauvGqKuyWoBekgCbw.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/X6nauvGqKuyWoBekgCbw.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/X6nauvGqKuyWoBekgCbw.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/X6nauvGqKuyWoBekgCbw.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/X6nauvGqKuyWoBekgCbw.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/X6nauvGqKuyWoBekgCbw.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/X6nauvGqKuyWoBekgCbw.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/X6nauvGqKuyWoBekgCbw.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/X6nauvGqKuyWoBekgCbw.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/X6nauvGqKuyWoBekgCbw.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/X6nauvGqKuyWoBekgCbw.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/X6nauvGqKuyWoBekgCbw.png?auto=format&w=928 928w"          width="464"   />
<p>Notice how discontinued browsers, such as Internet Explorer, are included in
this list. This is a problem because unsupported browsers won't have newer
features added, and Babel continues to transpile specific syntax for them. This
unnecessarily increases the size of your bundle if users are not using this
browser to access your site.</p>
<p>Babel also logs a list of transform plugins used:</p>
<img     alt="List of plugins used"     class="w-screenshot"     decoding="async"     height="604"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/clNXHWSfeD2RKDkIrJo8.png?auto=format&w=1600 1600w"          width="800"   />
<p>That's a pretty long list! These are all the plugins that Babel needs to use to
transform any ES2015+ syntax to older syntax for all the targeted browsers.</p>
<p>However, Babel doesn't show any specific polyfills that are used:</p>
<img     alt="No polyfills added"     class="w-screenshot"     decoding="async"     height="38"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/xPhc2usfwfIJkoK4EubY.png?auto=format&w=1600 1600w"          width="800"   />
<p>This is because the entire <code>@babel/polyfill</code> is being imported directly.</p>
<h3 id="load-polyfills-individually">Load polyfills individually <a class="w-headline-link" href="#load-polyfills-individually">#</a></h3>
<p>By default, Babel includes every polyfill needed for a complete ES2015+ environment when
<code>@babel/polyfill</code> is imported into a file. To import specific polyfills needed for
the target browsers, add a <code>useBuiltIns: 'entry'</code> to the configuration.</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token string">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">    <span class="token punctuation">[</span></span><br><span class="highlight-line">      <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token string">"targets"</span><span class="token operator">:</span> <span class="token string">"last 2 versions"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        <span class="token string">"debug"</span><span class="token operator">:</span> <span class="token boolean">true</span></span><br><mark class="highlight-line highlight-line-active">        <span class="token string">"useBuiltIns"</span><span class="token operator">:</span> <span class="token string">"entry"</span></mark><br><span class="highlight-line">      <span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token punctuation">]</span></span><br><span class="highlight-line">  <span class="token punctuation">]</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
</web-copy-code><p>Reload the application. You can now see all the specific polyfills included:</p>
<img     alt="List of polyfills imported"     class="w-screenshot"     decoding="async"     height="465"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format"     srcset="https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/VQHDI6qG94zbTiorG3aT.gif?auto=format&w=1600 1600w"          width="800"   />
<p>Although only needed polyfills for <code>&quot;last 2 versions&quot;</code> is now included, it is still a super long list! This is because
polyfills needed for the target browsers for <em>every</em> newer feature is still included. Change the value of the attribute to <code>usage</code>
to only include those needed for features that are being used in the code.</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token string">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">    <span class="token punctuation">[</span></span><br><span class="highlight-line">      <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token punctuation">{</span></span><br><span class="highlight-line">        <span class="token string">"targets"</span><span class="token operator">:</span> <span class="token string">"last 2 versions"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        <span class="token string">"debug"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span><br><del class="highlight-line highlight-line-remove">        <span class="token string">"useBuiltIns"</span><span class="token operator">:</span> <span class="token string">"entry"</span></del><br><ins class="highlight-line highlight-line-add">        <span class="token string">"useBuiltIns"</span><span class="token operator">:</span> <span class="token string">"usage"</span></ins><br><span class="highlight-line">      <span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token punctuation">]</span></span><br><span class="highlight-line">  <span class="token punctuation">]</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
</web-copy-code><p>With this, polyfills are automatically included where needed.
This means you can remove the <code>@babel/polyfill</code> import in <code>src/index.js.</code></p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> <span class="token string">"./style.css"</span><span class="token punctuation">;</span></span><br><del class="highlight-line highlight-line-remove"><span class="token keyword">import</span> <span class="token string">"@babel/polyfill"</span><span class="token punctuation">;</span></del></code></pre>
</web-copy-code><p>Now only the required polyfills needed for the application are included.</p>
<img     alt="List of polyfills automatically included"     class="w-screenshot"     decoding="async"     height="114"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/ir2qkYhxoJDWoQUhD8KD.png?auto=format&w=1600 1600w"          width="800"   />
<p>The application bundle size is reduced significantly.</p>
<img     alt="Bundle size reduced to 30.1 KB"     class="w-screenshot"     decoding="async"     height="135"          loading="lazy"     sizes="(min-width: 796px) 796px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/6cIW1H9dYz38h3jp9QpK.png?auto=format&w=1592 1592w"          width="796"   />
<h2 id="narrowing-the-list-of-supported-browsers">Narrowing the list of supported browsers <a class="w-headline-link" href="#narrowing-the-list-of-supported-browsers">#</a></h2>
<p>The number of browser targets included is still quite large, and not many users
use discontinued browsers such as Internet Explorer. Update the configurations
to the following:</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token string">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">    <span class="token punctuation">[</span></span><br><span class="highlight-line">      <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token punctuation">{</span></span><br><del class="highlight-line highlight-line-remove">        <span class="token string">"targets"</span><span class="token operator">:</span> <span class="token string">"last 2 versions"</span><span class="token punctuation">,</span></del><br><ins class="highlight-line highlight-line-add">        <span class="token string">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">">0.25%"</span><span class="token punctuation">,</span> <span class="token string">"not ie 11"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></ins><br><span class="highlight-line">        <span class="token string">"debug"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        <span class="token string">"useBuiltIns"</span><span class="token operator">:</span> <span class="token string">"usage"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">      <span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token punctuation">]</span></span><br><span class="highlight-line">  <span class="token punctuation">]</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
</web-copy-code><p>Take a look at the details for the fetched bundle.</p>
<img     alt="Bundle size of 30.0 KB"     class="w-screenshot"     decoding="async"     height="131"          loading="lazy"     sizes="(min-width: 793px) 793px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/LQrCZtEqujASX2KBR9ku.png?auto=format&w=1586 1586w"          width="793"   />
<p>Since the application is so small, there really isn't much of a difference with
these changes. However, using a browser market share percentage (such as
<code>&quot;&gt;0.25%&quot;</code>) along with excluding specific browsers that you are confident your
users are not using is the recommended approach. Take a look at the
<a href="https://jamie.build/last-2-versions" rel="noopener">&quot;Last 2 versions&quot; considered harmful</a>
article by James Kyle to learn more about this.</p>
<h2 id="use-lessscript-type&quot;module&quot;greater">Use &lt;script type=&quot;module&quot;&gt; <a class="w-headline-link" href="#use-lessscript-type&quot;module&quot;greater">#</a></h2>
<p>There is still more room for improvement. Although a number of unused polyfills
have been removed, there are many that are being shipped that are not needed for
some browsers. By using modules, newer syntax can be written and shipped to
browsers directly without the use of any unnecessary polyfills.</p>
<p><strong>JavaScript modules</strong> are a relatively new feature supported in <a href="https://caniuse.com/#feat=es6-module" rel="noopener">all major browsers</a>.
Modules can be created using a <code>type=&quot;module&quot;</code> attribute to define scripts that import and export from other
modules. For example:</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token comment">// math.mjs</span><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token operator">=></span> x <span class="token operator">+</span> y<span class="token punctuation">;</span><br><br><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html <span class="token operator">--</span><span class="token operator">></span><br><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"module"</span><span class="token operator">></span><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math.mjs'</span><span class="token punctuation">;</span><br><br>  <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 7</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>
</web-copy-code><p>Many newer ECMAScript features are already supported in environments that
support JavaScript modules (instead of needing Babel.) This means that the Babel
config can be modified to send two different versions of your application to the
browser:</p>
<ul>
<li>A version that would work in newer browsers that support modules and that includes a module that is largely untranspiled but has a smaller file size</li>
<li>A version that includes a larger, transpiled script that would work in any legacy browser</li>
</ul>
<h2 id="using-es-modules-with-babel">Using ES Modules with Babel <a class="w-headline-link" href="#using-es-modules-with-babel">#</a></h2>
<p>In order to have separate <code>@babel/preset-env</code> settings for the two versions of
the application, remove the <code>.babelrc</code> file. Babel settings can be added to the
webpack configuration by specifying two different compilation formats for each
version of the application.</p>
<p>Begin by adding a configuration for the legacy script to <code>webpack.config.js</code>:</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> legacyConfig <span class="token operator">=</span> <span class="token punctuation">{</span><br>  entry<span class="token punctuation">,</span><br>  output<span class="token operator">:</span> <span class="token punctuation">{</span><br>    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"public"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    filename<span class="token operator">:</span> <span class="token string">"[name].bundle.js"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  module<span class="token operator">:</span> <span class="token punctuation">{</span><br>    rules<span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">{</span><br>        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><br>        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><br>        loader<span class="token operator">:</span> <span class="token string">"babel-loader"</span><span class="token punctuation">,</span><br>        options<span class="token operator">:</span> <span class="token punctuation">{</span><br>          presets<span class="token operator">:</span> <span class="token punctuation">[</span><br>            <span class="token punctuation">[</span><span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>              useBuiltIns<span class="token operator">:</span> <span class="token string">"usage"</span><span class="token punctuation">,</span><br>              targets<span class="token operator">:</span> <span class="token punctuation">{</span><br>                esmodules<span class="token operator">:</span> <span class="token boolean">false</span><br>              <span class="token punctuation">}</span><br>            <span class="token punctuation">}</span><span class="token punctuation">]</span><br>          <span class="token punctuation">]</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      cssRule<br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  plugins<br><span class="token punctuation">}</span></code></pre>
</web-copy-code><p>Notice that instead of using the <code>targets</code> value for <code>&quot;@babel/preset-env&quot;</code>,
<code>esmodules</code> with a value of <code>false</code> is used instead. This means that Babel
includes all the necessary transforms and polyfills to target every browser that does
not yet support ES modules.</p>
<p>Add <code>entry</code>, <code>cssRule</code>, and <code>corePlugins</code> objects to the beginning of the
<code>webpack.config.js</code> file. These are all shared between both the module and
legacy scripts served to the browser.</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token punctuation">{</span><br>  main<span class="token operator">:</span> <span class="token string">"./src"</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> cssRule <span class="token operator">=</span> <span class="token punctuation">{</span><br>  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><br>  use<span class="token operator">:</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    fallback<span class="token operator">:</span> <span class="token string">"style-loader"</span><span class="token punctuation">,</span><br>    use<span class="token operator">:</span> <span class="token string">"css-loader"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span><br>  <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>filename<span class="token operator">:</span> <span class="token string">"[name].css"</span><span class="token punctuation">,</span> allChunks<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>template<span class="token operator">:</span> <span class="token string">"./src/index.html"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p>Now similarly, create a config object for the module script below where <code>legacyConfig</code> is defined:</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> moduleConfig <span class="token operator">=</span> <span class="token punctuation">{</span><br>  entry<span class="token punctuation">,</span><br>  output<span class="token operator">:</span> <span class="token punctuation">{</span><br>    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"public"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    filename<span class="token operator">:</span> <span class="token string">"[name].mjs"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  module<span class="token operator">:</span> <span class="token punctuation">{</span><br>    rules<span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">{</span><br>        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><br>        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><br>        loader<span class="token operator">:</span> <span class="token string">"babel-loader"</span><span class="token punctuation">,</span><br>        options<span class="token operator">:</span> <span class="token punctuation">{</span><br>          presets<span class="token operator">:</span> <span class="token punctuation">[</span><br>            <span class="token punctuation">[</span><span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>              useBuiltIns<span class="token operator">:</span> <span class="token string">"usage"</span><span class="token punctuation">,</span><br>              targets<span class="token operator">:</span> <span class="token punctuation">{</span><br>                esmodules<span class="token operator">:</span> <span class="token boolean">true</span><br>              <span class="token punctuation">}</span><br>            <span class="token punctuation">}</span><span class="token punctuation">]</span><br>          <span class="token punctuation">]</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      cssRule<br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  plugins<br><span class="token punctuation">}</span></code></pre>
</web-copy-code><p>The main difference here is that a <code>.mjs</code> file extension is used for the output
filename. The <code>esmodules</code> value is set to true here which means that the code
that is outputted into this module is a smaller, less compiled script that does
not go through any transformation in this example since all the features used
are already supported in browsers that support modules.</p>
<p>At the very end of the file, export both configurations in a single array.</p>
<web-copy-code><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">[</span><br>  legacyConfig<span class="token punctuation">,</span> moduleConfig<br><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
</web-copy-code><p>Now this builds both a smaller module for browsers that support it and a larger
transpiled script for older browsers.</p>
<p>Browsers that support modules ignore scripts with a <code>nomodule</code> attribute.
Conversely, browsers that do not support modules ignore script elements with
<code>type=&quot;module&quot;</code>. This means you can include a module as well as a compiled
fallback. Ideally, the two versions of the application should be in <code>index.html</code>
like this:</p>
<web-copy-code><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main.mjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">nomodule</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main.bundle.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
</web-copy-code><p>Browsers that support modules fetch and execute <code>main.mjs</code> and ignore
<code>main.bundle.js.</code> The browsers that do not support modules do the opposite.</p>
<p>It is important to note that unlike regular scripts, module scripts are always deferred by default.
If you would like the equivalent <code>nomodule</code> script to also be deferred and only executed after
parsing, then you'll need to add the <code>defer</code> attribute:</p>
<web-copy-code><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main.mjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">nomodule</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main.bundle.js<span class="token punctuation">"</span></span> <span class="token attr-name">defer</span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
</web-copy-code><p>The last thing that needs to be done here is to add the <code>module</code> and <code>nomodule</code>
attributes to the module and legacy script respectively, Import the
<a href="https://github.com/numical/script-ext-html-webpack-plugin" rel="noopener">ScriptExtHtmlWebpackPlugin</a>
at the very top of <code>webpack.config.js</code>:</p>
<web-copy-code><pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"webpack"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"html-webpack-plugin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><mark class="highlight-line highlight-line-active"><span class="token keyword">const</span> ScriptExtHtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"script-ext-html-webpack-plugin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></mark></code></pre>
</web-copy-code><p>Now update the <code>plugins</code> array in the configurations to include this plugin:</p>
<pre>
const plugins = [
  new ExtractTextPlugin({filename: "[name].css", allChunks: true}),
  new HtmlWebpackPlugin({template: "./src/index.html"}),
  new ScriptExtHtmlWebpackPlugin({
    <strong>module: /\.mjs$/,
    custom: [
      {
        test: /\.js$/,
        attribute: 'nomodule',
        value: ''
    },
    ]</strong>
  })
];
</pre>
<p>These plugin settings add a <code>type=&quot;module&quot;</code> attribute for all <code>.mjs</code> script
elements as well as a <code>nomodule</code> attribute for all <code>.js</code> script modules.</p>
<div class="w-aside w-aside--note">
<p>If you're having trouble understanding how to add all of these configurations to <code>webpack.config.js</code>, take a look at the <a href="https://glitch.com/edit/#!/serve-modern-code-complete?path=webpack.config.js:1:0" rel="noopener">complete version of the file</a>.</p>
</div>
<h2 id="serving-modules-in-the-html-document">Serving modules in the HTML document <a class="w-headline-link" href="#serving-modules-in-the-html-document">#</a></h2>
<p>The last thing that needs to be done is to output both the legacy and modern script elements to the HTML file. Unfortunately, the plugin that creates the final HTML file, <code>HTMLWebpackPlugin</code>, <a href="https://github.com/jantimon/html-webpack-plugin/issues/782" rel="noopener">does not currently support</a> the output of both the module and nomodule scripts. Although there are workarounds and separate plugins created to solve this problem, such as <a href="https://github.com/DanielSchaffer/webpack-babel-multi-target-plugin" rel="noopener">BabelMultiTargetPlugin</a> and <a href="https://github.com/firsttris/html-webpack-multi-build-plugin" rel="noopener">HTMLWebpackMultiBuildPlugin</a>, a simpler approach of adding the module script element manually is used for the purpose of this tutorial.</p>
<p>Add the following to <code>src/index.js</code> at the end of the file:</p>
<web-copy-code><pre class="language-html"><code class="language-html"><span class="highlight-line">    ...</span><br><span class="highlight-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></span><br><mark class="highlight-line highlight-line-active">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main.mjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></mark><br><span class="highlight-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></span><br><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></span></code></pre>
</web-copy-code><p>Now load the application in a browser that supports modules, such as the latest
version of Chrome.</p>
<img     alt="5.2 KB module fetched over network for newer browsers"     class="w-screenshot"     decoding="async"     height="100"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/7DHv0rPqfFE14Qp7OtqJ.png?auto=format&w=1600 1600w"          width="800"   />
<p>Only the module is fetched, with a much smaller bundle size due to it being
largely untranspiled! The other script element is completely ignored by the
browser.</p>
<p>If you load the application on an older browser, only the larger, transpiled
script with all the needed polyfills and transforms are be fetched. Here is a
screenshot for all the requests made on an older version of Chrome (version
38).</p>
<img     alt="30 KB script fetched for older browsers"     class="w-screenshot"     decoding="async"     height="324"          loading="lazy"     sizes="(min-width: 800px) 800px, calc(100vw - 48px)"     src="https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format"     srcset="https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/xapbFvWftJjVdsekOAFJ.png?auto=format&w=1600 1600w"          width="800"   />
<h2 id="conclusion">Conclusion <a class="w-headline-link" href="#conclusion">#</a></h2>
<p>You now understand how to use <code>@babel/preset-env</code> to provide only the necessary
polyfills required for targeted browsers. You also know how JavaScript modules
can improve performance further by shipping two different transpiled versions of an
application. With a decent understanding of how both these techniques can cut
your bundle size down significantly, go forth and optimize!</p>


        <div class="text-size-0 color-mid-text">
          <span>
            
            Last updated: <time>Dec 12, 2018</time>
            
          </span>
          —
          <a
            href="https://github.com/GoogleChrome/web.dev/blob/main/src/site/content/en/fast/codelab-serve-modern-code/index.md"
          >
            Improve article
          </a>
        </div>

        
          
          
        

        
          <div class="flow-space-size-2">
            <a href="/serve-modern-code-to-modern-browsers" class="button" data-type="secondary">
              <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>

              <span>Return to article</span>
            </a>
          </div>
        
      </article>
    </div>
  </web-codelab>
</div>

  </div>
</main>
<footer class="w-footer">
  <nav class="w-footer__linkboxes">
    <ul class="w-footer__linkboxes-list">
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Contribute</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&labels=bug&template=bug_report.md&title="
              class="w-footer__linkbox-link" data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              File a bug
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://github.com/googlechrome/web.dev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              View source
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Related content</h3>
        <ul class="w-footer__linkbox-list">
         <li class="w-footer__linkbox-item">
            <a href="https://developer.chrome.com/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              developer.chrome.com
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://blog.chromium.org/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Chrome updates
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/fundamentals" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              Web Fundamentals
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://developers.google.com/web/showcase/" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">
              Case studies
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/podcasts/" class="w-footer__linkbox-link"
              data-category="Podcasts" data-label="Footer Link (index 5)">
              Podcasts
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="/shows/" class="w-footer__linkbox-link"
              data-category="Shows" data-label="Footer Link (index 6)">
              Shows
            </a>
          </li>
        </ul>
      </li>
      <li class="w-footer__linkbox">
        <h3 class="w-footer__linkbox-heading">Connect</h3>
        <ul class="w-footer__linkbox-list">
          <li class="w-footer__linkbox-item">
            <a href="https://www.twitter.com/ChromiumDev" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
              Twitter
            </a>
          </li>
          <li class="w-footer__linkbox-item">
            <a href="https://www.youtube.com/user/ChromeDevelopers" class="w-footer__linkbox-link"
              data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
              YouTube
            </a>
          </li>
        </ul>
      </li>
    </ul>
  </nav>

  <div class="w-footer__utility">
    <nav class="w-footer__utility-nav">
      <a href="https://developers.google.com/" class="w-footer__utility-logo-link"
        data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link">
        <img loading="lazy" width="185" height="33" class="w-footer__utility-logo" src="/images/lockup-color.png"
          alt="Google Developers" />
      </a>
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developer.chrome.com/"
            data-category="Site-Wide Custom Events" data-label="Footer Chrome Link">
            Chrome
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://firebase.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Firebase Link">
            Firebase
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://cloud.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Google Cloud Platform Link">
            Google Cloud Platform
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://developers.google.com/products"
            data-category="Site-Wide Custom Events" data-label="Footer All products Link">
            All products
          </a>
        </li>
      </ul>
      <web-language-select current="en"></web-language-select>
    </nav>
    <nav class="w-footer__utility-nav">
      <ul class="w-footer__utility-list">
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="https://policies.google.com/" data-category="Site-Wide Custom Events"
            data-label="Footer Terms and Privacy link">
            Terms &amp; Privacy
          </a>
        </li>
        <li class="w-footer__utility-item">
          <a class="w-footer__utility-link" href="/community-guidelines/" data-category="Site-Wide Custom Events"
            data-label="Footer Community Guidelines link">
            Community Guidelines
          </a>
        </li>
      </ul>
      <div class="w-footer__license">
        <p>
          Except as otherwise noted, the content of this page is licensed
          under the
          <a href="https://creativecommons.org/licenses/by/4.0/">
          Creative Commons Attribution 4.0 License</a>,
          and code samples are licensed under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">
          Apache 2.0 License</a>. For details, see the
          <a href="https://developers.google.com/terms/site-policies">
          Google Developers Site Policies</a>.
        </p>
      </div>
    </nav>
  </div>
</footer>

  </body>
</html>
